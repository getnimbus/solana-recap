const b="logger/5.7.0";let T=!1,_=!1;const R={debug:1,default:2,info:2,warning:3,error:4,off:5};let O=R.default,I=null;function D(){try{const e=[];if(["NFD","NFC","NFKD","NFKC"].forEach(r=>{try{if("test".normalize(r)!=="test")throw new Error("bad normalize")}catch{e.push(r)}}),e.length)throw new Error("missing "+e.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(e){return e.message}return null}const p=D();var U;(function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.OFF="OFF"})(U||(U={}));var u;(function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.TIMEOUT="TIMEOUT",e.BUFFER_OVERRUN="BUFFER_OVERRUN",e.NUMERIC_FAULT="NUMERIC_FAULT",e.MISSING_NEW="MISSING_NEW",e.INVALID_ARGUMENT="INVALID_ARGUMENT",e.MISSING_ARGUMENT="MISSING_ARGUMENT",e.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",e.CALL_EXCEPTION="CALL_EXCEPTION",e.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",e.NONCE_EXPIRED="NONCE_EXPIRED",e.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",e.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",e.TRANSACTION_REPLACED="TRANSACTION_REPLACED",e.ACTION_REJECTED="ACTION_REJECTED"})(u||(u={}));const S="0123456789abcdef";class s{constructor(r){Object.defineProperty(this,"version",{enumerable:!0,value:r,writable:!1})}_log(r,n){const o=r.toLowerCase();R[o]==null&&this.throwArgumentError("invalid log level name","logLevel",r),!(O>R[o])&&console.log.apply(console,n)}debug(...r){this._log(s.levels.DEBUG,r)}info(...r){this._log(s.levels.INFO,r)}warn(...r){this._log(s.levels.WARNING,r)}makeError(r,n,o){if(_)return this.makeError("censored error",n,{});n||(n=s.errors.UNKNOWN_ERROR),o||(o={});const t=[];Object.keys(o).forEach(a=>{const N=o[a];try{if(N instanceof Uint8Array){let A="";for(let m=0;m<N.length;m++)A+=S[N[m]>>4],A+=S[N[m]&15];t.push(a+"=Uint8Array(0x"+A+")")}else t.push(a+"="+JSON.stringify(N))}catch{t.push(a+"="+JSON.stringify(o[a].toString()))}}),t.push(`code=${n}`),t.push(`version=${this.version}`);const c=r;let E="";switch(n){case u.NUMERIC_FAULT:{E="NUMERIC_FAULT";const a=r;switch(a){case"overflow":case"underflow":case"division-by-zero":E+="-"+a;break;case"negative-power":case"negative-width":E+="-unsupported";break;case"unbound-bitwise-result":E+="-unbound-result";break}break}case u.CALL_EXCEPTION:case u.INSUFFICIENT_FUNDS:case u.MISSING_NEW:case u.NONCE_EXPIRED:case u.REPLACEMENT_UNDERPRICED:case u.TRANSACTION_REPLACED:case u.UNPREDICTABLE_GAS_LIMIT:E=n;break}E&&(r+=" [ See: https://links.ethers.org/v5-errors-"+E+" ]"),t.length&&(r+=" ("+t.join(", ")+")");const f=new Error(r);return f.reason=c,f.code=n,Object.keys(o).forEach(function(a){f[a]=o[a]}),f}throwError(r,n,o){throw this.makeError(r,n,o)}throwArgumentError(r,n,o){return this.throwError(r,s.errors.INVALID_ARGUMENT,{argument:n,value:o})}assert(r,n,o,t){r||this.throwError(n,o,t)}assertArgument(r,n,o,t){r||this.throwArgumentError(n,o,t)}checkNormalize(r){p&&this.throwError("platform missing String.prototype.normalize",s.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:p})}checkSafeUint53(r,n){typeof r=="number"&&(n==null&&(n="value not safe"),(r<0||r>=9007199254740991)&&this.throwError(n,s.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:r}),r%1&&this.throwError(n,s.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:r}))}checkArgumentCount(r,n,o){o?o=": "+o:o="",r<n&&this.throwError("missing argument"+o,s.errors.MISSING_ARGUMENT,{count:r,expectedCount:n}),r>n&&this.throwError("too many arguments"+o,s.errors.UNEXPECTED_ARGUMENT,{count:r,expectedCount:n})}checkNew(r,n){(r===Object||r==null)&&this.throwError("missing new",s.errors.MISSING_NEW,{name:n.name})}checkAbstract(r,n){r===n?this.throwError("cannot instantiate abstract class "+JSON.stringify(n.name)+" directly; use a sub-class",s.errors.UNSUPPORTED_OPERATION,{name:r.name,operation:"new"}):(r===Object||r==null)&&this.throwError("missing new",s.errors.MISSING_NEW,{name:n.name})}static globalLogger(){return I||(I=new s(b)),I}static setCensorship(r,n){if(!r&&n&&this.globalLogger().throwError("cannot permanently disable censorship",s.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),T){if(!r)return;this.globalLogger().throwError("error censorship permanent",s.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}_=!!r,T=!!n}static setLogLevel(r){const n=R[r.toLowerCase()];if(n==null){s.globalLogger().warn("invalid log level - "+r);return}O=n}static from(r){return new s(r)}}s.errors=u;s.levels=U;const L="bytes/5.7.0",i=new s(L);function C(e){return!!e.toHexString}function h(e){return e.slice||(e.slice=function(){const r=Array.prototype.slice.call(arguments);return h(new Uint8Array(Array.prototype.slice.apply(e,r)))}),e}function x(e){return g(e)&&!(e.length%2)||P(e)}function d(e){return typeof e=="number"&&e==e&&e%1===0}function P(e){if(e==null)return!1;if(e.constructor===Uint8Array)return!0;if(typeof e=="string"||!d(e.length)||e.length<0)return!1;for(let r=0;r<e.length;r++){const n=e[r];if(!d(n)||n<0||n>=256)return!1}return!0}function v(e,r){if(r||(r={}),typeof e=="number"){i.checkSafeUint53(e,"invalid arrayify value");const n=[];for(;e;)n.unshift(e&255),e=parseInt(String(e/256));return n.length===0&&n.push(0),h(new Uint8Array(n))}if(r.allowMissingPrefix&&typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),C(e)&&(e=e.toHexString()),g(e)){let n=e.substring(2);n.length%2&&(r.hexPad==="left"?n="0"+n:r.hexPad==="right"?n+="0":i.throwArgumentError("hex data is odd-length","value",e));const o=[];for(let t=0;t<n.length;t+=2)o.push(parseInt(n.substring(t,t+2),16));return h(new Uint8Array(o))}return P(e)?h(new Uint8Array(e)):i.throwArgumentError("invalid arrayify value","value",e)}function F(e){const r=e.map(t=>v(t)),n=r.reduce((t,c)=>t+c.length,0),o=new Uint8Array(n);return r.reduce((t,c)=>(o.set(c,t),t+c.length),0),h(o)}function M(e,r){e=v(e),e.length>r&&i.throwArgumentError("value out of range","value",arguments[0]);const n=new Uint8Array(r);return n.set(e,r-e.length),h(n)}function g(e,r){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||r&&e.length!==2+2*r)}const w="0123456789abcdef";function l(e,r){if(r||(r={}),typeof e=="number"){i.checkSafeUint53(e,"invalid hexlify value");let n="";for(;e;)n=w[e&15]+n,e=Math.floor(e/16);return n.length?(n.length%2&&(n="0"+n),"0x"+n):"0x00"}if(typeof e=="bigint")return e=e.toString(16),e.length%2?"0x0"+e:"0x"+e;if(r.allowMissingPrefix&&typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),C(e))return e.toHexString();if(g(e))return e.length%2&&(r.hexPad==="left"?e="0x0"+e.substring(2):r.hexPad==="right"?e+="0":i.throwArgumentError("hex data is odd-length","value",e)),e.toLowerCase();if(P(e)){let n="0x";for(let o=0;o<e.length;o++){let t=e[o];n+=w[(t&240)>>4]+w[t&15]}return n}return i.throwArgumentError("invalid hexlify value","value",e)}function G(e,r,n){return typeof e!="string"?e=l(e):(!g(e)||e.length%2)&&i.throwArgumentError("invalid hexData","value",e),r=2+2*r,"0x"+e.substring(r,2+2*n)}function k(e){let r="0x";return e.forEach(n=>{r+=l(n).substring(2)}),r}function y(e,r){for(typeof e!="string"?e=l(e):g(e)||i.throwArgumentError("invalid hex string","value",e),e.length>2*r+2&&i.throwArgumentError("value out of range","value",arguments[1]);e.length<2*r+2;)e="0x0"+e.substring(2);return e}function W(e){const r={r:"0x",s:"0x",_vs:"0x",recoveryParam:0,v:0,yParityAndS:"0x",compact:"0x"};if(x(e)){let n=v(e);n.length===64?(r.v=27+(n[32]>>7),n[32]&=127,r.r=l(n.slice(0,32)),r.s=l(n.slice(32,64))):n.length===65?(r.r=l(n.slice(0,32)),r.s=l(n.slice(32,64)),r.v=n[64]):i.throwArgumentError("invalid signature string","signature",e),r.v<27&&(r.v===0||r.v===1?r.v+=27:i.throwArgumentError("signature invalid v byte","signature",e)),r.recoveryParam=1-r.v%2,r.recoveryParam&&(n[32]|=128),r._vs=l(n.slice(32,64))}else{if(r.r=e.r,r.s=e.s,r.v=e.v,r.recoveryParam=e.recoveryParam,r._vs=e._vs,r._vs!=null){const t=M(v(r._vs),32);r._vs=l(t);const c=t[0]>=128?1:0;r.recoveryParam==null?r.recoveryParam=c:r.recoveryParam!==c&&i.throwArgumentError("signature recoveryParam mismatch _vs","signature",e),t[0]&=127;const E=l(t);r.s==null?r.s=E:r.s!==E&&i.throwArgumentError("signature v mismatch _vs","signature",e)}if(r.recoveryParam==null)r.v==null?i.throwArgumentError("signature missing v and recoveryParam","signature",e):r.v===0||r.v===1?r.recoveryParam=r.v:r.recoveryParam=1-r.v%2;else if(r.v==null)r.v=27+r.recoveryParam;else{const t=r.v===0||r.v===1?r.v:1-r.v%2;r.recoveryParam!==t&&i.throwArgumentError("signature recoveryParam mismatch v","signature",e)}r.r==null||!g(r.r)?i.throwArgumentError("signature missing or invalid r","signature",e):r.r=y(r.r,32),r.s==null||!g(r.s)?i.throwArgumentError("signature missing or invalid s","signature",e):r.s=y(r.s,32);const n=v(r.s);n[0]>=128&&i.throwArgumentError("signature s out of range","signature",e),r.recoveryParam&&(n[0]|=128);const o=l(n);r._vs&&(g(r._vs)||i.throwArgumentError("signature invalid _vs","signature",e),r._vs=y(r._vs,32)),r._vs==null?r._vs=o:r._vs!==o&&i.throwArgumentError("signature _vs mismatch v and s","signature",e)}return r.yParityAndS=r._vs,r.compact=r.r+r.yParityAndS.substring(2),r}export{G as L,W,y as _,F as d,v as g,g as h,k,l,s,P as y};
