const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index8.js","assets/index.js","assets/index.BvO5tclL.css","assets/index.modern.js"])))=>i.map(i=>d[i]);
import{dy as hh,dz as pt,cm as je,c$ as Kn,dR as vo,bu as Jm}from"./index.js";import{I as or,n as T,k as Qm,o as mo,R as lt,S as rt,m as lh,x as ph,q as fh,H as Ym,t as dh,T as pu,l as Zm,v as us,C as Xm,w as ew,y as tw,r as rw,f as ds,g as wo,i as wt,a as gs,b as fu,s as gh,c as iw,d as sw,e as yh,h as _o,p as nw,z as ow,E as He,A as Fe,M as ys,B as vs,F as aw,G as du,J as cw,K as uw,L as bo,N as Eo,O as Lt,Q as ar}from"./index.es3.js";import"./browser-ponyfill.js";function hw(a,i=[]){const r=[];return Object.keys(a).forEach(s=>{if(i.length&&!i.includes(s))return;const o=a[s];r.push(...o.accounts)}),r}const lw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function pw(a,i){const{message:r,code:s}=lw[a];return{message:r,code:s}}function ro(a,i){return!!Array.isArray(a)}var Nr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var io=function(a,i){return io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)s.hasOwnProperty(o)&&(r[o]=s[o])},io(a,i)};function fw(a,i){io(a,i);function r(){this.constructor=a}a.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}var so=function(){return so=Object.assign||function(i){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(i[u]=r[u])}return i},so.apply(this,arguments)};function dw(a,i){var r={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.indexOf(s)<0&&(r[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(a);o<s.length;o++)i.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(a,s[o])&&(r[s[o]]=a[s[o]]);return r}function gw(a,i,r,s){var o=arguments.length,u=o<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,r):s,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(a,i,r,s);else for(var g=a.length-1;g>=0;g--)(p=a[g])&&(u=(o<3?p(u):o>3?p(i,r,u):p(i,r))||u);return o>3&&u&&Object.defineProperty(i,r,u),u}function yw(a,i){return function(r,s){i(r,s,a)}}function vw(a,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,i)}function mw(a,i,r,s){function o(u){return u instanceof r?u:new r(function(p){p(u)})}return new(r||(r=Promise))(function(u,p){function g(N){try{b(s.next(N))}catch($){p($)}}function w(N){try{b(s.throw(N))}catch($){p($)}}function b(N){N.done?u(N.value):o(N.value).then(g,w)}b((s=s.apply(a,i||[])).next())})}function ww(a,i){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,o,u,p;return p={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function g(b){return function(N){return w([b,N])}}function w(b){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,o&&(u=b[0]&2?o.return:b[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,b[1])).done)return u;switch(o=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,o=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){r.label=b[1];break}if(b[0]===6&&r.label<u[1]){r.label=u[1],u=b;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(b);break}u[2]&&r.ops.pop(),r.trys.pop();continue}b=i.call(a,r)}catch(N){b=[6,N],o=0}finally{s=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function _w(a,i,r,s){s===void 0&&(s=r),a[s]=i[r]}function bw(a,i){for(var r in a)r!=="default"&&!i.hasOwnProperty(r)&&(i[r]=a[r])}function no(a){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&a[i],s=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&s>=a.length&&(a=void 0),{value:a&&a[s++],done:!a}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function vh(a,i){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var s=r.call(a),o,u=[],p;try{for(;(i===void 0||i-- >0)&&!(o=s.next()).done;)u.push(o.value)}catch(g){p={error:g}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(p)throw p.error}}return u}function Ew(){for(var a=[],i=0;i<arguments.length;i++)a=a.concat(vh(arguments[i]));return a}function Iw(){for(var a=0,i=0,r=arguments.length;i<r;i++)a+=arguments[i].length;for(var s=Array(a),o=0,i=0;i<r;i++)for(var u=arguments[i],p=0,g=u.length;p<g;p++,o++)s[o]=u[p];return s}function ai(a){return this instanceof ai?(this.v=a,this):new ai(a)}function Sw(a,i,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(a,i||[]),o,u=[];return o={},p("next"),p("throw"),p("return"),o[Symbol.asyncIterator]=function(){return this},o;function p(A){s[A]&&(o[A]=function(W){return new Promise(function(j,Z){u.push([A,W,j,Z])>1||g(A,W)})})}function g(A,W){try{w(s[A](W))}catch(j){$(u[0][3],j)}}function w(A){A.value instanceof ai?Promise.resolve(A.value.v).then(b,N):$(u[0][2],A)}function b(A){g("next",A)}function N(A){g("throw",A)}function $(A,W){A(W),u.shift(),u.length&&g(u[0][0],u[0][1])}}function Pw(a){var i,r;return i={},s("next"),s("throw",function(o){throw o}),s("return"),i[Symbol.iterator]=function(){return this},i;function s(o,u){i[o]=a[o]?function(p){return(r=!r)?{value:ai(a[o](p)),done:o==="return"}:u?u(p):p}:u}}function Ow(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=a[Symbol.asyncIterator],r;return i?i.call(a):(a=typeof no=="function"?no(a):a[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=a[u]&&function(p){return new Promise(function(g,w){p=a[u](p),o(g,w,p.done,p.value)})}}function o(u,p,g,w){Promise.resolve(w).then(function(b){u({value:b,done:g})},p)}}function Rw(a,i){return Object.defineProperty?Object.defineProperty(a,"raw",{value:i}):a.raw=i,a}function Nw(a){if(a&&a.__esModule)return a;var i={};if(a!=null)for(var r in a)Object.hasOwnProperty.call(a,r)&&(i[r]=a[r]);return i.default=a,i}function Cw(a){return a&&a.__esModule?a:{default:a}}function $w(a,i){if(!i.has(a))throw new TypeError("attempted to get private field on non-instance");return i.get(a)}function Aw(a,i,r){if(!i.has(a))throw new TypeError("attempted to set private field on non-instance");return i.set(a,r),r}const xw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return so},__asyncDelegator:Pw,__asyncGenerator:Sw,__asyncValues:Ow,__await:ai,__awaiter:mw,__classPrivateFieldGet:$w,__classPrivateFieldSet:Aw,__createBinding:_w,__decorate:gw,__exportStar:bw,__extends:fw,__generator:ww,__importDefault:Cw,__importStar:Nw,__makeTemplateObject:Rw,__metadata:vw,__param:yw,__read:vh,__rest:dw,__spread:Ew,__spreadArrays:Iw,__values:no},Symbol.toStringTag,{value:"Module"})),ms=hh(xw);var Zr={},Hn={},Xr={};const Tw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:or},Symbol.toStringTag,{value:"Module"})),Dw=hh(Tw);var gu;function Uw(){if(gu)return Xr;gu=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.IHeartBeat=void 0;const a=Dw;class i extends a.IEvents{constructor(s){super()}}return Xr.IHeartBeat=i,Xr}var yu;function mh(){return yu||(yu=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),ms.__exportStar(Uw(),a)}(Hn)),Hn}var Fn={},ir={},vu;function qw(){if(vu)return ir;vu=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.HEARTBEAT_EVENTS=ir.HEARTBEAT_INTERVAL=void 0;const a=T;return ir.HEARTBEAT_INTERVAL=a.FIVE_SECONDS,ir.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ir}var mu;function wh(){return mu||(mu=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),ms.__exportStar(qw(),a)}(Fn)),Fn}var wu;function jw(){if(wu)return Zr;wu=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.HeartBeat=void 0;const a=ms,i=pt,r=T,s=mh(),o=wh();class u extends s.IHeartBeat{constructor(g){super(g),this.events=new i.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=g?.interval||o.HEARTBEAT_INTERVAL}static init(g){return a.__awaiter(this,void 0,void 0,function*(){const w=new u(g);return yield w.init(),w})}init(){return a.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return a.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Zr.HeartBeat=u,Zr}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const i=ms;i.__exportStar(jw(),a),i.__exportStar(mh(),a),i.__exportStar(wh(),a)})(Nr);class Mw extends or{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class kw extends or{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class zw{constructor(i,r){this.logger=i,this.core=r}}let Lw=class extends or{constructor(i,r){super(),this.relayer=i,this.logger=r}},Vw=class extends or{constructor(i){super()}},Kw=class{constructor(i,r,s,o){this.core=i,this.logger=r,this.name=s}};class Hw extends or{constructor(i,r){super(),this.relayer=i,this.logger=r}}let Fw=class extends or{constructor(i,r){super(),this.core=i,this.logger=r}},Ww=class{constructor(i,r){this.projectId=i,this.logger=r}},Bw=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},Gw=class{constructor(i){this.client=i}};function _h(a,i){return a.includes(":")?[a]:i.chains||[]}const bh="base10",$e="base16",oo="base64pad",Io="utf8",Eh=0,cr=1,Jw=0,_u=1,ao=12,So=32;function Qw(){const a=ph.generateKeyPair();return{privateKey:rt(a.secretKey,$e),publicKey:rt(a.publicKey,$e)}}function co(){const a=fh.randomBytes(So);return rt(a,$e)}function Yw(a,i){const r=ph.sharedKey(lt(a,$e),lt(i,$e)),s=new Ym(mo.SHA256,r).expand(So);return rt(s,$e)}function Zw(a){const i=mo.hash(lt(a,$e));return rt(i,$e)}function Or(a){const i=mo.hash(lt(a,Io));return rt(i,$e)}function Xw(a){return lt(`${a}`,bh)}function ci(a){return Number(rt(a,bh))}function e_(a){const i=Xw(typeof a.type<"u"?a.type:Eh);if(ci(i)===cr&&typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof a.senderPublicKey<"u"?lt(a.senderPublicKey,$e):void 0,s=typeof a.iv<"u"?lt(a.iv,$e):fh.randomBytes(ao),o=new dh.ChaCha20Poly1305(lt(a.symKey,$e)).seal(s,lt(a.message,Io));return r_({type:i,sealed:o,iv:s,senderPublicKey:r})}function t_(a){const i=new dh.ChaCha20Poly1305(lt(a.symKey,$e)),{sealed:r,iv:s}=hs(a.encoded),o=i.open(s,r);if(o===null)throw new Error("Failed to decrypt");return rt(o,Io)}function r_(a){if(ci(a.type)===cr){if(typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return rt(pu([a.type,a.senderPublicKey,a.iv,a.sealed]),oo)}return rt(pu([a.type,a.iv,a.sealed]),oo)}function hs(a){const i=lt(a,oo),r=i.slice(Jw,_u),s=_u;if(ci(r)===cr){const g=s+So,w=g+ao,b=i.slice(s,g),N=i.slice(g,w),$=i.slice(w);return{type:r,sealed:$,iv:N,senderPublicKey:b}}const o=s+ao,u=i.slice(s,o),p=i.slice(o);return{type:r,sealed:p,iv:u}}function i_(a,i){const r=hs(a);return Ih({type:ci(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?rt(r.senderPublicKey,$e):void 0,receiverPublicKey:i?.receiverPublicKey})}function Ih(a){const i=a?.type||Eh;if(i===cr){if(typeof a?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:i,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function bu(a){return a.type===cr&&typeof a.senderPublicKey=="string"&&typeof a.receiverPublicKey=="string"}var s_=Object.defineProperty,Eu=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,o_=Object.prototype.propertyIsEnumerable,Iu=(a,i,r)=>i in a?s_(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Su=(a,i)=>{for(var r in i||(i={}))n_.call(i,r)&&Iu(a,r,i[r]);if(Eu)for(var r of Eu(i))o_.call(i,r)&&Iu(a,r,i[r]);return a};const a_="ReactNative",Kt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},c_="js";function Po(){return typeof Kn<"u"&&typeof Kn.versions<"u"&&typeof Kn.versions.node<"u"}function Sh(){return!Zm()&&!!lh()&&navigator.product===a_}function Oo(){return!Po()&&!!lh()}function Ro(){return Sh()?Kt.reactNative:Po()?Kt.node:Oo()?Kt.browser:Kt.unknown}function u_(a,i){let r=us.parse(a);return r=Su(Su({},r),i),a=us.stringify(r),a}function h_(){return Qm()||{name:"",description:"",url:"",icons:[""]}}function l_(){if(Ro()===Kt.reactNative&&typeof je<"u"&&typeof(je==null?void 0:je.Platform)<"u"){const{OS:r,Version:s}=je.Platform;return[r,s].join("-")}const a=ew();if(a===null)return"unknown";const i=a.os?a.os.replace(" ","").toLowerCase():"unknown";return a.type==="browser"?[i,a.name,a.version].join("-"):[i,a.version].join("-")}function p_(){var a;const i=Ro();return i===Kt.browser?[i,((a=tw())==null?void 0:a.host)||"unknown"].join(":"):i}function f_(a,i,r){const s=l_(),o=p_();return[[a,i].join("-"),[c_,r].join("-"),s,o].join("/")}function d_({protocol:a,version:i,relayUrl:r,sdkVersion:s,auth:o,projectId:u,useOnCloseEvent:p}){const g=r.split("?"),w=f_(a,i,s),b={auth:o,ua:w,projectId:u,useOnCloseEvent:p||void 0},N=u_(g[1]||"",b);return g[0]+"?"+N}function sr(a,i){return a.filter(r=>i.includes(r)).length===a.length}function Ph(a){return Object.fromEntries(a.entries())}function Oh(a){return new Map(Object.entries(a))}function Pr(a=T.FIVE_MINUTES,i){const r=T.toMiliseconds(a||T.FIVE_MINUTES);let s,o,u;return{resolve:p=>{u&&s&&(clearTimeout(u),s(p))},reject:p=>{u&&o&&(clearTimeout(u),o(p))},done:()=>new Promise((p,g)=>{u=setTimeout(()=>{g(new Error(i))},r),s=p,o=g})}}function ls(a,i,r){return new Promise(async(s,o)=>{const u=setTimeout(()=>o(new Error(r)),i);try{const p=await a;s(p)}catch(p){o(p)}clearTimeout(u)})}function Rh(a,i){if(typeof i=="string"&&i.startsWith(`${a}:`))return i;if(a.toLowerCase()==="topic"){if(typeof i!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${i}`}else if(a.toLowerCase()==="id"){if(typeof i!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${i}`}throw new Error(`Unknown expirer target type: ${a}`)}function g_(a){return Rh("topic",a)}function y_(a){return Rh("id",a)}function Nh(a){const[i,r]=a.split(":"),s={id:void 0,topic:void 0};if(i==="topic"&&typeof r=="string")s.topic=r;else if(i==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${i}:${r}`);return s}function ht(a,i){return T.fromMiliseconds(Date.now()+T.toMiliseconds(a))}function Vt(a){return Date.now()>=T.toMiliseconds(a)}function fe(a,i){return`${a}${i?`:${i}`:""}`}function Wn(a=[],i=[]){return[...new Set([...a,...i])]}async function v_({id:a,topic:i,wcDeepLink:r}){try{if(!r)return;let o=(typeof r=="string"?JSON.parse(r):r)?.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const u=`${o}/wc?requestId=${a}&sessionTopic=${i}`,p=Ro();p===Kt.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):p===Kt.reactNative&&typeof(je==null?void 0:je.Linking)<"u"&&await je.Linking.openURL(u)}catch(s){console.error(s)}}const m_="irn";function uo(a){return a?.relay||{protocol:m_}}function os(a){const i=Xm[a];if(typeof i>"u")throw new Error(`Relay Protocol not supported: ${a}`);return i}var w_=Object.defineProperty,Pu=Object.getOwnPropertySymbols,__=Object.prototype.hasOwnProperty,b_=Object.prototype.propertyIsEnumerable,Ou=(a,i,r)=>i in a?w_(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,E_=(a,i)=>{for(var r in i||(i={}))__.call(i,r)&&Ou(a,r,i[r]);if(Pu)for(var r of Pu(i))b_.call(i,r)&&Ou(a,r,i[r]);return a};function I_(a,i="-"){const r={},s="relay"+i;return Object.keys(a).forEach(o=>{if(o.startsWith(s)){const u=o.replace(s,""),p=a[o];r[u]=p}}),r}function S_(a){const i=a.indexOf(":"),r=a.indexOf("?")!==-1?a.indexOf("?"):void 0,s=a.substring(0,i),o=a.substring(i+1,r).split("@"),u=typeof r<"u"?a.substring(r):"",p=us.parse(u);return{protocol:s,topic:P_(o[0]),version:parseInt(o[1],10),symKey:p.symKey,relay:I_(p)}}function P_(a){return a.startsWith("//")?a.substring(2):a}function O_(a,i="-"){const r="relay",s={};return Object.keys(a).forEach(o=>{const u=r+i+o;a[o]&&(s[u]=a[o])}),s}function R_(a){return`${a.protocol}:${a.topic}@${a.version}?`+us.stringify(E_({symKey:a.symKey},O_(a.relay)))}function Cr(a){const i=[];return a.forEach(r=>{const[s,o]=r.split(":");i.push(`${s}:${o}`)}),i}function N_(a){const i=[];return Object.values(a).forEach(r=>{i.push(...Cr(r.accounts))}),i}function C_(a,i){const r=[];return Object.values(a).forEach(s=>{Cr(s.accounts).includes(i)&&r.push(...s.methods)}),r}function $_(a,i){const r=[];return Object.values(a).forEach(s=>{Cr(s.accounts).includes(i)&&r.push(...s.events)}),r}function A_(a,i){const r=cs(a,i);if(r)throw new Error(r.message);const s={};for(const[o,u]of Object.entries(a))s[o]={methods:u.methods,events:u.events,chains:u.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return s}function No(a){return a.includes(":")}function as(a){return No(a)?a.split(":")[0]:a}const x_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},T_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function R(a,i){const{message:r,code:s}=T_[a];return{message:i?`${r} ${i}`:r,code:s}}function de(a,i){const{message:r,code:s}=x_[a];return{message:i?`${r} ${i}`:r,code:s}}function nr(a,i){return!!Array.isArray(a)}function Rr(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function qe(a){return typeof a>"u"}function me(a,i){return i&&qe(a)?!0:typeof a=="string"&&!!a.trim().length}function Co(a,i){return typeof a=="number"&&!isNaN(a)}function D_(a,i){const{requiredNamespaces:r}=i,s=Object.keys(a.namespaces),o=Object.keys(r);let u=!0;return sr(o,s)?(s.forEach(p=>{const{accounts:g,methods:w,events:b}=a.namespaces[p],N=Cr(g),$=r[p];(!sr(_h(p,$),N)||!sr($.methods,w)||!sr($.events,b))&&(u=!1)}),u):!1}function ps(a){return me(a,!1)&&a.includes(":")?a.split(":").length===2:!1}function U_(a){if(me(a,!1)&&a.includes(":")){const i=a.split(":");if(i.length===3){const r=i[0]+":"+i[1];return!!i[2]&&ps(r)}}return!1}function q_(a){if(me(a,!1))try{return typeof new URL(a)<"u"}catch{return!1}return!1}function j_(a){var i;return(i=a?.proposer)==null?void 0:i.publicKey}function M_(a){return a?.topic}function k_(a,i){let r=null;return me(a?.publicKey,!1)||(r=R("MISSING_OR_INVALID",`${i} controller public key should be a string`)),r}function Ru(a){let i=!0;return nr(a)?a.length&&(i=a.every(r=>me(r,!1))):i=!1,i}function z_(a,i,r){let s=null;return nr(i)&&i.length?i.forEach(o=>{s||ps(o)||(s=de("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):ps(a)||(s=de("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function L_(a,i,r){let s=null;return Object.entries(a).forEach(([o,u])=>{if(s)return;const p=z_(o,_h(o,u),`${i} ${r}`);p&&(s=p)}),s}function V_(a,i){let r=null;return nr(a)?a.forEach(s=>{r||U_(s)||(r=de("UNSUPPORTED_ACCOUNTS",`${i}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=de("UNSUPPORTED_ACCOUNTS",`${i}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function K_(a,i){let r=null;return Object.values(a).forEach(s=>{if(r)return;const o=V_(s?.accounts,`${i} namespace`);o&&(r=o)}),r}function H_(a,i){let r=null;return Ru(a?.methods)?Ru(a?.events)||(r=de("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):r=de("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),r}function Ch(a,i){let r=null;return Object.values(a).forEach(s=>{if(r)return;const o=H_(s,`${i}, namespace`);o&&(r=o)}),r}function F_(a,i,r){let s=null;if(a&&Rr(a)){const o=Ch(a,i);o&&(s=o);const u=L_(a,i,r);u&&(s=u)}else s=R("MISSING_OR_INVALID",`${i}, ${r} should be an object with data`);return s}function cs(a,i){let r=null;if(a&&Rr(a)){const s=Ch(a,i);s&&(r=s);const o=K_(a,i);o&&(r=o)}else r=R("MISSING_OR_INVALID",`${i}, namespaces should be an object with data`);return r}function $h(a){return me(a.protocol,!0)}function W_(a,i){let r=!1;return a?a&&nr(a)&&a.length&&a.forEach(s=>{r=$h(s)}):r=!0,r}function B_(a){return typeof a=="number"}function Ue(a){return typeof a<"u"&&typeof a!==null}function G_(a){return!(!a||typeof a!="object"||!a.code||!Co(a.code)||!a.message||!me(a.message,!1))}function J_(a){return!(qe(a)||!me(a.method,!1))}function Q_(a){return!(qe(a)||qe(a.result)&&qe(a.error)||!Co(a.id)||!me(a.jsonrpc,!1))}function Y_(a){return!(qe(a)||!me(a.name,!1))}function Nu(a,i){return!(!ps(i)||!N_(a).includes(i))}function Z_(a,i,r){return me(r,!1)?C_(a,i).includes(r):!1}function X_(a,i,r){return me(r,!1)?$_(a,i).includes(r):!1}function Cu(a,i,r){let s=null;const o=e0(a),u=t0(i),p=Object.keys(o),g=Object.keys(u),w=$u(Object.keys(a)),b=$u(Object.keys(i)),N=w.filter($=>!b.includes($));return N.length&&(s=R("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${N.toString()}
      Received: ${Object.keys(i).toString()}`)),sr(p,g)||(s=R("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${p.toString()}
      Approved: ${g.toString()}`)),Object.keys(i).forEach($=>{if(!$.includes(":")||s)return;const A=Cr(i[$].accounts);A.includes($)||(s=R("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${$}
        Required: ${$}
        Approved: ${A.toString()}`))}),p.forEach($=>{s||(sr(o[$].methods,u[$].methods)?sr(o[$].events,u[$].events)||(s=R("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${$}`)):s=R("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${$}`))}),s}function e0(a){const i={};return Object.keys(a).forEach(r=>{var s;r.includes(":")?i[r]=a[r]:(s=a[r].chains)==null||s.forEach(o=>{i[o]={methods:a[r].methods,events:a[r].events}})}),i}function $u(a){return[...new Set(a.map(i=>i.includes(":")?i.split(":")[0]:i))]}function t0(a){const i={};return Object.keys(a).forEach(r=>{r.includes(":")?i[r]=a[r]:Cr(a[r].accounts)?.forEach(o=>{i[o]={accounts:a[r].accounts.filter(u=>u.includes(`${o}:`)),methods:a[r].methods,events:a[r].events}})}),i}function r0(a,i){return Co(a)&&a<=i.max&&a>=i.min}class Ft extends rw{constructor(i){super(i),this.events=new pt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(i),this.connection.connected&&this.registerEventListeners()}async connect(i=this.connection){await this.open(i)}async disconnect(){await this.close()}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async request(i,r){return this.requestStrict(ds(i.method,i.params||[],i.id||wo().toString()),r)}async requestStrict(i,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(u){o(u)}this.events.on(`${i.id}`,u=>{wt(u)?o(u.error):s(u.result)});try{await this.connection.send(i,r)}catch(u){o(u)}})}setConnection(i=this.connection){return i}onPayload(i){this.events.emit("payload",i),gs(i)?this.events.emit(`${i.id}`,i):this.events.emit("message",{type:i.method,data:i.params})}onClose(i){i&&i.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${i.code} ${i.reason?`(${i.reason})`:""}`)),this.events.emit("disconnect")}async open(i=this.connection){this.connection===i&&this.connection.connected||(this.connection.connected&&this.close(),typeof i=="string"&&(await this.connection.open(i),i=this.connection),this.connection=this.setConnection(i),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",i=>this.onPayload(i)),this.connection.on("close",i=>this.onClose(i)),this.connection.on("error",i=>this.events.emit("error",i)),this.connection.on("register_error",i=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const i0=()=>typeof WebSocket<"u"?WebSocket:typeof je<"u"&&typeof je.WebSocket<"u"?je.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),s0=()=>typeof WebSocket<"u"||typeof je<"u"&&typeof je.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Au=a=>a.split("?")[0],xu=10,n0=i0();class o0{constructor(i){if(this.url=i,this.events=new pt.EventEmitter,this.registering=!1,!fu(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(gh(i))}catch(s){this.onError(i.id,s)}}register(i=this.url){if(!fu(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),o(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,s)=>{const o=iw.isReactNative()?void 0:{rejectUnauthorized:!sw(i)},u=new n0(i,[],o);s0()?u.onerror=p=>{const g=p;s(this.emitError(g.error))}:u.on("error",p=>{s(this.emitError(p))}),u.onopen=()=>{this.onOpen(u),r(u)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?yh(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const s=this.parseError(r),o=s.message||s.toString(),u=_o(i,o);this.events.emit("payload",u)}parseError(i,r=this.url){return nw(i,Au(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>xu&&this.events.setMaxListeners(xu)}emitError(i){const r=this.parseError(new Error(i?.message||`WebSocket connection failed for host: ${Au(this.url)}`));return this.events.emit("register_error",r),r}}var a0={};function c0(a,i){if(a.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<a.length;o++){var u=a.charAt(o),p=u.charCodeAt(0);if(r[p]!==255)throw new TypeError(u+" is ambiguous");r[p]=o}var g=a.length,w=a.charAt(0),b=Math.log(g)/Math.log(256),N=Math.log(256)/Math.log(g);function $(j){if(j instanceof Uint8Array||(ArrayBuffer.isView(j)?j=new Uint8Array(j.buffer,j.byteOffset,j.byteLength):Array.isArray(j)&&(j=Uint8Array.from(j))),!(j instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(j.length===0)return"";for(var Z=0,re=0,ie=0,Se=j.length;ie!==Se&&j[ie]===0;)ie++,Z++;for(var Y=(Se-ie)*N+1>>>0,B=new Uint8Array(Y);ie!==Se;){for(var se=j[ie],Pe=0,ue=Y-1;(se!==0||Pe<re)&&ue!==-1;ue--,Pe++)se+=256*B[ue]>>>0,B[ue]=se%g>>>0,se=se/g>>>0;if(se!==0)throw new Error("Non-zero carry");re=Pe,ie++}for(var Oe=Y-re;Oe!==Y&&B[Oe]===0;)Oe++;for(var $t=w.repeat(Z);Oe<Y;++Oe)$t+=a.charAt(B[Oe]);return $t}function A(j){if(typeof j!="string")throw new TypeError("Expected String");if(j.length===0)return new Uint8Array;var Z=0;if(j[Z]!==" "){for(var re=0,ie=0;j[Z]===w;)re++,Z++;for(var Se=(j.length-Z)*b+1>>>0,Y=new Uint8Array(Se);j[Z];){var B=r[j.charCodeAt(Z)];if(B===255)return;for(var se=0,Pe=Se-1;(B!==0||se<ie)&&Pe!==-1;Pe--,se++)B+=g*Y[Pe]>>>0,Y[Pe]=B%256>>>0,B=B/256>>>0;if(B!==0)throw new Error("Non-zero carry");ie=se,Z++}if(j[Z]!==" "){for(var ue=Se-ie;ue!==Se&&Y[ue]===0;)ue++;for(var Oe=new Uint8Array(re+(Se-ue)),$t=re;ue!==Se;)Oe[$t++]=Y[ue++];return Oe}}}function W(j){var Z=A(j);if(Z)return Z;throw new Error(`Non-${i} character`)}return{encode:$,decodeUnsafe:A,decode:W}}var u0=c0,h0=u0;const Ah=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},l0=a=>new TextEncoder().encode(a),p0=a=>new TextDecoder().decode(a);class f0{constructor(i,r,s){this.name=i,this.prefix=r,this.baseEncode=s}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class d0{constructor(i,r,s){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return xh(this,i)}}class g0{constructor(i){this.decoders=i}or(i){return xh(this,i)}decode(i){const r=i[0],s=this.decoders[r];if(s)return s.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const xh=(a,i)=>new g0({...a.decoders||{[a.prefix]:a},...i.decoders||{[i.prefix]:i}});class y0{constructor(i,r,s,o){this.name=i,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new f0(i,r,s),this.decoder=new d0(i,r,o)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const ws=({name:a,prefix:i,encode:r,decode:s})=>new y0(a,i,r,s),ui=({prefix:a,name:i,alphabet:r})=>{const{encode:s,decode:o}=h0(r,i);return ws({prefix:a,name:i,encode:s,decode:u=>Ah(o(u))})},v0=(a,i,r,s)=>{const o={};for(let N=0;N<i.length;++N)o[i[N]]=N;let u=a.length;for(;a[u-1]==="=";)--u;const p=new Uint8Array(u*r/8|0);let g=0,w=0,b=0;for(let N=0;N<u;++N){const $=o[a[N]];if($===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|$,g+=r,g>=8&&(g-=8,p[b++]=255&w>>g)}if(g>=r||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return p},m0=(a,i,r)=>{const s=i[i.length-1]==="=",o=(1<<r)-1;let u="",p=0,g=0;for(let w=0;w<a.length;++w)for(g=g<<8|a[w],p+=8;p>r;)p-=r,u+=i[o&g>>p];if(p&&(u+=i[o&g<<r-p]),s)for(;u.length*r&7;)u+="=";return u},be=({name:a,prefix:i,bitsPerChar:r,alphabet:s})=>ws({prefix:i,name:a,encode(o){return m0(o,s,r)},decode(o){return v0(o,s,r,a)}}),w0=ws({prefix:"\0",name:"identity",encode:a=>p0(a),decode:a=>l0(a)});var _0=Object.freeze({__proto__:null,identity:w0});const b0=be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var E0=Object.freeze({__proto__:null,base2:b0});const I0=be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var S0=Object.freeze({__proto__:null,base8:I0});const P0=ui({prefix:"9",name:"base10",alphabet:"0123456789"});var O0=Object.freeze({__proto__:null,base10:P0});const R0=be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N0=be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var C0=Object.freeze({__proto__:null,base16:R0,base16upper:N0});const $0=be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),A0=be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),x0=be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),T0=be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),D0=be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),U0=be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),q0=be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),j0=be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),M0=be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var k0=Object.freeze({__proto__:null,base32:$0,base32upper:A0,base32pad:x0,base32padupper:T0,base32hex:D0,base32hexupper:U0,base32hexpad:q0,base32hexpadupper:j0,base32z:M0});const z0=ui({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),L0=ui({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var V0=Object.freeze({__proto__:null,base36:z0,base36upper:L0});const K0=ui({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),H0=ui({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var F0=Object.freeze({__proto__:null,base58btc:K0,base58flickr:H0});const W0=be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),B0=be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),G0=be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),J0=be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Q0=Object.freeze({__proto__:null,base64:W0,base64pad:B0,base64url:G0,base64urlpad:J0});const Th=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),Y0=Th.reduce((a,i,r)=>(a[r]=i,a),[]),Z0=Th.reduce((a,i,r)=>(a[i.codePointAt(0)]=r,a),[]);function X0(a){return a.reduce((i,r)=>(i+=Y0[r],i),"")}function eb(a){const i=[];for(const r of a){const s=Z0[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(s)}return new Uint8Array(i)}const tb=ws({prefix:"ðŸš€",name:"base256emoji",encode:X0,decode:eb});var rb=Object.freeze({__proto__:null,base256emoji:tb}),ib=Dh,Tu=128,sb=127,nb=~sb,ob=Math.pow(2,31);function Dh(a,i,r){i=i||[],r=r||0;for(var s=r;a>=ob;)i[r++]=a&255|Tu,a/=128;for(;a&nb;)i[r++]=a&255|Tu,a>>>=7;return i[r]=a|0,Dh.bytes=r-s+1,i}var ab=ho,cb=128,Du=127;function ho(a,s){var r=0,s=s||0,o=0,u=s,p,g=a.length;do{if(u>=g)throw ho.bytes=0,new RangeError("Could not decode varint");p=a[u++],r+=o<28?(p&Du)<<o:(p&Du)*Math.pow(2,o),o+=7}while(p>=cb);return ho.bytes=u-s,r}var ub=Math.pow(2,7),hb=Math.pow(2,14),lb=Math.pow(2,21),pb=Math.pow(2,28),fb=Math.pow(2,35),db=Math.pow(2,42),gb=Math.pow(2,49),yb=Math.pow(2,56),vb=Math.pow(2,63),mb=function(a){return a<ub?1:a<hb?2:a<lb?3:a<pb?4:a<fb?5:a<db?6:a<gb?7:a<yb?8:a<vb?9:10},wb={encode:ib,decode:ab,encodingLength:mb},Uh=wb;const Uu=(a,i,r=0)=>(Uh.encode(a,i,r),i),qu=a=>Uh.encodingLength(a),lo=(a,i)=>{const r=i.byteLength,s=qu(a),o=s+qu(r),u=new Uint8Array(o+r);return Uu(a,u,0),Uu(r,u,s),u.set(i,o),new _b(a,r,i,u)};class _b{constructor(i,r,s,o){this.code=i,this.size=r,this.digest=s,this.bytes=o}}const qh=({name:a,code:i,encode:r})=>new bb(a,i,r);class bb{constructor(i,r,s){this.name=i,this.code=r,this.encode=s}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?lo(this.code,r):r.then(s=>lo(this.code,s))}else throw Error("Unknown type, must be binary type")}}const jh=a=>async i=>new Uint8Array(await crypto.subtle.digest(a,i)),Eb=qh({name:"sha2-256",code:18,encode:jh("SHA-256")}),Ib=qh({name:"sha2-512",code:19,encode:jh("SHA-512")});var Sb=Object.freeze({__proto__:null,sha256:Eb,sha512:Ib});const Mh=0,Pb="identity",kh=Ah,Ob=a=>lo(Mh,kh(a)),Rb={code:Mh,name:Pb,encode:kh,digest:Ob};var Nb=Object.freeze({__proto__:null,identity:Rb});new TextEncoder,new TextDecoder;const ju={..._0,...E0,...S0,...O0,...C0,...k0,...V0,...F0,...Q0,...rb};({...Sb,...Nb});function zh(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function Cb(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zh(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function Lh(a,i,r,s){return{name:a,prefix:i,encoder:{name:a,prefix:i,encode:r},decoder:{decode:s}}}const Mu=Lh("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),Bn=Lh("ascii","a",a=>{let i="a";for(let r=0;r<a.length;r++)i+=String.fromCharCode(a[r]);return i},a=>{a=a.substring(1);const i=Cb(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);return i}),$b={utf8:Mu,"utf-8":Mu,hex:ju.base16,latin1:Bn,ascii:Bn,binary:Bn,...ju};function Ab(a,i="utf8"){const r=$b[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zh(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}const Vh="wc",xb=2,$o="core",Ht=`${Vh}@2:${$o}:`,Tb={name:$o,logger:"error"},Db={database:":memory:"},Ub="crypto",ku="client_ed25519_seed",qb=T.ONE_DAY,jb="keychain",Mb="0.3",kb="messages",zb="0.3",Lb=T.SIX_HOURS,Vb="publisher",Kh="irn",Kb="error",Hh="wss://relay.walletconnect.com",zu="wss://relay.walletconnect.org",Hb="relayer",ce={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Fb="_subscription",ei={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Wb=T.ONE_SECOND/2,Bb="2.9.1",Gb=1e4,Jb="0.3",Qb="WALLETCONNECT_CLIENT_ID",mt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Yb="subscription",Zb="0.3",Xb=T.FIVE_SECONDS*1e3,eE="pairing",tE="0.3",ti={wc_pairingDelete:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:T.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:T.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:T.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:T.ONE_DAY,prompt:!1,tag:0},res:{ttl:T.ONE_DAY,prompt:!1,tag:0}}},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},rE="history",iE="0.3",sE="expirer",tt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},nE="0.3",Gn="verify-api",Lu="https://verify.walletconnect.com";class oE{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=jb,this.version=Mb,this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:u}=R("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=i,this.logger=He(r,this.name)}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,Ph(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Oh(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class aE{constructor(i,r,s){this.core=i,this.logger=r,this.name=Ub,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),u=du(o);return cw(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=Qw();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const u=await this.getClientSeed(),p=du(u),g=co();return await uw(g,o,qb,p)},this.generateSharedKey=(o,u,p)=>{this.isInitialized();const g=this.getPrivateKey(o),w=Yw(g,u);return this.setSymKey(w,p)},this.setSymKey=async(o,u)=>{this.isInitialized();const p=u||Zw(o);return await this.keychain.set(p,o),p},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,u,p)=>{this.isInitialized();const g=Ih(p),w=gh(u);if(bu(g)){const A=g.senderPublicKey,W=g.receiverPublicKey;o=await this.generateSharedKey(A,W)}const b=this.getSymKey(o),{type:N,senderPublicKey:$}=g;return e_({type:N,symKey:b,message:w,senderPublicKey:$})},this.decode=async(o,u,p)=>{this.isInitialized();const g=i_(u,p);if(bu(g)){const w=g.receiverPublicKey,b=g.senderPublicKey;o=await this.generateSharedKey(w,b)}try{const w=this.getSymKey(o),b=t_({symKey:w,encoded:u});return yh(b)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=o=>{const u=hs(o);return ci(u.type)},this.getPayloadSenderPublicKey=o=>{const u=hs(o);return u.senderPublicKey?rt(u.senderPublicKey,$e):void 0},this.core=i,this.logger=He(r,this.name),this.keychain=s||new oE(this.core,this.logger)}get context(){return Fe(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(ku)}catch{i=co(),await this.keychain.set(ku,i)}return Ab(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class cE extends zw{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=kb,this.version=zb,this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const u=Or(o);let p=this.messages.get(s);return typeof p>"u"&&(p={}),typeof p[u]<"u"||(p[u]=o,this.messages.set(s,p),await this.persist()),u},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const u=this.get(s),p=Or(o);return typeof u[p]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=He(i,this.name),this.core=r}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,Ph(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Oh(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class uE extends Lw{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new pt.EventEmitter,this.name=Vb,this.queue=new Map,this.publishTimeout=T.toMiliseconds(T.TEN_SECONDS),this.queueTimeout=T.toMiliseconds(T.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,o,u)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:u}});try{const p=u?.ttl||Lb,g=uo(u),w=u?.prompt||!1,b=u?.tag||0,N=u?.id||wo().toString(),$={topic:s,message:o,opts:{ttl:p,relay:g,prompt:w,tag:b,id:N}},A=setTimeout(()=>this.queue.set(N,$),this.queueTimeout);try{await await ls(this.rpcPublish(s,o,p,g,w,b,N),this.publishTimeout),clearTimeout(A),this.relayer.events.emit(ce.publish,$)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:u}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=i,this.logger=He(r,this.name),this.registerEventListeners()}get context(){return Fe(this.logger)}rpcPublish(i,r,s,o,u,p,g){var w,b,N,$;const A={method:os(o.protocol).publish,params:{topic:i,message:r,ttl:s,prompt:u,tag:p},id:g};return qe((w=A.params)==null?void 0:w.prompt)&&((b=A.params)==null||delete b.prompt),qe((N=A.params)==null?void 0:N.tag)&&(($=A.params)==null||delete $.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:A}),this.relayer.request(A)}onPublish(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:s,opts:o}=i;await this.publish(r,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(Nr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ce.connection_stalled);return}this.checkQueue()}),this.relayer.on(ce.message_ack,i=>{this.onPublish(i.id.toString())})}}class hE{constructor(){this.map=new Map,this.set=(i,r)=>{const s=this.get(i);this.exists(i,r)||this.map.set(i,[...s,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const s=this.get(i);if(!this.exists(i,r))return;const o=s.filter(u=>u!==r);if(!o.length){this.map.delete(i);return}this.map.set(i,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var lE=Object.defineProperty,pE=Object.defineProperties,fE=Object.getOwnPropertyDescriptors,Vu=Object.getOwnPropertySymbols,dE=Object.prototype.hasOwnProperty,gE=Object.prototype.propertyIsEnumerable,Ku=(a,i,r)=>i in a?lE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ri=(a,i)=>{for(var r in i||(i={}))dE.call(i,r)&&Ku(a,r,i[r]);if(Vu)for(var r of Vu(i))gE.call(i,r)&&Ku(a,r,i[r]);return a},Jn=(a,i)=>pE(a,fE(i));class yE extends Hw{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new hE,this.events=new pt.EventEmitter,this.name=Yb,this.version=Zb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ht,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const u=uo(o),p={topic:s,relay:u};this.pending.set(s,p);const g=await this.rpcSubscribe(s,u);return this.onSubscribe(g,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof o?.id<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((o,u)=>{const p=new T.Watch;p.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),o(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=Xb&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=He(r,this.name),this.clientId=""}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let s=!1;try{s=this.getSubscription(i).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const s=this.topicMap.get(i);await Promise.all(s.map(async o=>await this.unsubscribeById(i,o,r)))}async unsubscribeById(i,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:s}});try{const o=uo(s);await this.rpcUnsubscribe(i,r,o);const u=de("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(i,r){const s={method:os(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await ls(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ce.connection_stalled)}return Or(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,s={method:os(r.protocol).batchSubscribe,params:{topics:i.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await ls(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ce.connection_stalled)}}rpcUnsubscribe(i,r,s){const o={method:os(s.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(i,r){this.setSubscription(i,Jn(ri({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,ri({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,s),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,ri({},r)),this.topicMap.set(r.topic,i),this.events.emit(mt.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const s=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(s.topic,i),this.events.emit(mt.deleted,Jn(ri({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(mt.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(mt.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);nr(r)&&this.onBatchSubscribe(r.map((s,o)=>Jn(ri({},i[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(Nr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ce.connect,async()=>{await this.onConnect()}),this.relayer.on(ce.disconnect,()=>{this.onDisconnect()}),this.events.on(mt.created,async i=>{const r=mt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(mt.deleted,async i=>{const r=mt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var vE=Object.defineProperty,Hu=Object.getOwnPropertySymbols,mE=Object.prototype.hasOwnProperty,wE=Object.prototype.propertyIsEnumerable,Fu=(a,i,r)=>i in a?vE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,_E=(a,i)=>{for(var r in i||(i={}))mE.call(i,r)&&Fu(a,r,i[r]);if(Hu)for(var r of Hu(i))wE.call(i,r)&&Fu(a,r,i[r]);return a};class bE extends Vw{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new pt.EventEmitter,this.name=Hb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?He(i.logger,this.name):ys(vs({level:i.logger||Kb})),this.messages=new cE(this.logger,i.core),this.subscriber=new yE(this,this.logger),this.publisher=new uE(this,this.logger),this.relayUrl=i?.relayUrl||Hh,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${zu}...`),await this.restartTransport(zu)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Gb)}get context(){return Fe(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,s){this.isInitialized(),await this.publisher.publish(i,r,s),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(i))==null?void 0:s[0])||"";return o||(await Promise.all([new Promise(u=>{this.subscriber.once(mt.created,p=>{p.topic===i&&u()})}),new Promise(async u=>{o=await this.subscriber.subscribe(i,r),u()})]),o)}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(ce.transport_closed))}async transportOpen(i){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=i||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(mt.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,s)=>{await ls(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>s(o)).then(()=>r()).finally(()=>this.removeListener(ce.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(ce.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.events.emit(ce.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(i){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=i||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(ei.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ft(new o0(d_({sdkVersion:Bb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:s}=i;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(i){const{topic:r,message:s}=i;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),bo(i)){if(!i.method.endsWith(Fb))return;const r=i.params,{topic:s,message:o,publishedAt:u}=r.data,p={topic:s,message:o,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(_E({type:"event",event:r.id},p)),this.events.emit(r.id,p),await this.acknowledgePayload(i),await this.onMessageEvent(p)}else gs(i)&&this.events.emit(ce.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(ce.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=Eo(i.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(ei.payload,i=>this.onProviderPayload(i)),this.provider.on(ei.connect,()=>{this.events.emit(ce.connect)}),this.provider.on(ei.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(ei.error,i=>{this.logger.error(i),this.events.emit(ce.error,i)})}registerEventListeners(){this.events.on(ce.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(ce.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},T.toMiliseconds(Wb))}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var EE=Object.defineProperty,Wu=Object.getOwnPropertySymbols,IE=Object.prototype.hasOwnProperty,SE=Object.prototype.propertyIsEnumerable,Bu=(a,i,r)=>i in a?EE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Gu=(a,i)=>{for(var r in i||(i={}))IE.call(i,r)&&Bu(a,r,i[r]);if(Wu)for(var r of Wu(i))SE.call(i,r)&&Bu(a,r,i[r]);return a};class _s extends Kw{constructor(i,r,s,o=Ht,u=void 0){super(i,r,s,o),this.core=i,this.logger=r,this.name=s,this.map=new Map,this.version=Jb,this.cached=[],this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!qe(p)?this.map.set(this.getKey(p),p):j_(p)?this.map.set(p.id,p):M_(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,g)=>{this.isInitialized(),this.map.has(p)?await this.update(p,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:g}),this.map.set(p,g),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(g=>Object.keys(p).every(w=>ow(g[w],p[w]))):this.values),this.update=async(p,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:g});const w=Gu(Gu({},this.getData(p)),g);this.map.set(p,w),await this.persist()},this.delete=async(p,g)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:g}),this.map.delete(p),await this.persist())},this.logger=He(r,this.name),this.storagePrefix=o,this.getKey=u}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class PE{constructor(i,r){this.core=i,this.logger=r,this.name=eE,this.version=tE,this.events=new vo,this.initialized=!1,this.storagePrefix=Ht,this.ignoredPayloadTypes=[cr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=co(),o=await this.core.crypto.setSymKey(s),u=ht(T.FIVE_MINUTES),p={protocol:Kh},g={topic:o,expiry:u,relay:p,active:!1},w=R_({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:p});return await this.pairings.set(o,g),await this.core.relayer.subscribe(o),this.core.expirer.set(o,u),{topic:o,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:u,relay:p}=S_(s.uri);if(this.pairings.keys.includes(o))throw new Error(`Pairing already exists: ${o}`);if(this.core.crypto.hasKeys(o))throw new Error(`Keychain already exists: ${o}`);const g=ht(T.FIVE_MINUTES),w={topic:o,relay:p,expiry:g,active:!1};return await this.pairings.set(o,w),await this.core.crypto.setSymKey(u,o),await this.core.relayer.subscribe(o,{relay:p}),this.core.expirer.set(o,g),s.activatePairing&&await this.activate({topic:o}),w},this.activate=async({topic:s})=>{this.isInitialized();const o=ht(T.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const u=await this.sendRequest(o,"wc_pairingPing",{}),{done:p,resolve:g,reject:w}=Pr();this.events.once(fe("pairing_ping",u),({error:b})=>{b?w(b):g()}),await p()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",de("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,u)=>{const p=ds(o,u),g=await this.core.crypto.encode(s,p),w=ti[o].req;return this.core.history.set(s,p),this.core.relayer.publish(s,g,w),p.id},this.sendResult=async(s,o,u)=>{const p=Eo(s,u),g=await this.core.crypto.encode(o,p),w=await this.core.history.get(o,s),b=ti[w.request.method].res;await this.core.relayer.publish(o,g,b),await this.core.history.resolve(p)},this.sendError=async(s,o,u)=>{const p=_o(s,u),g=await this.core.crypto.encode(o,p),w=await this.core.history.get(o,s),b=ti[w.request.method]?ti[w.request.method].res:ti.unregistered_method.res;await this.core.relayer.publish(o,g,b),await this.core.history.resolve(p)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,de("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>Vt(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(o,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,u);default:return this.onUnknownRpcMethodRequest(o,u)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:u}=s,p=(await this.core.history.get(o,u.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(o,u);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(s,o)=>{const{id:u}=o;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit("pairing_ping",{id:u,topic:s})}catch(p){await this.sendError(u,s,p),this.logger.error(p)}},this.onPairingPingResponse=(s,o)=>{const{id:u}=o;setTimeout(()=>{Lt(o)?this.events.emit(fe("pairing_ping",u),{}):wt(o)&&this.events.emit(fe("pairing_ping",u),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:u}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit("pairing_delete",{id:u,topic:s})}catch(p){await this.sendError(u,s,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:u,method:p}=o;try{if(this.registeredMethods.includes(p))return;const g=de("WC_METHOD_UNSUPPORTED",p);await this.sendError(u,s,g),this.logger.error(g)}catch(g){await this.sendError(u,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(de("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!Ue(s)){const{message:o}=R("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(o)}if(!q_(s.uri)){const{message:o}=R("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(o)}},this.isValidPing=async s=>{if(!Ue(s)){const{message:u}=R("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!Ue(s)){const{message:u}=R("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!me(s,!1)){const{message:o}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(Vt(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=R("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=i,this.logger=He(r,this.name),this.pairings=new _s(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Fe(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(ce.message,async i=>{const{topic:r,message:s}=i;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(r,s);bo(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):gs(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))})}registerExpirerEvents(){this.core.expirer.on(tt.expired,async i=>{const{topic:r}=Nh(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class OE extends kw{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new pt.EventEmitter,this.name=rE,this.version=iE,this.cached=[],this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:u}),this.records.has(o.id))return;const p={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:u,expiry:ht(T.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(vt.created,p)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=wt(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(vt.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(u=>{if(u.topic===s){if(typeof o<"u"&&u.id!==o)return;this.records.delete(u.id),this.events.emit(vt.deleted,u)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=He(r,this.name)}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:ds(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(s)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(vt.created,i=>{const r=vt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(vt.updated,i=>{const r=vt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(vt.deleted,i=>{const r=vt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.core.heartbeat.on(Nr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{T.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class RE extends Fw{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new pt.EventEmitter,this.name=sE,this.version=nE,this.cached=[],this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const u=this.formatTarget(s),p={target:u,expiry:o};this.expirations.set(u,p),this.checkExpiry(u,p),this.events.emit(tt.created,{target:u,expiration:p})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),u=this.getExpiration(o);this.expirations.delete(o),this.events.emit(tt.deleted,{target:o,expiration:u})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=He(r,this.name)}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return g_(i);if(typeof i=="number")return y_(i);const{message:r}=R("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(tt.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(i,r){const{expiry:s}=r;T.toMiliseconds(s)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(tt.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(Nr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(tt.created,i=>{const r=tt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(tt.expired,i=>{const r=tt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(tt.deleted,i=>{const r=tt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}}class NE extends Ww{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=Gn,this.initialized=!1,this.init=async s=>{Sh()||!Oo()||(this.verifyUrl=s?.verifyUrl||Lu,await this.createIframe())},this.register=async s=>{var o;if(this.initialized||await this.init(),!!this.iframe)try{(o=this.iframe.contentWindow)==null||o.postMessage(s.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${s.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async s=>{var o;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${s.attestationId}`);const u=this.startAbortTimer(T.FIVE_SECONDS),p=await fetch(`${this.verifyUrl}/attestation/${s.attestationId}`,{signal:this.abortController.signal});return clearTimeout(u),p.status===200?(o=await p.json())==null?void 0:o.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((s,o)=>{if(document.getElementById(Gn))return s();const u=document.createElement("iframe");u.setAttribute("id",Gn),u.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),u.style.display="none",u.addEventListener("load",()=>{this.initialized=!0,s()}),u.addEventListener("error",p=>{o(p)}),document.body.append(u),this.iframe=u}),new Promise(s=>{setTimeout(()=>s("iframe load timeout"),T.toMiliseconds(T.ONE_SECOND/2))})])}catch(s){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(s)}},this.logger=He(r,this.name),this.verifyUrl=Lu,this.abortController=new AbortController,this.isDevEnv=Po()&&a0.IS_VITEST}get context(){return Fe(this.logger)}startAbortTimer(i){return setTimeout(()=>this.abortController.abort(),T.toMiliseconds(i))}}var CE=Object.defineProperty,Ju=Object.getOwnPropertySymbols,$E=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,Qu=(a,i,r)=>i in a?CE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Yu=(a,i)=>{for(var r in i||(i={}))$E.call(i,r)&&Qu(a,r,i[r]);if(Ju)for(var r of Ju(i))AE.call(i,r)&&Qu(a,r,i[r]);return a};class Ao extends Mw{constructor(i){super(i),this.protocol=Vh,this.version=xb,this.name=$o,this.events=new pt.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=i?.projectId,this.relayUrl=i?.relayUrl||Hh;const r=typeof i?.logger<"u"&&typeof i?.logger!="string"?i.logger:ys(vs({level:i?.logger||Tb.logger}));this.logger=He(r,this.name),this.heartbeat=new Nr.HeartBeat,this.crypto=new aE(this,this.logger,i?.keychain),this.history=new OE(this,this.logger),this.expirer=new RE(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new aw(Yu(Yu({},Db),i?.storageOptions)),this.relayer=new bE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new PE(this,this.logger),this.verify=new NE(this.projectId||"",this.logger)}static async init(i){const r=new Ao(i);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(Qb,s),r}get context(){return Fe(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const xE=Ao,Fh="wc",Wh=2,Bh="client",xo=`${Fh}@${Wh}:${Bh}:`,Qn={name:Bh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},TE="WALLETCONNECT_DEEPLINK_CHOICE",DE="proposal",Gh="Proposal expired",UE="session",is=T.SEVEN_DAYS,qE="engine",ii={wc_sessionPropose:{req:{ttl:T.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1104},res:{ttl:T.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1106},res:{ttl:T.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:T.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:T.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1112},res:{ttl:T.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:T.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:T.THIRTY_SECONDS,prompt:!1,tag:1115}}},Yn={min:T.FIVE_MINUTES,max:T.SEVEN_DAYS},si={idle:"idle",active:"active"},jE="request",ME=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var kE=Object.defineProperty,zE=Object.defineProperties,LE=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,VE=Object.prototype.hasOwnProperty,KE=Object.prototype.propertyIsEnumerable,Xu=(a,i,r)=>i in a?kE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,et=(a,i)=>{for(var r in i||(i={}))VE.call(i,r)&&Xu(a,r,i[r]);if(Zu)for(var r of Zu(i))KE.call(i,r)&&Xu(a,r,i[r]);return a},Zn=(a,i)=>zE(a,LE(i));class HE extends Gw{constructor(i){super(i),this.name=qE,this.events=new vo,this.initialized=!1,this.ignoredPayloadTypes=[cr],this.requestQueue={state:si.idle,requests:[]},this.requestQueueDelay=T.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(ii)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},T.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{this.isInitialized();const s=Zn(et({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:u,optionalNamespaces:p,sessionProperties:g,relays:w}=s;let b=o,N,$=!1;if(b&&($=this.client.core.pairing.pairings.get(b).active),!b||!$){const{topic:Y,uri:B}=await this.client.core.pairing.create();b=Y,N=B}const A=await this.client.core.crypto.generateKeyPair(),W=et({requiredNamespaces:u,optionalNamespaces:p,relays:w??[{protocol:Kh}],proposer:{publicKey:A,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:j,resolve:Z,done:re}=Pr(T.FIVE_MINUTES,Gh);if(this.events.once(fe("session_connect"),async({error:Y,session:B})=>{if(Y)j(Y);else if(B){B.self.publicKey=A;const se=Zn(et({},B),{requiredNamespaces:B.requiredNamespaces,optionalNamespaces:B.optionalNamespaces});await this.client.session.set(B.topic,se),await this.setExpiry(B.topic,B.expiry),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:B.peer.metadata}),Z(se)}}),!b){const{message:Y}=R("NO_MATCHING_KEY",`connect() pairing topic: ${b}`);throw new Error(Y)}const ie=await this.sendRequest(b,"wc_sessionPropose",W),Se=ht(T.FIVE_MINUTES);return await this.setProposal(ie,et({id:ie,expiry:Se},W)),{uri:N,approval:re}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:o,namespaces:u,sessionProperties:p}=r,g=this.client.proposal.get(s);let{pairingTopic:w,proposer:b,requiredNamespaces:N,optionalNamespaces:$}=g;w=w||"",Rr(N)||(N=A_(u,"approve()"));const A=await this.client.core.crypto.generateKeyPair(),W=b.publicKey,j=await this.client.core.crypto.generateSharedKey(A,W);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:b.metadata}),await this.sendResult(s,w,{relay:{protocol:o??"irn"},responderPublicKey:A}),await this.client.proposal.delete(s,de("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const Z=et({relay:{protocol:o??"irn"},namespaces:u,requiredNamespaces:N,optionalNamespaces:$,pairingTopic:w,controller:{publicKey:A,metadata:this.client.metadata},expiry:ht(is)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(j),await this.sendRequest(j,"wc_sessionSettle",Z);const re=Zn(et({},Z),{topic:j,pairingTopic:w,acknowledged:!1,self:Z.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:A});return await this.client.session.set(j,re),await this.setExpiry(j,ht(is)),{topic:j,acknowledged:()=>new Promise(ie=>setTimeout(()=>ie(this.client.session.get(j)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:s,reason:o}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,o),await this.client.proposal.delete(s,de("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:o}=r,u=await this.sendRequest(s,"wc_sessionUpdate",{namespaces:o}),{done:p,resolve:g,reject:w}=Pr();return this.events.once(fe("session_update",u),({error:b})=>{b?w(b):g()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:p}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,o=await this.sendRequest(s,"wc_sessionExtend",{}),{done:u,resolve:p,reject:g}=Pr();return this.events.once(fe("session_extend",o),({error:w})=>{w?g(w):p()}),await this.setExpiry(s,ht(is)),{acknowledged:u}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:o,topic:u,expiry:p}=r,g=await this.sendRequest(u,"wc_sessionRequest",{request:o,chainId:s},p),{done:w,resolve:b,reject:N}=Pr(p);this.events.once(fe("session_request",g),({error:A,result:W})=>{A?N(A):b(W)}),this.client.events.emit("session_request_sent",{topic:u,request:o,chainId:s,id:g});const $=await this.client.core.storage.getItem(TE);return v_({id:g,topic:u,wcDeepLink:$}),await w()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:o}=r,{id:u}=o;Lt(o)?await this.sendResult(u,s,o.result):wt(o)&&await this.sendError(u,s,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=await this.sendRequest(s,"wc_sessionPing",{}),{done:u,resolve:p,reject:g}=Pr();this.events.once(fe("session_ping",o),({error:w})=>{w?g(w):p()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:o,chainId:u}=r;await this.sendRequest(s,"wc_sessionEvent",{event:o,chainId:u})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=wo().toString();let u;const p=g=>{g?.id.toString()===o&&(this.client.core.relayer.events.removeListener(ce.message_ack,p),u())};await Promise.all([new Promise(g=>{u=g,this.client.core.relayer.on(ce.message_ack,p)}),this.sendRequest(s,"wc_sessionDelete",de("USER_DISCONNECTED"),void 0,o)]),await this.deleteSession(s)}else await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>D_(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(u=>{var p,g;return((p=u.peerMetadata)==null?void 0:p.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,de("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r)},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,de("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),o?Promise.resolve():this.client.core.expirer.del(r)]),this.requestQueue.requests=this.requestQueue.requests.filter(u=>u.id!==r),o&&(this.requestQueue.state=si.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=ii.wc_sessionRequest.req.ttl,{id:o,topic:u,params:p}=r;await this.client.pendingRequest.set(o,{id:o,topic:u,params:p}),s&&this.client.core.expirer.set(o,ht(s))},this.sendRequest=async(r,s,o,u,p)=>{const g=ds(s,o);if(Oo()&&ME.includes(s)){const N=Or(JSON.stringify(g));await this.client.core.verify.register({attestationId:N})}const w=await this.client.core.crypto.encode(r,g),b=ii[s].req;return u&&(b.ttl=u),p&&(b.id=p),this.client.core.history.set(r,g),this.client.core.relayer.publish(r,w,b),g.id},this.sendResult=async(r,s,o)=>{const u=Eo(r,o),p=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),w=ii[g.request.method].res;this.client.core.relayer.publish(s,p,w),await this.client.core.history.resolve(u)},this.sendError=async(r,s,o)=>{const u=_o(r,o),p=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),w=ii[g.request.method].res;this.client.core.relayer.publish(s,p,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(o=>{Vt(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Vt(o.expiry)&&s.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=r=>{const{topic:s,payload:o}=r,u=o.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,u=(await this.client.core.history.get(s,o.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:o}=R("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,s)=>{const{params:o,id:u}=s;try{this.isValidConnect(et({},s.params));const p=ht(T.FIVE_MINUTES),g=et({id:u,pairingTopic:r,expiry:p},o);await this.setProposal(u,g);const w=Or(JSON.stringify(s)),b=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:b})}catch(p){await this.sendError(u,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,s)=>{const{id:o}=s;if(Lt(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const p=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const g=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const b=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:b});const N=await this.client.core.relayer.subscribe(b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:N}),await this.client.core.pairing.activate({topic:r})}else wt(s)&&(await this.client.proposal.delete(o,de("USER_DISCONNECTED")),this.events.emit(fe("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:o,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:p,controller:g,expiry:w,namespaces:b,requiredNamespaces:N,optionalNamespaces:$,sessionProperties:A,pairingTopic:W}=s.params,j=et({topic:r,relay:p,expiry:w,namespaces:b,acknowledged:!0,pairingTopic:W,requiredNamespaces:N,optionalNamespaces:$,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},A&&{sessionProperties:A});await this.sendResult(s.id,r,!0),this.events.emit(fe("session_connect"),{session:j}),this.cleanupDuplicatePairings(j)}catch(p){await this.sendError(o,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,s)=>{const{id:o}=s;Lt(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(fe("session_approve",o),{})):wt(s)&&(await this.client.session.delete(r,de("USER_DISCONNECTED")),this.events.emit(fe("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:o,id:u}=s;try{this.isValidUpdate(et({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult(u,r,!0),this.client.events.emit("session_update",{id:u,topic:r,params:o})}catch(p){await this.sendError(u,r,p),this.client.logger.error(p)}},this.onSessionUpdateResponse=(r,s)=>{const{id:o}=s;Lt(s)?this.events.emit(fe("session_update",o),{}):wt(s)&&this.events.emit(fe("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:o}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,ht(is)),await this.sendResult(o,r,!0),this.client.events.emit("session_extend",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:o}=s;Lt(s)?this.events.emit(fe("session_extend",o),{}):wt(s)&&this.events.emit(fe("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.client.events.emit("session_ping",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{Lt(s)?this.events.emit(fe("session_ping",o),{}):wt(s)&&this.events.emit(fe("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(ce.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult(o,r,!0)]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:o,params:u}=s;try{this.isValidRequest(et({topic:r},u)),await this.setPendingSessionRequest({id:o,topic:r,params:u}),this.addRequestToQueue({id:o,topic:r,params:u}),await this.processRequestQueue()}catch(p){await this.sendError(o,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,s)=>{const{id:o}=s;Lt(s)?this.events.emit(fe("session_request",o),{result:s.result}):wt(s)&&this.events.emit(fe("session_request",o),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:o,params:u}=s;try{this.isValidEmit(et({topic:r},u)),this.client.events.emit("session_event",{id:o,topic:r,params:u})}catch(p){await this.sendError(o,r,p),this.client.logger.error(p)}},this.addRequestToQueue=r=>{this.requestQueue.requests.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=si.idle,this.processRequestQueue()},T.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===si.active){this.client.logger.info("session request queue is already active.");return}const r=this.requestQueue.requests[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:s,topic:o,params:u}=r,p=Or(JSON.stringify({id:s,params:u})),g=this.client.session.get(o),w=await this.getVerifyContext(p,g.peer.metadata);this.requestQueue.state=si.active,this.client.events.emit("session_request",{id:s,topic:o,params:u,verifyContext:w})}catch(s){this.client.logger.error(s)}},this.isValidConnect=async r=>{if(!Ue(r)){const{message:w}=R("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:u,sessionProperties:p,relays:g}=r;if(qe(s)||await this.isValidPairingTopic(s),!W_(g)){const{message:w}=R("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!qe(o)&&Rr(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!qe(u)&&Rr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),qe(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(r,s)=>{const o=F_(r,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!Ue(r))throw new Error(R("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:o,relayProtocol:u,sessionProperties:p}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),w=cs(o,"approve()");if(w)throw new Error(w.message);const b=Cu(g.requiredNamespaces,o,"approve()");if(b)throw new Error(b.message);if(!me(u,!0)){const{message:N}=R("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(N)}qe(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async r=>{if(!Ue(r)){const{message:u}=R("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:o}=r;if(await this.isValidProposalId(s),!G_(o)){const{message:u}=R("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!Ue(r)){const{message:b}=R("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(b)}const{relay:s,controller:o,namespaces:u,expiry:p}=r;if(!$h(s)){const{message:b}=R("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(b)}const g=k_(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=cs(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Vt(p)){const{message:b}=R("EXPIRED","onSessionSettleRequest()");throw new Error(b)}},this.isValidUpdate=async r=>{if(!Ue(r)){const{message:w}=R("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:o}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),p=cs(o,"update()");if(p)throw new Error(p.message);const g=Cu(u.requiredNamespaces,o,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!Ue(r)){const{message:o}=R("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!Ue(r)){const{message:w}=R("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:o,chainId:u,expiry:p}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!Nu(g,u)){const{message:w}=R("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!J_(o)){const{message:w}=R("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!Z_(g,u,o.method)){const{message:w}=R("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(p&&!r0(p,Yn)){const{message:w}=R("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${Yn.min} and ${Yn.max}`);throw new Error(w)}},this.isValidRespond=async r=>{if(!Ue(r)){const{message:u}=R("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(u)}const{topic:s,response:o}=r;if(await this.isValidSessionTopic(s),!Q_(o)){const{message:u}=R("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(u)}},this.isValidPing=async r=>{if(!Ue(r)){const{message:o}=R("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!Ue(r)){const{message:g}=R("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:o,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!Nu(p,u)){const{message:g}=R("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!Y_(o)){const{message:g}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}if(!X_(p,u,o.name)){const{message:g}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!Ue(r)){const{message:o}=R("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const o={verified:{verifyUrl:s.verifyUrl||"",validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(o.verified.origin=u,o.verified.validation=u===s.url?"VALID":"INVALID")}catch(u){this.client.logger.error(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(o=>{if(!me(o,!1)){const{message:u}=R("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(u)}})}}isInitialized(){if(!this.initialized){const{message:i}=R("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(ce.message,async i=>{const{topic:r,message:s}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(r,s);bo(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):gs(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})})}registerExpirerEvents(){this.client.core.expirer.on(tt.expired,async i=>{const{topic:r,id:s}=Nh(i.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,R("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}isValidPairingTopic(i){if(!me(i,!1)){const{message:r}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(Vt(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=R("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!me(i,!1)){const{message:r}=R("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=R("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(Vt(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=R("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(me(i,!1)){const{message:r}=R("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=R("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!B_(i)){const{message:r}=R("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=R("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(Vt(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=R("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class FE extends _s{constructor(i,r){super(i,r,DE,xo),this.core=i,this.logger=r}}class WE extends _s{constructor(i,r){super(i,r,UE,xo),this.core=i,this.logger=r}}class BE extends _s{constructor(i,r){super(i,r,jE,xo,s=>s.id),this.core=i,this.logger=r}}let GE=class Jh extends Bw{constructor(i){super(i),this.protocol=Fh,this.version=Wh,this.name=Qn.name,this.events=new pt.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=i?.name||Qn.name,this.metadata=i?.metadata||h_();const r=typeof i?.logger<"u"&&typeof i?.logger!="string"?i.logger:ys(vs({level:i?.logger||Qn.logger}));this.core=i?.core||new xE(i),this.logger=He(r,this.name),this.session=new WE(this.core,this.logger),this.proposal=new FE(this.core,this.logger),this.pendingRequest=new BE(this.core,this.logger),this.engine=new HE(this)}static async init(i){const r=new Jh(i);return await r.initialize(),r}get context(){return Fe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const eh="error",JE="wss://relay.walletconnect.com",QE="wc",YE="universal_provider",th=`${QE}@2:${YE}:`,ZE="https://rpc.walletconnect.com/v1",Wt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof je<"u"?je:typeof self<"u"?self:{},po={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,i){(function(){var r,s="4.17.21",o=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,N="__lodash_placeholder__",$=1,A=2,W=4,j=1,Z=2,re=1,ie=2,Se=4,Y=8,B=16,se=32,Pe=64,ue=128,Oe=256,$t=512,Xh=30,el="...",tl=800,rl=16,Do=1,il=2,sl=3,Bt=1/0,At=9007199254740991,nl=17976931348623157e292,hi=NaN,ft=4294967295,ol=ft-1,al=ft>>>1,cl=[["ary",ue],["bind",re],["bindKey",ie],["curry",Y],["curryRight",B],["flip",$t],["partial",se],["partialRight",Pe],["rearg",Oe]],ur="[object Arguments]",li="[object Array]",ul="[object AsyncFunction]",$r="[object Boolean]",Ar="[object Date]",hl="[object DOMException]",pi="[object Error]",fi="[object Function]",Uo="[object GeneratorFunction]",st="[object Map]",xr="[object Number]",ll="[object Null]",_t="[object Object]",qo="[object Promise]",pl="[object Proxy]",Tr="[object RegExp]",nt="[object Set]",Dr="[object String]",di="[object Symbol]",fl="[object Undefined]",Ur="[object WeakMap]",dl="[object WeakSet]",qr="[object ArrayBuffer]",hr="[object DataView]",bs="[object Float32Array]",Es="[object Float64Array]",Is="[object Int8Array]",Ss="[object Int16Array]",Ps="[object Int32Array]",Os="[object Uint8Array]",Rs="[object Uint8ClampedArray]",Ns="[object Uint16Array]",Cs="[object Uint32Array]",gl=/\b__p \+= '';/g,yl=/\b(__p \+=) '' \+/g,vl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,jo=/&(?:amp|lt|gt|quot|#39);/g,Mo=/[&<>"']/g,ml=RegExp(jo.source),wl=RegExp(Mo.source),_l=/<%-([\s\S]+?)%>/g,bl=/<%([\s\S]+?)%>/g,ko=/<%=([\s\S]+?)%>/g,El=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Il=/^\w*$/,Sl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$s=/[\\^$.*+?()[\]{}|]/g,Pl=RegExp($s.source),As=/^\s+/,Ol=/\s/,Rl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Nl=/\{\n\/\* \[wrapped with (.+)\] \*/,Cl=/,? & /,$l=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Al=/[()=,{}\[\]\/\s]/,xl=/\\(\\)?/g,Tl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,zo=/\w*$/,Dl=/^[-+]0x[0-9a-f]+$/i,Ul=/^0b[01]+$/i,ql=/^\[object .+?Constructor\]$/,jl=/^0o[0-7]+$/i,Ml=/^(?:0|[1-9]\d*)$/,kl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gi=/($^)/,zl=/['\n\r\u2028\u2029\\]/g,yi="\\ud800-\\udfff",Ll="\\u0300-\\u036f",Vl="\\ufe20-\\ufe2f",Kl="\\u20d0-\\u20ff",Lo=Ll+Vl+Kl,Vo="\\u2700-\\u27bf",Ko="a-z\\xdf-\\xf6\\xf8-\\xff",Hl="\\xac\\xb1\\xd7\\xf7",Fl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Wl="\\u2000-\\u206f",Bl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ho="A-Z\\xc0-\\xd6\\xd8-\\xde",Fo="\\ufe0e\\ufe0f",Wo=Hl+Fl+Wl+Bl,xs="['â€™]",Gl="["+yi+"]",Bo="["+Wo+"]",vi="["+Lo+"]",Go="\\d+",Jl="["+Vo+"]",Jo="["+Ko+"]",Qo="[^"+yi+Wo+Go+Vo+Ko+Ho+"]",Ts="\\ud83c[\\udffb-\\udfff]",Ql="(?:"+vi+"|"+Ts+")",Yo="[^"+yi+"]",Ds="(?:\\ud83c[\\udde6-\\uddff]){2}",Us="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+Ho+"]",Zo="\\u200d",Xo="(?:"+Jo+"|"+Qo+")",Yl="(?:"+lr+"|"+Qo+")",ea="(?:"+xs+"(?:d|ll|m|re|s|t|ve))?",ta="(?:"+xs+"(?:D|LL|M|RE|S|T|VE))?",ra=Ql+"?",ia="["+Fo+"]?",Zl="(?:"+Zo+"(?:"+[Yo,Ds,Us].join("|")+")"+ia+ra+")*",Xl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ep="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",sa=ia+ra+Zl,tp="(?:"+[Jl,Ds,Us].join("|")+")"+sa,rp="(?:"+[Yo+vi+"?",vi,Ds,Us,Gl].join("|")+")",ip=RegExp(xs,"g"),sp=RegExp(vi,"g"),qs=RegExp(Ts+"(?="+Ts+")|"+rp+sa,"g"),np=RegExp([lr+"?"+Jo+"+"+ea+"(?="+[Bo,lr,"$"].join("|")+")",Yl+"+"+ta+"(?="+[Bo,lr+Xo,"$"].join("|")+")",lr+"?"+Xo+"+"+ea,lr+"+"+ta,ep,Xl,Go,tp].join("|"),"g"),op=RegExp("["+Zo+yi+Lo+Fo+"]"),ap=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,cp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],up=-1,te={};te[bs]=te[Es]=te[Is]=te[Ss]=te[Ps]=te[Os]=te[Rs]=te[Ns]=te[Cs]=!0,te[ur]=te[li]=te[qr]=te[$r]=te[hr]=te[Ar]=te[pi]=te[fi]=te[st]=te[xr]=te[_t]=te[Tr]=te[nt]=te[Dr]=te[Ur]=!1;var ee={};ee[ur]=ee[li]=ee[qr]=ee[hr]=ee[$r]=ee[Ar]=ee[bs]=ee[Es]=ee[Is]=ee[Ss]=ee[Ps]=ee[st]=ee[xr]=ee[_t]=ee[Tr]=ee[nt]=ee[Dr]=ee[di]=ee[Os]=ee[Rs]=ee[Ns]=ee[Cs]=!0,ee[pi]=ee[fi]=ee[Ur]=!1;var hp={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"s"},lp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},fp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},dp=parseFloat,gp=parseInt,na=typeof ni=="object"&&ni&&ni.Object===Object&&ni,yp=typeof self=="object"&&self&&self.Object===Object&&self,we=na||yp||Function("return this")(),js=i&&!i.nodeType&&i,Gt=js&&!0&&a&&!a.nodeType&&a,oa=Gt&&Gt.exports===js,Ms=oa&&na.process,We=function(){try{var v=Gt&&Gt.require&&Gt.require("util").types;return v||Ms&&Ms.binding&&Ms.binding("util")}catch{}}(),aa=We&&We.isArrayBuffer,ca=We&&We.isDate,ua=We&&We.isMap,ha=We&&We.isRegExp,la=We&&We.isSet,pa=We&&We.isTypedArray;function Me(v,E,_){switch(_.length){case 0:return v.call(E);case 1:return v.call(E,_[0]);case 2:return v.call(E,_[0],_[1]);case 3:return v.call(E,_[0],_[1],_[2])}return v.apply(E,_)}function vp(v,E,_,C){for(var M=-1,G=v==null?0:v.length;++M<G;){var ge=v[M];E(C,ge,_(ge),v)}return C}function Be(v,E){for(var _=-1,C=v==null?0:v.length;++_<C&&E(v[_],_,v)!==!1;);return v}function mp(v,E){for(var _=v==null?0:v.length;_--&&E(v[_],_,v)!==!1;);return v}function fa(v,E){for(var _=-1,C=v==null?0:v.length;++_<C;)if(!E(v[_],_,v))return!1;return!0}function xt(v,E){for(var _=-1,C=v==null?0:v.length,M=0,G=[];++_<C;){var ge=v[_];E(ge,_,v)&&(G[M++]=ge)}return G}function mi(v,E){var _=v==null?0:v.length;return!!_&&pr(v,E,0)>-1}function ks(v,E,_){for(var C=-1,M=v==null?0:v.length;++C<M;)if(_(E,v[C]))return!0;return!1}function ne(v,E){for(var _=-1,C=v==null?0:v.length,M=Array(C);++_<C;)M[_]=E(v[_],_,v);return M}function Tt(v,E){for(var _=-1,C=E.length,M=v.length;++_<C;)v[M+_]=E[_];return v}function zs(v,E,_,C){var M=-1,G=v==null?0:v.length;for(C&&G&&(_=v[++M]);++M<G;)_=E(_,v[M],M,v);return _}function wp(v,E,_,C){var M=v==null?0:v.length;for(C&&M&&(_=v[--M]);M--;)_=E(_,v[M],M,v);return _}function Ls(v,E){for(var _=-1,C=v==null?0:v.length;++_<C;)if(E(v[_],_,v))return!0;return!1}var _p=Vs("length");function bp(v){return v.split("")}function Ep(v){return v.match($l)||[]}function da(v,E,_){var C;return _(v,function(M,G,ge){if(E(M,G,ge))return C=G,!1}),C}function wi(v,E,_,C){for(var M=v.length,G=_+(C?1:-1);C?G--:++G<M;)if(E(v[G],G,v))return G;return-1}function pr(v,E,_){return E===E?Dp(v,E,_):wi(v,ga,_)}function Ip(v,E,_,C){for(var M=_-1,G=v.length;++M<G;)if(C(v[M],E))return M;return-1}function ga(v){return v!==v}function ya(v,E){var _=v==null?0:v.length;return _?Hs(v,E)/_:hi}function Vs(v){return function(E){return E==null?r:E[v]}}function Ks(v){return function(E){return v==null?r:v[E]}}function va(v,E,_,C,M){return M(v,function(G,ge,X){_=C?(C=!1,G):E(_,G,ge,X)}),_}function Sp(v,E){var _=v.length;for(v.sort(E);_--;)v[_]=v[_].value;return v}function Hs(v,E){for(var _,C=-1,M=v.length;++C<M;){var G=E(v[C]);G!==r&&(_=_===r?G:_+G)}return _}function Fs(v,E){for(var _=-1,C=Array(v);++_<v;)C[_]=E(_);return C}function Pp(v,E){return ne(E,function(_){return[_,v[_]]})}function ma(v){return v&&v.slice(0,Ea(v)+1).replace(As,"")}function ke(v){return function(E){return v(E)}}function Ws(v,E){return ne(E,function(_){return v[_]})}function jr(v,E){return v.has(E)}function wa(v,E){for(var _=-1,C=v.length;++_<C&&pr(E,v[_],0)>-1;);return _}function _a(v,E){for(var _=v.length;_--&&pr(E,v[_],0)>-1;);return _}function Op(v,E){for(var _=v.length,C=0;_--;)v[_]===E&&++C;return C}var Rp=Ks(hp),Np=Ks(lp);function Cp(v){return"\\"+fp[v]}function $p(v,E){return v==null?r:v[E]}function fr(v){return op.test(v)}function Ap(v){return ap.test(v)}function xp(v){for(var E,_=[];!(E=v.next()).done;)_.push(E.value);return _}function Bs(v){var E=-1,_=Array(v.size);return v.forEach(function(C,M){_[++E]=[M,C]}),_}function ba(v,E){return function(_){return v(E(_))}}function Dt(v,E){for(var _=-1,C=v.length,M=0,G=[];++_<C;){var ge=v[_];(ge===E||ge===N)&&(v[_]=N,G[M++]=_)}return G}function _i(v){var E=-1,_=Array(v.size);return v.forEach(function(C){_[++E]=C}),_}function Tp(v){var E=-1,_=Array(v.size);return v.forEach(function(C){_[++E]=[C,C]}),_}function Dp(v,E,_){for(var C=_-1,M=v.length;++C<M;)if(v[C]===E)return C;return-1}function Up(v,E,_){for(var C=_+1;C--;)if(v[C]===E)return C;return C}function dr(v){return fr(v)?jp(v):_p(v)}function ot(v){return fr(v)?Mp(v):bp(v)}function Ea(v){for(var E=v.length;E--&&Ol.test(v.charAt(E)););return E}var qp=Ks(pp);function jp(v){for(var E=qs.lastIndex=0;qs.test(v);)++E;return E}function Mp(v){return v.match(qs)||[]}function kp(v){return v.match(np)||[]}var zp=function v(E){E=E==null?we:gr.defaults(we.Object(),E,gr.pick(we,cp));var _=E.Array,C=E.Date,M=E.Error,G=E.Function,ge=E.Math,X=E.Object,Gs=E.RegExp,Lp=E.String,Ge=E.TypeError,bi=_.prototype,Vp=G.prototype,yr=X.prototype,Ei=E["__core-js_shared__"],Ii=Vp.toString,Q=yr.hasOwnProperty,Kp=0,Ia=function(){var e=/[^.]+$/.exec(Ei&&Ei.keys&&Ei.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Si=yr.toString,Hp=Ii.call(X),Fp=we._,Wp=Gs("^"+Ii.call(Q).replace($s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pi=oa?E.Buffer:r,Ut=E.Symbol,Oi=E.Uint8Array,Sa=Pi?Pi.allocUnsafe:r,Ri=ba(X.getPrototypeOf,X),Pa=X.create,Oa=yr.propertyIsEnumerable,Ni=bi.splice,Ra=Ut?Ut.isConcatSpreadable:r,Mr=Ut?Ut.iterator:r,Jt=Ut?Ut.toStringTag:r,Ci=function(){try{var e=er(X,"defineProperty");return e({},"",{}),e}catch{}}(),Bp=E.clearTimeout!==we.clearTimeout&&E.clearTimeout,Gp=C&&C.now!==we.Date.now&&C.now,Jp=E.setTimeout!==we.setTimeout&&E.setTimeout,$i=ge.ceil,Ai=ge.floor,Js=X.getOwnPropertySymbols,Qp=Pi?Pi.isBuffer:r,Na=E.isFinite,Yp=bi.join,Zp=ba(X.keys,X),ye=ge.max,Ee=ge.min,Xp=C.now,ef=E.parseInt,Ca=ge.random,tf=bi.reverse,Qs=er(E,"DataView"),kr=er(E,"Map"),Ys=er(E,"Promise"),vr=er(E,"Set"),zr=er(E,"WeakMap"),Lr=er(X,"create"),xi=zr&&new zr,mr={},rf=tr(Qs),sf=tr(kr),nf=tr(Ys),of=tr(vr),af=tr(zr),Ti=Ut?Ut.prototype:r,Vr=Ti?Ti.valueOf:r,$a=Ti?Ti.toString:r;function l(e){if(ae(e)&&!k(e)&&!(e instanceof H)){if(e instanceof Je)return e;if(Q.call(e,"__wrapped__"))return Ac(e)}return new Je(e)}var wr=function(){function e(){}return function(t){if(!oe(t))return{};if(Pa)return Pa(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Di(){}function Je(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:_l,evaluate:bl,interpolate:ko,variable:"",imports:{_:l}},l.prototype=Di.prototype,l.prototype.constructor=l,Je.prototype=wr(Di.prototype),Je.prototype.constructor=Je;function H(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ft,this.__views__=[]}function cf(){var e=new H(this.__wrapped__);return e.__actions__=Ae(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ae(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ae(this.__views__),e}function uf(){if(this.__filtered__){var e=new H(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function hf(){var e=this.__wrapped__.value(),t=this.__dir__,n=k(e),c=t<0,h=n?e.length:0,f=Ed(0,h,this.__views__),d=f.start,y=f.end,m=y-d,I=c?y:d-1,S=this.__iteratees__,P=S.length,O=0,x=Ee(m,this.__takeCount__);if(!n||!c&&h==m&&x==m)return ec(e,this.__actions__);var U=[];e:for(;m--&&O<x;){I+=t;for(var L=-1,q=e[I];++L<P;){var K=S[L],F=K.iteratee,Ve=K.type,Ce=F(q);if(Ve==il)q=Ce;else if(!Ce){if(Ve==Do)continue e;break e}}U[O++]=q}return U}H.prototype=wr(Di.prototype),H.prototype.constructor=H;function Qt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var c=e[t];this.set(c[0],c[1])}}function lf(){this.__data__=Lr?Lr(null):{},this.size=0}function pf(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function ff(e){var t=this.__data__;if(Lr){var n=t[e];return n===w?r:n}return Q.call(t,e)?t[e]:r}function df(e){var t=this.__data__;return Lr?t[e]!==r:Q.call(t,e)}function gf(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Lr&&t===r?w:t,this}Qt.prototype.clear=lf,Qt.prototype.delete=pf,Qt.prototype.get=ff,Qt.prototype.has=df,Qt.prototype.set=gf;function bt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var c=e[t];this.set(c[0],c[1])}}function yf(){this.__data__=[],this.size=0}function vf(e){var t=this.__data__,n=Ui(t,e);if(n<0)return!1;var c=t.length-1;return n==c?t.pop():Ni.call(t,n,1),--this.size,!0}function mf(e){var t=this.__data__,n=Ui(t,e);return n<0?r:t[n][1]}function wf(e){return Ui(this.__data__,e)>-1}function _f(e,t){var n=this.__data__,c=Ui(n,e);return c<0?(++this.size,n.push([e,t])):n[c][1]=t,this}bt.prototype.clear=yf,bt.prototype.delete=vf,bt.prototype.get=mf,bt.prototype.has=wf,bt.prototype.set=_f;function Et(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var c=e[t];this.set(c[0],c[1])}}function bf(){this.size=0,this.__data__={hash:new Qt,map:new(kr||bt),string:new Qt}}function Ef(e){var t=Bi(this,e).delete(e);return this.size-=t?1:0,t}function If(e){return Bi(this,e).get(e)}function Sf(e){return Bi(this,e).has(e)}function Pf(e,t){var n=Bi(this,e),c=n.size;return n.set(e,t),this.size+=n.size==c?0:1,this}Et.prototype.clear=bf,Et.prototype.delete=Ef,Et.prototype.get=If,Et.prototype.has=Sf,Et.prototype.set=Pf;function Yt(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Et;++t<n;)this.add(e[t])}function Of(e){return this.__data__.set(e,w),this}function Rf(e){return this.__data__.has(e)}Yt.prototype.add=Yt.prototype.push=Of,Yt.prototype.has=Rf;function at(e){var t=this.__data__=new bt(e);this.size=t.size}function Nf(){this.__data__=new bt,this.size=0}function Cf(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function $f(e){return this.__data__.get(e)}function Af(e){return this.__data__.has(e)}function xf(e,t){var n=this.__data__;if(n instanceof bt){var c=n.__data__;if(!kr||c.length<o-1)return c.push([e,t]),this.size=++n.size,this;n=this.__data__=new Et(c)}return n.set(e,t),this.size=n.size,this}at.prototype.clear=Nf,at.prototype.delete=Cf,at.prototype.get=$f,at.prototype.has=Af,at.prototype.set=xf;function Aa(e,t){var n=k(e),c=!n&&rr(e),h=!n&&!c&&zt(e),f=!n&&!c&&!h&&Ir(e),d=n||c||h||f,y=d?Fs(e.length,Lp):[],m=y.length;for(var I in e)(t||Q.call(e,I))&&!(d&&(I=="length"||h&&(I=="offset"||I=="parent")||f&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||Ot(I,m)))&&y.push(I);return y}function xa(e){var t=e.length;return t?e[un(0,t-1)]:r}function Tf(e,t){return Gi(Ae(e),Zt(t,0,e.length))}function Df(e){return Gi(Ae(e))}function Zs(e,t,n){(n!==r&&!ct(e[t],n)||n===r&&!(t in e))&&It(e,t,n)}function Kr(e,t,n){var c=e[t];(!(Q.call(e,t)&&ct(c,n))||n===r&&!(t in e))&&It(e,t,n)}function Ui(e,t){for(var n=e.length;n--;)if(ct(e[n][0],t))return n;return-1}function Uf(e,t,n,c){return qt(e,function(h,f,d){t(c,h,n(h),d)}),c}function Ta(e,t){return e&&gt(t,ve(t),e)}function qf(e,t){return e&&gt(t,Te(t),e)}function It(e,t,n){t=="__proto__"&&Ci?Ci(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Xs(e,t){for(var n=-1,c=t.length,h=_(c),f=e==null;++n<c;)h[n]=f?r:Dn(e,t[n]);return h}function Zt(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Qe(e,t,n,c,h,f){var d,y=t&$,m=t&A,I=t&W;if(n&&(d=h?n(e,c,h,f):n(e)),d!==r)return d;if(!oe(e))return e;var S=k(e);if(S){if(d=Sd(e),!y)return Ae(e,d)}else{var P=Ie(e),O=P==fi||P==Uo;if(zt(e))return ic(e,y);if(P==_t||P==ur||O&&!h){if(d=m||O?{}:Ec(e),!y)return m?fd(e,qf(d,e)):pd(e,Ta(d,e))}else{if(!ee[P])return h?e:{};d=Pd(e,P,y)}}f||(f=new at);var x=f.get(e);if(x)return x;f.set(e,d),Yc(e)?e.forEach(function(q){d.add(Qe(q,t,n,q,e,f))}):Jc(e)&&e.forEach(function(q,K){d.set(K,Qe(q,t,n,K,e,f))});var U=I?m?_n:wn:m?Te:ve,L=S?r:U(e);return Be(L||e,function(q,K){L&&(K=q,q=e[K]),Kr(d,K,Qe(q,t,n,K,e,f))}),d}function jf(e){var t=ve(e);return function(n){return Da(n,e,t)}}function Da(e,t,n){var c=n.length;if(e==null)return!c;for(e=X(e);c--;){var h=n[c],f=t[h],d=e[h];if(d===r&&!(h in e)||!f(d))return!1}return!0}function Ua(e,t,n){if(typeof e!="function")throw new Ge(p);return Qr(function(){e.apply(r,n)},t)}function Hr(e,t,n,c){var h=-1,f=mi,d=!0,y=e.length,m=[],I=t.length;if(!y)return m;n&&(t=ne(t,ke(n))),c?(f=ks,d=!1):t.length>=o&&(f=jr,d=!1,t=new Yt(t));e:for(;++h<y;){var S=e[h],P=n==null?S:n(S);if(S=c||S!==0?S:0,d&&P===P){for(var O=I;O--;)if(t[O]===P)continue e;m.push(S)}else f(t,P,c)||m.push(S)}return m}var qt=cc(dt),qa=cc(tn,!0);function Mf(e,t){var n=!0;return qt(e,function(c,h,f){return n=!!t(c,h,f),n}),n}function qi(e,t,n){for(var c=-1,h=e.length;++c<h;){var f=e[c],d=t(f);if(d!=null&&(y===r?d===d&&!Le(d):n(d,y)))var y=d,m=f}return m}function kf(e,t,n,c){var h=e.length;for(n=z(n),n<0&&(n=-n>h?0:h+n),c=c===r||c>h?h:z(c),c<0&&(c+=h),c=n>c?0:Xc(c);n<c;)e[n++]=t;return e}function ja(e,t){var n=[];return qt(e,function(c,h,f){t(c,h,f)&&n.push(c)}),n}function _e(e,t,n,c,h){var f=-1,d=e.length;for(n||(n=Rd),h||(h=[]);++f<d;){var y=e[f];t>0&&n(y)?t>1?_e(y,t-1,n,c,h):Tt(h,y):c||(h[h.length]=y)}return h}var en=uc(),Ma=uc(!0);function dt(e,t){return e&&en(e,t,ve)}function tn(e,t){return e&&Ma(e,t,ve)}function ji(e,t){return xt(t,function(n){return Rt(e[n])})}function Xt(e,t){t=Mt(t,e);for(var n=0,c=t.length;e!=null&&n<c;)e=e[yt(t[n++])];return n&&n==c?e:r}function ka(e,t,n){var c=t(e);return k(e)?c:Tt(c,n(e))}function Re(e){return e==null?e===r?fl:ll:Jt&&Jt in X(e)?bd(e):Dd(e)}function rn(e,t){return e>t}function zf(e,t){return e!=null&&Q.call(e,t)}function Lf(e,t){return e!=null&&t in X(e)}function Vf(e,t,n){return e>=Ee(t,n)&&e<ye(t,n)}function sn(e,t,n){for(var c=n?ks:mi,h=e[0].length,f=e.length,d=f,y=_(f),m=1/0,I=[];d--;){var S=e[d];d&&t&&(S=ne(S,ke(t))),m=Ee(S.length,m),y[d]=!n&&(t||h>=120&&S.length>=120)?new Yt(d&&S):r}S=e[0];var P=-1,O=y[0];e:for(;++P<h&&I.length<m;){var x=S[P],U=t?t(x):x;if(x=n||x!==0?x:0,!(O?jr(O,U):c(I,U,n))){for(d=f;--d;){var L=y[d];if(!(L?jr(L,U):c(e[d],U,n)))continue e}O&&O.push(U),I.push(x)}}return I}function Kf(e,t,n,c){return dt(e,function(h,f,d){t(c,n(h),f,d)}),c}function Fr(e,t,n){t=Mt(t,e),e=Oc(e,t);var c=e==null?e:e[yt(Ze(t))];return c==null?r:Me(c,e,n)}function za(e){return ae(e)&&Re(e)==ur}function Hf(e){return ae(e)&&Re(e)==qr}function Ff(e){return ae(e)&&Re(e)==Ar}function Wr(e,t,n,c,h){return e===t?!0:e==null||t==null||!ae(e)&&!ae(t)?e!==e&&t!==t:Wf(e,t,n,c,Wr,h)}function Wf(e,t,n,c,h,f){var d=k(e),y=k(t),m=d?li:Ie(e),I=y?li:Ie(t);m=m==ur?_t:m,I=I==ur?_t:I;var S=m==_t,P=I==_t,O=m==I;if(O&&zt(e)){if(!zt(t))return!1;d=!0,S=!1}if(O&&!S)return f||(f=new at),d||Ir(e)?wc(e,t,n,c,h,f):wd(e,t,m,n,c,h,f);if(!(n&j)){var x=S&&Q.call(e,"__wrapped__"),U=P&&Q.call(t,"__wrapped__");if(x||U){var L=x?e.value():e,q=U?t.value():t;return f||(f=new at),h(L,q,n,c,f)}}return O?(f||(f=new at),_d(e,t,n,c,h,f)):!1}function Bf(e){return ae(e)&&Ie(e)==st}function nn(e,t,n,c){var h=n.length,f=h,d=!c;if(e==null)return!f;for(e=X(e);h--;){var y=n[h];if(d&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++h<f;){y=n[h];var m=y[0],I=e[m],S=y[1];if(d&&y[2]){if(I===r&&!(m in e))return!1}else{var P=new at;if(c)var O=c(I,S,m,e,t,P);if(!(O===r?Wr(S,I,j|Z,c,P):O))return!1}}return!0}function La(e){if(!oe(e)||Cd(e))return!1;var t=Rt(e)?Wp:ql;return t.test(tr(e))}function Gf(e){return ae(e)&&Re(e)==Tr}function Jf(e){return ae(e)&&Ie(e)==nt}function Qf(e){return ae(e)&&es(e.length)&&!!te[Re(e)]}function Va(e){return typeof e=="function"?e:e==null?De:typeof e=="object"?k(e)?Fa(e[0],e[1]):Ha(e):hu(e)}function on(e){if(!Jr(e))return Zp(e);var t=[];for(var n in X(e))Q.call(e,n)&&n!="constructor"&&t.push(n);return t}function Yf(e){if(!oe(e))return Td(e);var t=Jr(e),n=[];for(var c in e)c=="constructor"&&(t||!Q.call(e,c))||n.push(c);return n}function an(e,t){return e<t}function Ka(e,t){var n=-1,c=xe(e)?_(e.length):[];return qt(e,function(h,f,d){c[++n]=t(h,f,d)}),c}function Ha(e){var t=En(e);return t.length==1&&t[0][2]?Sc(t[0][0],t[0][1]):function(n){return n===e||nn(n,e,t)}}function Fa(e,t){return Sn(e)&&Ic(t)?Sc(yt(e),t):function(n){var c=Dn(n,e);return c===r&&c===t?Un(n,e):Wr(t,c,j|Z)}}function Mi(e,t,n,c,h){e!==t&&en(t,function(f,d){if(h||(h=new at),oe(f))Zf(e,t,d,n,Mi,c,h);else{var y=c?c(On(e,d),f,d+"",e,t,h):r;y===r&&(y=f),Zs(e,d,y)}},Te)}function Zf(e,t,n,c,h,f,d){var y=On(e,n),m=On(t,n),I=d.get(m);if(I){Zs(e,n,I);return}var S=f?f(y,m,n+"",e,t,d):r,P=S===r;if(P){var O=k(m),x=!O&&zt(m),U=!O&&!x&&Ir(m);S=m,O||x||U?k(y)?S=y:he(y)?S=Ae(y):x?(P=!1,S=ic(m,!0)):U?(P=!1,S=sc(m,!0)):S=[]:Yr(m)||rr(m)?(S=y,rr(y)?S=eu(y):(!oe(y)||Rt(y))&&(S=Ec(m))):P=!1}P&&(d.set(m,S),h(S,m,c,f,d),d.delete(m)),Zs(e,n,S)}function Wa(e,t){var n=e.length;if(n)return t+=t<0?n:0,Ot(t,n)?e[t]:r}function Ba(e,t,n){t.length?t=ne(t,function(f){return k(f)?function(d){return Xt(d,f.length===1?f[0]:f)}:f}):t=[De];var c=-1;t=ne(t,ke(D()));var h=Ka(e,function(f,d,y){var m=ne(t,function(I){return I(f)});return{criteria:m,index:++c,value:f}});return Sp(h,function(f,d){return ld(f,d,n)})}function Xf(e,t){return Ga(e,t,function(n,c){return Un(e,c)})}function Ga(e,t,n){for(var c=-1,h=t.length,f={};++c<h;){var d=t[c],y=Xt(e,d);n(y,d)&&Br(f,Mt(d,e),y)}return f}function ed(e){return function(t){return Xt(t,e)}}function cn(e,t,n,c){var h=c?Ip:pr,f=-1,d=t.length,y=e;for(e===t&&(t=Ae(t)),n&&(y=ne(e,ke(n)));++f<d;)for(var m=0,I=t[f],S=n?n(I):I;(m=h(y,S,m,c))>-1;)y!==e&&Ni.call(y,m,1),Ni.call(e,m,1);return e}function Ja(e,t){for(var n=e?t.length:0,c=n-1;n--;){var h=t[n];if(n==c||h!==f){var f=h;Ot(h)?Ni.call(e,h,1):pn(e,h)}}return e}function un(e,t){return e+Ai(Ca()*(t-e+1))}function td(e,t,n,c){for(var h=-1,f=ye($i((t-e)/(n||1)),0),d=_(f);f--;)d[c?f:++h]=e,e+=n;return d}function hn(e,t){var n="";if(!e||t<1||t>At)return n;do t%2&&(n+=e),t=Ai(t/2),t&&(e+=e);while(t);return n}function V(e,t){return Rn(Pc(e,t,De),e+"")}function rd(e){return xa(Sr(e))}function id(e,t){var n=Sr(e);return Gi(n,Zt(t,0,n.length))}function Br(e,t,n,c){if(!oe(e))return e;t=Mt(t,e);for(var h=-1,f=t.length,d=f-1,y=e;y!=null&&++h<f;){var m=yt(t[h]),I=n;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(h!=d){var S=y[m];I=c?c(S,m,y):r,I===r&&(I=oe(S)?S:Ot(t[h+1])?[]:{})}Kr(y,m,I),y=y[m]}return e}var Qa=xi?function(e,t){return xi.set(e,t),e}:De,sd=Ci?function(e,t){return Ci(e,"toString",{configurable:!0,enumerable:!1,value:jn(t),writable:!0})}:De;function nd(e){return Gi(Sr(e))}function Ye(e,t,n){var c=-1,h=e.length;t<0&&(t=-t>h?0:h+t),n=n>h?h:n,n<0&&(n+=h),h=t>n?0:n-t>>>0,t>>>=0;for(var f=_(h);++c<h;)f[c]=e[c+t];return f}function od(e,t){var n;return qt(e,function(c,h,f){return n=t(c,h,f),!n}),!!n}function ki(e,t,n){var c=0,h=e==null?c:e.length;if(typeof t=="number"&&t===t&&h<=al){for(;c<h;){var f=c+h>>>1,d=e[f];d!==null&&!Le(d)&&(n?d<=t:d<t)?c=f+1:h=f}return h}return ln(e,t,De,n)}function ln(e,t,n,c){var h=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var d=t!==t,y=t===null,m=Le(t),I=t===r;h<f;){var S=Ai((h+f)/2),P=n(e[S]),O=P!==r,x=P===null,U=P===P,L=Le(P);if(d)var q=c||U;else I?q=U&&(c||O):y?q=U&&O&&(c||!x):m?q=U&&O&&!x&&(c||!L):x||L?q=!1:q=c?P<=t:P<t;q?h=S+1:f=S}return Ee(f,ol)}function Ya(e,t){for(var n=-1,c=e.length,h=0,f=[];++n<c;){var d=e[n],y=t?t(d):d;if(!n||!ct(y,m)){var m=y;f[h++]=d===0?0:d}}return f}function Za(e){return typeof e=="number"?e:Le(e)?hi:+e}function ze(e){if(typeof e=="string")return e;if(k(e))return ne(e,ze)+"";if(Le(e))return $a?$a.call(e):"";var t=e+"";return t=="0"&&1/e==-Bt?"-0":t}function jt(e,t,n){var c=-1,h=mi,f=e.length,d=!0,y=[],m=y;if(n)d=!1,h=ks;else if(f>=o){var I=t?null:vd(e);if(I)return _i(I);d=!1,h=jr,m=new Yt}else m=t?[]:y;e:for(;++c<f;){var S=e[c],P=t?t(S):S;if(S=n||S!==0?S:0,d&&P===P){for(var O=m.length;O--;)if(m[O]===P)continue e;t&&m.push(P),y.push(S)}else h(m,P,n)||(m!==y&&m.push(P),y.push(S))}return y}function pn(e,t){return t=Mt(t,e),e=Oc(e,t),e==null||delete e[yt(Ze(t))]}function Xa(e,t,n,c){return Br(e,t,n(Xt(e,t)),c)}function zi(e,t,n,c){for(var h=e.length,f=c?h:-1;(c?f--:++f<h)&&t(e[f],f,e););return n?Ye(e,c?0:f,c?f+1:h):Ye(e,c?f+1:0,c?h:f)}function ec(e,t){var n=e;return n instanceof H&&(n=n.value()),zs(t,function(c,h){return h.func.apply(h.thisArg,Tt([c],h.args))},n)}function fn(e,t,n){var c=e.length;if(c<2)return c?jt(e[0]):[];for(var h=-1,f=_(c);++h<c;)for(var d=e[h],y=-1;++y<c;)y!=h&&(f[h]=Hr(f[h]||d,e[y],t,n));return jt(_e(f,1),t,n)}function tc(e,t,n){for(var c=-1,h=e.length,f=t.length,d={};++c<h;){var y=c<f?t[c]:r;n(d,e[c],y)}return d}function dn(e){return he(e)?e:[]}function gn(e){return typeof e=="function"?e:De}function Mt(e,t){return k(e)?e:Sn(e,t)?[e]:$c(J(e))}var ad=V;function kt(e,t,n){var c=e.length;return n=n===r?c:n,!t&&n>=c?e:Ye(e,t,n)}var rc=Bp||function(e){return we.clearTimeout(e)};function ic(e,t){if(t)return e.slice();var n=e.length,c=Sa?Sa(n):new e.constructor(n);return e.copy(c),c}function yn(e){var t=new e.constructor(e.byteLength);return new Oi(t).set(new Oi(e)),t}function cd(e,t){var n=t?yn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function ud(e){var t=new e.constructor(e.source,zo.exec(e));return t.lastIndex=e.lastIndex,t}function hd(e){return Vr?X(Vr.call(e)):{}}function sc(e,t){var n=t?yn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function nc(e,t){if(e!==t){var n=e!==r,c=e===null,h=e===e,f=Le(e),d=t!==r,y=t===null,m=t===t,I=Le(t);if(!y&&!I&&!f&&e>t||f&&d&&m&&!y&&!I||c&&d&&m||!n&&m||!h)return 1;if(!c&&!f&&!I&&e<t||I&&n&&h&&!c&&!f||y&&n&&h||!d&&h||!m)return-1}return 0}function ld(e,t,n){for(var c=-1,h=e.criteria,f=t.criteria,d=h.length,y=n.length;++c<d;){var m=nc(h[c],f[c]);if(m){if(c>=y)return m;var I=n[c];return m*(I=="desc"?-1:1)}}return e.index-t.index}function oc(e,t,n,c){for(var h=-1,f=e.length,d=n.length,y=-1,m=t.length,I=ye(f-d,0),S=_(m+I),P=!c;++y<m;)S[y]=t[y];for(;++h<d;)(P||h<f)&&(S[n[h]]=e[h]);for(;I--;)S[y++]=e[h++];return S}function ac(e,t,n,c){for(var h=-1,f=e.length,d=-1,y=n.length,m=-1,I=t.length,S=ye(f-y,0),P=_(S+I),O=!c;++h<S;)P[h]=e[h];for(var x=h;++m<I;)P[x+m]=t[m];for(;++d<y;)(O||h<f)&&(P[x+n[d]]=e[h++]);return P}function Ae(e,t){var n=-1,c=e.length;for(t||(t=_(c));++n<c;)t[n]=e[n];return t}function gt(e,t,n,c){var h=!n;n||(n={});for(var f=-1,d=t.length;++f<d;){var y=t[f],m=c?c(n[y],e[y],y,n,e):r;m===r&&(m=e[y]),h?It(n,y,m):Kr(n,y,m)}return n}function pd(e,t){return gt(e,In(e),t)}function fd(e,t){return gt(e,_c(e),t)}function Li(e,t){return function(n,c){var h=k(n)?vp:Uf,f=t?t():{};return h(n,e,D(c,2),f)}}function _r(e){return V(function(t,n){var c=-1,h=n.length,f=h>1?n[h-1]:r,d=h>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(h--,f):r,d&&Ne(n[0],n[1],d)&&(f=h<3?r:f,h=1),t=X(t);++c<h;){var y=n[c];y&&e(t,y,c,f)}return t})}function cc(e,t){return function(n,c){if(n==null)return n;if(!xe(n))return e(n,c);for(var h=n.length,f=t?h:-1,d=X(n);(t?f--:++f<h)&&c(d[f],f,d)!==!1;);return n}}function uc(e){return function(t,n,c){for(var h=-1,f=X(t),d=c(t),y=d.length;y--;){var m=d[e?y:++h];if(n(f[m],m,f)===!1)break}return t}}function dd(e,t,n){var c=t&re,h=Gr(e);function f(){var d=this&&this!==we&&this instanceof f?h:e;return d.apply(c?n:this,arguments)}return f}function hc(e){return function(t){t=J(t);var n=fr(t)?ot(t):r,c=n?n[0]:t.charAt(0),h=n?kt(n,1).join(""):t.slice(1);return c[e]()+h}}function br(e){return function(t){return zs(cu(au(t).replace(ip,"")),e,"")}}function Gr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=wr(e.prototype),c=e.apply(n,t);return oe(c)?c:n}}function gd(e,t,n){var c=Gr(e);function h(){for(var f=arguments.length,d=_(f),y=f,m=Er(h);y--;)d[y]=arguments[y];var I=f<3&&d[0]!==m&&d[f-1]!==m?[]:Dt(d,m);if(f-=I.length,f<n)return gc(e,t,Vi,h.placeholder,r,d,I,r,r,n-f);var S=this&&this!==we&&this instanceof h?c:e;return Me(S,this,d)}return h}function lc(e){return function(t,n,c){var h=X(t);if(!xe(t)){var f=D(n,3);t=ve(t),n=function(y){return f(h[y],y,h)}}var d=e(t,n,c);return d>-1?h[f?t[d]:d]:r}}function pc(e){return Pt(function(t){var n=t.length,c=n,h=Je.prototype.thru;for(e&&t.reverse();c--;){var f=t[c];if(typeof f!="function")throw new Ge(p);if(h&&!d&&Wi(f)=="wrapper")var d=new Je([],!0)}for(c=d?c:n;++c<n;){f=t[c];var y=Wi(f),m=y=="wrapper"?bn(f):r;m&&Pn(m[0])&&m[1]==(ue|Y|se|Oe)&&!m[4].length&&m[9]==1?d=d[Wi(m[0])].apply(d,m[3]):d=f.length==1&&Pn(f)?d[y]():d.thru(f)}return function(){var I=arguments,S=I[0];if(d&&I.length==1&&k(S))return d.plant(S).value();for(var P=0,O=n?t[P].apply(this,I):S;++P<n;)O=t[P].call(this,O);return O}})}function Vi(e,t,n,c,h,f,d,y,m,I){var S=t&ue,P=t&re,O=t&ie,x=t&(Y|B),U=t&$t,L=O?r:Gr(e);function q(){for(var K=arguments.length,F=_(K),Ve=K;Ve--;)F[Ve]=arguments[Ve];if(x)var Ce=Er(q),Ke=Op(F,Ce);if(c&&(F=oc(F,c,h,x)),f&&(F=ac(F,f,d,x)),K-=Ke,x&&K<I){var le=Dt(F,Ce);return gc(e,t,Vi,q.placeholder,n,F,le,y,m,I-K)}var ut=P?n:this,Ct=O?ut[e]:e;return K=F.length,y?F=Ud(F,y):U&&K>1&&F.reverse(),S&&m<K&&(F.length=m),this&&this!==we&&this instanceof q&&(Ct=L||Gr(Ct)),Ct.apply(ut,F)}return q}function fc(e,t){return function(n,c){return Kf(n,e,t(c),{})}}function Ki(e,t){return function(n,c){var h;if(n===r&&c===r)return t;if(n!==r&&(h=n),c!==r){if(h===r)return c;typeof n=="string"||typeof c=="string"?(n=ze(n),c=ze(c)):(n=Za(n),c=Za(c)),h=e(n,c)}return h}}function vn(e){return Pt(function(t){return t=ne(t,ke(D())),V(function(n){var c=this;return e(t,function(h){return Me(h,c,n)})})})}function Hi(e,t){t=t===r?" ":ze(t);var n=t.length;if(n<2)return n?hn(t,e):t;var c=hn(t,$i(e/dr(t)));return fr(t)?kt(ot(c),0,e).join(""):c.slice(0,e)}function yd(e,t,n,c){var h=t&re,f=Gr(e);function d(){for(var y=-1,m=arguments.length,I=-1,S=c.length,P=_(S+m),O=this&&this!==we&&this instanceof d?f:e;++I<S;)P[I]=c[I];for(;m--;)P[I++]=arguments[++y];return Me(O,h?n:this,P)}return d}function dc(e){return function(t,n,c){return c&&typeof c!="number"&&Ne(t,n,c)&&(n=c=r),t=Nt(t),n===r?(n=t,t=0):n=Nt(n),c=c===r?t<n?1:-1:Nt(c),td(t,n,c,e)}}function Fi(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Xe(t),n=Xe(n)),e(t,n)}}function gc(e,t,n,c,h,f,d,y,m,I){var S=t&Y,P=S?d:r,O=S?r:d,x=S?f:r,U=S?r:f;t|=S?se:Pe,t&=~(S?Pe:se),t&Se||(t&=~(re|ie));var L=[e,t,h,x,P,U,O,y,m,I],q=n.apply(r,L);return Pn(e)&&Rc(q,L),q.placeholder=c,Nc(q,e,t)}function mn(e){var t=ge[e];return function(n,c){if(n=Xe(n),c=c==null?0:Ee(z(c),292),c&&Na(n)){var h=(J(n)+"e").split("e"),f=t(h[0]+"e"+(+h[1]+c));return h=(J(f)+"e").split("e"),+(h[0]+"e"+(+h[1]-c))}return t(n)}}var vd=vr&&1/_i(new vr([,-0]))[1]==Bt?function(e){return new vr(e)}:zn;function yc(e){return function(t){var n=Ie(t);return n==st?Bs(t):n==nt?Tp(t):Pp(t,e(t))}}function St(e,t,n,c,h,f,d,y){var m=t&ie;if(!m&&typeof e!="function")throw new Ge(p);var I=c?c.length:0;if(I||(t&=~(se|Pe),c=h=r),d=d===r?d:ye(z(d),0),y=y===r?y:z(y),I-=h?h.length:0,t&Pe){var S=c,P=h;c=h=r}var O=m?r:bn(e),x=[e,t,n,c,h,S,P,f,d,y];if(O&&xd(x,O),e=x[0],t=x[1],n=x[2],c=x[3],h=x[4],y=x[9]=x[9]===r?m?0:e.length:ye(x[9]-I,0),!y&&t&(Y|B)&&(t&=~(Y|B)),!t||t==re)var U=dd(e,t,n);else t==Y||t==B?U=gd(e,t,y):(t==se||t==(re|se))&&!h.length?U=yd(e,t,n,c):U=Vi.apply(r,x);var L=O?Qa:Rc;return Nc(L(U,x),e,t)}function vc(e,t,n,c){return e===r||ct(e,yr[n])&&!Q.call(c,n)?t:e}function mc(e,t,n,c,h,f){return oe(e)&&oe(t)&&(f.set(t,e),Mi(e,t,r,mc,f),f.delete(t)),e}function md(e){return Yr(e)?r:e}function wc(e,t,n,c,h,f){var d=n&j,y=e.length,m=t.length;if(y!=m&&!(d&&m>y))return!1;var I=f.get(e),S=f.get(t);if(I&&S)return I==t&&S==e;var P=-1,O=!0,x=n&Z?new Yt:r;for(f.set(e,t),f.set(t,e);++P<y;){var U=e[P],L=t[P];if(c)var q=d?c(L,U,P,t,e,f):c(U,L,P,e,t,f);if(q!==r){if(q)continue;O=!1;break}if(x){if(!Ls(t,function(K,F){if(!jr(x,F)&&(U===K||h(U,K,n,c,f)))return x.push(F)})){O=!1;break}}else if(!(U===L||h(U,L,n,c,f))){O=!1;break}}return f.delete(e),f.delete(t),O}function wd(e,t,n,c,h,f,d){switch(n){case hr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case qr:return!(e.byteLength!=t.byteLength||!f(new Oi(e),new Oi(t)));case $r:case Ar:case xr:return ct(+e,+t);case pi:return e.name==t.name&&e.message==t.message;case Tr:case Dr:return e==t+"";case st:var y=Bs;case nt:var m=c&j;if(y||(y=_i),e.size!=t.size&&!m)return!1;var I=d.get(e);if(I)return I==t;c|=Z,d.set(e,t);var S=wc(y(e),y(t),c,h,f,d);return d.delete(e),S;case di:if(Vr)return Vr.call(e)==Vr.call(t)}return!1}function _d(e,t,n,c,h,f){var d=n&j,y=wn(e),m=y.length,I=wn(t),S=I.length;if(m!=S&&!d)return!1;for(var P=m;P--;){var O=y[P];if(!(d?O in t:Q.call(t,O)))return!1}var x=f.get(e),U=f.get(t);if(x&&U)return x==t&&U==e;var L=!0;f.set(e,t),f.set(t,e);for(var q=d;++P<m;){O=y[P];var K=e[O],F=t[O];if(c)var Ve=d?c(F,K,O,t,e,f):c(K,F,O,e,t,f);if(!(Ve===r?K===F||h(K,F,n,c,f):Ve)){L=!1;break}q||(q=O=="constructor")}if(L&&!q){var Ce=e.constructor,Ke=t.constructor;Ce!=Ke&&"constructor"in e&&"constructor"in t&&!(typeof Ce=="function"&&Ce instanceof Ce&&typeof Ke=="function"&&Ke instanceof Ke)&&(L=!1)}return f.delete(e),f.delete(t),L}function Pt(e){return Rn(Pc(e,r,Dc),e+"")}function wn(e){return ka(e,ve,In)}function _n(e){return ka(e,Te,_c)}var bn=xi?function(e){return xi.get(e)}:zn;function Wi(e){for(var t=e.name+"",n=mr[t],c=Q.call(mr,t)?n.length:0;c--;){var h=n[c],f=h.func;if(f==null||f==e)return h.name}return t}function Er(e){var t=Q.call(l,"placeholder")?l:e;return t.placeholder}function D(){var e=l.iteratee||Mn;return e=e===Mn?Va:e,arguments.length?e(arguments[0],arguments[1]):e}function Bi(e,t){var n=e.__data__;return Nd(t)?n[typeof t=="string"?"string":"hash"]:n.map}function En(e){for(var t=ve(e),n=t.length;n--;){var c=t[n],h=e[c];t[n]=[c,h,Ic(h)]}return t}function er(e,t){var n=$p(e,t);return La(n)?n:r}function bd(e){var t=Q.call(e,Jt),n=e[Jt];try{e[Jt]=r;var c=!0}catch{}var h=Si.call(e);return c&&(t?e[Jt]=n:delete e[Jt]),h}var In=Js?function(e){return e==null?[]:(e=X(e),xt(Js(e),function(t){return Oa.call(e,t)}))}:Ln,_c=Js?function(e){for(var t=[];e;)Tt(t,In(e)),e=Ri(e);return t}:Ln,Ie=Re;(Qs&&Ie(new Qs(new ArrayBuffer(1)))!=hr||kr&&Ie(new kr)!=st||Ys&&Ie(Ys.resolve())!=qo||vr&&Ie(new vr)!=nt||zr&&Ie(new zr)!=Ur)&&(Ie=function(e){var t=Re(e),n=t==_t?e.constructor:r,c=n?tr(n):"";if(c)switch(c){case rf:return hr;case sf:return st;case nf:return qo;case of:return nt;case af:return Ur}return t});function Ed(e,t,n){for(var c=-1,h=n.length;++c<h;){var f=n[c],d=f.size;switch(f.type){case"drop":e+=d;break;case"dropRight":t-=d;break;case"take":t=Ee(t,e+d);break;case"takeRight":e=ye(e,t-d);break}}return{start:e,end:t}}function Id(e){var t=e.match(Nl);return t?t[1].split(Cl):[]}function bc(e,t,n){t=Mt(t,e);for(var c=-1,h=t.length,f=!1;++c<h;){var d=yt(t[c]);if(!(f=e!=null&&n(e,d)))break;e=e[d]}return f||++c!=h?f:(h=e==null?0:e.length,!!h&&es(h)&&Ot(d,h)&&(k(e)||rr(e)))}function Sd(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&Q.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Ec(e){return typeof e.constructor=="function"&&!Jr(e)?wr(Ri(e)):{}}function Pd(e,t,n){var c=e.constructor;switch(t){case qr:return yn(e);case $r:case Ar:return new c(+e);case hr:return cd(e,n);case bs:case Es:case Is:case Ss:case Ps:case Os:case Rs:case Ns:case Cs:return sc(e,n);case st:return new c;case xr:case Dr:return new c(e);case Tr:return ud(e);case nt:return new c;case di:return hd(e)}}function Od(e,t){var n=t.length;if(!n)return e;var c=n-1;return t[c]=(n>1?"& ":"")+t[c],t=t.join(n>2?", ":" "),e.replace(Rl,`{
/* [wrapped with `+t+`] */
`)}function Rd(e){return k(e)||rr(e)||!!(Ra&&e&&e[Ra])}function Ot(e,t){var n=typeof e;return t=t??At,!!t&&(n=="number"||n!="symbol"&&Ml.test(e))&&e>-1&&e%1==0&&e<t}function Ne(e,t,n){if(!oe(n))return!1;var c=typeof t;return(c=="number"?xe(n)&&Ot(t,n.length):c=="string"&&t in n)?ct(n[t],e):!1}function Sn(e,t){if(k(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Le(e)?!0:Il.test(e)||!El.test(e)||t!=null&&e in X(t)}function Nd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Pn(e){var t=Wi(e),n=l[t];if(typeof n!="function"||!(t in H.prototype))return!1;if(e===n)return!0;var c=bn(n);return!!c&&e===c[0]}function Cd(e){return!!Ia&&Ia in e}var $d=Ei?Rt:Vn;function Jr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||yr;return e===n}function Ic(e){return e===e&&!oe(e)}function Sc(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in X(n))}}function Ad(e){var t=Zi(e,function(c){return n.size===b&&n.clear(),c}),n=t.cache;return t}function xd(e,t){var n=e[1],c=t[1],h=n|c,f=h<(re|ie|ue),d=c==ue&&n==Y||c==ue&&n==Oe&&e[7].length<=t[8]||c==(ue|Oe)&&t[7].length<=t[8]&&n==Y;if(!(f||d))return e;c&re&&(e[2]=t[2],h|=n&re?0:Se);var y=t[3];if(y){var m=e[3];e[3]=m?oc(m,y,t[4]):y,e[4]=m?Dt(e[3],N):t[4]}return y=t[5],y&&(m=e[5],e[5]=m?ac(m,y,t[6]):y,e[6]=m?Dt(e[5],N):t[6]),y=t[7],y&&(e[7]=y),c&ue&&(e[8]=e[8]==null?t[8]:Ee(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=h,e}function Td(e){var t=[];if(e!=null)for(var n in X(e))t.push(n);return t}function Dd(e){return Si.call(e)}function Pc(e,t,n){return t=ye(t===r?e.length-1:t,0),function(){for(var c=arguments,h=-1,f=ye(c.length-t,0),d=_(f);++h<f;)d[h]=c[t+h];h=-1;for(var y=_(t+1);++h<t;)y[h]=c[h];return y[t]=n(d),Me(e,this,y)}}function Oc(e,t){return t.length<2?e:Xt(e,Ye(t,0,-1))}function Ud(e,t){for(var n=e.length,c=Ee(t.length,n),h=Ae(e);c--;){var f=t[c];e[c]=Ot(f,n)?h[f]:r}return e}function On(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Rc=Cc(Qa),Qr=Jp||function(e,t){return we.setTimeout(e,t)},Rn=Cc(sd);function Nc(e,t,n){var c=t+"";return Rn(e,Od(c,qd(Id(c),n)))}function Cc(e){var t=0,n=0;return function(){var c=Xp(),h=rl-(c-n);if(n=c,h>0){if(++t>=tl)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Gi(e,t){var n=-1,c=e.length,h=c-1;for(t=t===r?c:t;++n<t;){var f=un(n,h),d=e[f];e[f]=e[n],e[n]=d}return e.length=t,e}var $c=Ad(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Sl,function(n,c,h,f){t.push(h?f.replace(xl,"$1"):c||n)}),t});function yt(e){if(typeof e=="string"||Le(e))return e;var t=e+"";return t=="0"&&1/e==-Bt?"-0":t}function tr(e){if(e!=null){try{return Ii.call(e)}catch{}try{return e+""}catch{}}return""}function qd(e,t){return Be(cl,function(n){var c="_."+n[0];t&n[1]&&!mi(e,c)&&e.push(c)}),e.sort()}function Ac(e){if(e instanceof H)return e.clone();var t=new Je(e.__wrapped__,e.__chain__);return t.__actions__=Ae(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function jd(e,t,n){(n?Ne(e,t,n):t===r)?t=1:t=ye(z(t),0);var c=e==null?0:e.length;if(!c||t<1)return[];for(var h=0,f=0,d=_($i(c/t));h<c;)d[f++]=Ye(e,h,h+=t);return d}function Md(e){for(var t=-1,n=e==null?0:e.length,c=0,h=[];++t<n;){var f=e[t];f&&(h[c++]=f)}return h}function kd(){var e=arguments.length;if(!e)return[];for(var t=_(e-1),n=arguments[0],c=e;c--;)t[c-1]=arguments[c];return Tt(k(n)?Ae(n):[n],_e(t,1))}var zd=V(function(e,t){return he(e)?Hr(e,_e(t,1,he,!0)):[]}),Ld=V(function(e,t){var n=Ze(t);return he(n)&&(n=r),he(e)?Hr(e,_e(t,1,he,!0),D(n,2)):[]}),Vd=V(function(e,t){var n=Ze(t);return he(n)&&(n=r),he(e)?Hr(e,_e(t,1,he,!0),r,n):[]});function Kd(e,t,n){var c=e==null?0:e.length;return c?(t=n||t===r?1:z(t),Ye(e,t<0?0:t,c)):[]}function Hd(e,t,n){var c=e==null?0:e.length;return c?(t=n||t===r?1:z(t),t=c-t,Ye(e,0,t<0?0:t)):[]}function Fd(e,t){return e&&e.length?zi(e,D(t,3),!0,!0):[]}function Wd(e,t){return e&&e.length?zi(e,D(t,3),!0):[]}function Bd(e,t,n,c){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Ne(e,t,n)&&(n=0,c=h),kf(e,t,n,c)):[]}function xc(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:z(n);return h<0&&(h=ye(c+h,0)),wi(e,D(t,3),h)}function Tc(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var h=c-1;return n!==r&&(h=z(n),h=n<0?ye(c+h,0):Ee(h,c-1)),wi(e,D(t,3),h,!0)}function Dc(e){var t=e==null?0:e.length;return t?_e(e,1):[]}function Gd(e){var t=e==null?0:e.length;return t?_e(e,Bt):[]}function Jd(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:z(t),_e(e,t)):[]}function Qd(e){for(var t=-1,n=e==null?0:e.length,c={};++t<n;){var h=e[t];c[h[0]]=h[1]}return c}function Uc(e){return e&&e.length?e[0]:r}function Yd(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:z(n);return h<0&&(h=ye(c+h,0)),pr(e,t,h)}function Zd(e){var t=e==null?0:e.length;return t?Ye(e,0,-1):[]}var Xd=V(function(e){var t=ne(e,dn);return t.length&&t[0]===e[0]?sn(t):[]}),eg=V(function(e){var t=Ze(e),n=ne(e,dn);return t===Ze(n)?t=r:n.pop(),n.length&&n[0]===e[0]?sn(n,D(t,2)):[]}),tg=V(function(e){var t=Ze(e),n=ne(e,dn);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?sn(n,r,t):[]});function rg(e,t){return e==null?"":Yp.call(e,t)}function Ze(e){var t=e==null?0:e.length;return t?e[t-1]:r}function ig(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var h=c;return n!==r&&(h=z(n),h=h<0?ye(c+h,0):Ee(h,c-1)),t===t?Up(e,t,h):wi(e,ga,h,!0)}function sg(e,t){return e&&e.length?Wa(e,z(t)):r}var ng=V(qc);function qc(e,t){return e&&e.length&&t&&t.length?cn(e,t):e}function og(e,t,n){return e&&e.length&&t&&t.length?cn(e,t,D(n,2)):e}function ag(e,t,n){return e&&e.length&&t&&t.length?cn(e,t,r,n):e}var cg=Pt(function(e,t){var n=e==null?0:e.length,c=Xs(e,t);return Ja(e,ne(t,function(h){return Ot(h,n)?+h:h}).sort(nc)),c});function ug(e,t){var n=[];if(!(e&&e.length))return n;var c=-1,h=[],f=e.length;for(t=D(t,3);++c<f;){var d=e[c];t(d,c,e)&&(n.push(d),h.push(c))}return Ja(e,h),n}function Nn(e){return e==null?e:tf.call(e)}function hg(e,t,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Ne(e,t,n)?(t=0,n=c):(t=t==null?0:z(t),n=n===r?c:z(n)),Ye(e,t,n)):[]}function lg(e,t){return ki(e,t)}function pg(e,t,n){return ln(e,t,D(n,2))}function fg(e,t){var n=e==null?0:e.length;if(n){var c=ki(e,t);if(c<n&&ct(e[c],t))return c}return-1}function dg(e,t){return ki(e,t,!0)}function gg(e,t,n){return ln(e,t,D(n,2),!0)}function yg(e,t){var n=e==null?0:e.length;if(n){var c=ki(e,t,!0)-1;if(ct(e[c],t))return c}return-1}function vg(e){return e&&e.length?Ya(e):[]}function mg(e,t){return e&&e.length?Ya(e,D(t,2)):[]}function wg(e){var t=e==null?0:e.length;return t?Ye(e,1,t):[]}function _g(e,t,n){return e&&e.length?(t=n||t===r?1:z(t),Ye(e,0,t<0?0:t)):[]}function bg(e,t,n){var c=e==null?0:e.length;return c?(t=n||t===r?1:z(t),t=c-t,Ye(e,t<0?0:t,c)):[]}function Eg(e,t){return e&&e.length?zi(e,D(t,3),!1,!0):[]}function Ig(e,t){return e&&e.length?zi(e,D(t,3)):[]}var Sg=V(function(e){return jt(_e(e,1,he,!0))}),Pg=V(function(e){var t=Ze(e);return he(t)&&(t=r),jt(_e(e,1,he,!0),D(t,2))}),Og=V(function(e){var t=Ze(e);return t=typeof t=="function"?t:r,jt(_e(e,1,he,!0),r,t)});function Rg(e){return e&&e.length?jt(e):[]}function Ng(e,t){return e&&e.length?jt(e,D(t,2)):[]}function Cg(e,t){return t=typeof t=="function"?t:r,e&&e.length?jt(e,r,t):[]}function Cn(e){if(!(e&&e.length))return[];var t=0;return e=xt(e,function(n){if(he(n))return t=ye(n.length,t),!0}),Fs(t,function(n){return ne(e,Vs(n))})}function jc(e,t){if(!(e&&e.length))return[];var n=Cn(e);return t==null?n:ne(n,function(c){return Me(t,r,c)})}var $g=V(function(e,t){return he(e)?Hr(e,t):[]}),Ag=V(function(e){return fn(xt(e,he))}),xg=V(function(e){var t=Ze(e);return he(t)&&(t=r),fn(xt(e,he),D(t,2))}),Tg=V(function(e){var t=Ze(e);return t=typeof t=="function"?t:r,fn(xt(e,he),r,t)}),Dg=V(Cn);function Ug(e,t){return tc(e||[],t||[],Kr)}function qg(e,t){return tc(e||[],t||[],Br)}var jg=V(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,jc(e,n)});function Mc(e){var t=l(e);return t.__chain__=!0,t}function Mg(e,t){return t(e),e}function Ji(e,t){return t(e)}var kg=Pt(function(e){var t=e.length,n=t?e[0]:0,c=this.__wrapped__,h=function(f){return Xs(f,e)};return t>1||this.__actions__.length||!(c instanceof H)||!Ot(n)?this.thru(h):(c=c.slice(n,+n+(t?1:0)),c.__actions__.push({func:Ji,args:[h],thisArg:r}),new Je(c,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function zg(){return Mc(this)}function Lg(){return new Je(this.value(),this.__chain__)}function Vg(){this.__values__===r&&(this.__values__=Zc(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Kg(){return this}function Hg(e){for(var t,n=this;n instanceof Di;){var c=Ac(n);c.__index__=0,c.__values__=r,t?h.__wrapped__=c:t=c;var h=c;n=n.__wrapped__}return h.__wrapped__=e,t}function Fg(){var e=this.__wrapped__;if(e instanceof H){var t=e;return this.__actions__.length&&(t=new H(this)),t=t.reverse(),t.__actions__.push({func:Ji,args:[Nn],thisArg:r}),new Je(t,this.__chain__)}return this.thru(Nn)}function Wg(){return ec(this.__wrapped__,this.__actions__)}var Bg=Li(function(e,t,n){Q.call(e,n)?++e[n]:It(e,n,1)});function Gg(e,t,n){var c=k(e)?fa:Mf;return n&&Ne(e,t,n)&&(t=r),c(e,D(t,3))}function Jg(e,t){var n=k(e)?xt:ja;return n(e,D(t,3))}var Qg=lc(xc),Yg=lc(Tc);function Zg(e,t){return _e(Qi(e,t),1)}function Xg(e,t){return _e(Qi(e,t),Bt)}function ey(e,t,n){return n=n===r?1:z(n),_e(Qi(e,t),n)}function kc(e,t){var n=k(e)?Be:qt;return n(e,D(t,3))}function zc(e,t){var n=k(e)?mp:qa;return n(e,D(t,3))}var ty=Li(function(e,t,n){Q.call(e,n)?e[n].push(t):It(e,n,[t])});function ry(e,t,n,c){e=xe(e)?e:Sr(e),n=n&&!c?z(n):0;var h=e.length;return n<0&&(n=ye(h+n,0)),ts(e)?n<=h&&e.indexOf(t,n)>-1:!!h&&pr(e,t,n)>-1}var iy=V(function(e,t,n){var c=-1,h=typeof t=="function",f=xe(e)?_(e.length):[];return qt(e,function(d){f[++c]=h?Me(t,d,n):Fr(d,t,n)}),f}),sy=Li(function(e,t,n){It(e,n,t)});function Qi(e,t){var n=k(e)?ne:Ka;return n(e,D(t,3))}function ny(e,t,n,c){return e==null?[]:(k(t)||(t=t==null?[]:[t]),n=c?r:n,k(n)||(n=n==null?[]:[n]),Ba(e,t,n))}var oy=Li(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function ay(e,t,n){var c=k(e)?zs:va,h=arguments.length<3;return c(e,D(t,4),n,h,qt)}function cy(e,t,n){var c=k(e)?wp:va,h=arguments.length<3;return c(e,D(t,4),n,h,qa)}function uy(e,t){var n=k(e)?xt:ja;return n(e,Xi(D(t,3)))}function hy(e){var t=k(e)?xa:rd;return t(e)}function ly(e,t,n){(n?Ne(e,t,n):t===r)?t=1:t=z(t);var c=k(e)?Tf:id;return c(e,t)}function py(e){var t=k(e)?Df:nd;return t(e)}function fy(e){if(e==null)return 0;if(xe(e))return ts(e)?dr(e):e.length;var t=Ie(e);return t==st||t==nt?e.size:on(e).length}function dy(e,t,n){var c=k(e)?Ls:od;return n&&Ne(e,t,n)&&(t=r),c(e,D(t,3))}var gy=V(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Ne(e,t[0],t[1])?t=[]:n>2&&Ne(t[0],t[1],t[2])&&(t=[t[0]]),Ba(e,_e(t,1),[])}),Yi=Gp||function(){return we.Date.now()};function yy(e,t){if(typeof t!="function")throw new Ge(p);return e=z(e),function(){if(--e<1)return t.apply(this,arguments)}}function Lc(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,St(e,ue,r,r,r,r,t)}function Vc(e,t){var n;if(typeof t!="function")throw new Ge(p);return e=z(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var $n=V(function(e,t,n){var c=re;if(n.length){var h=Dt(n,Er($n));c|=se}return St(e,c,t,n,h)}),Kc=V(function(e,t,n){var c=re|ie;if(n.length){var h=Dt(n,Er(Kc));c|=se}return St(t,c,e,n,h)});function Hc(e,t,n){t=n?r:t;var c=St(e,Y,r,r,r,r,r,t);return c.placeholder=Hc.placeholder,c}function Fc(e,t,n){t=n?r:t;var c=St(e,B,r,r,r,r,r,t);return c.placeholder=Fc.placeholder,c}function Wc(e,t,n){var c,h,f,d,y,m,I=0,S=!1,P=!1,O=!0;if(typeof e!="function")throw new Ge(p);t=Xe(t)||0,oe(n)&&(S=!!n.leading,P="maxWait"in n,f=P?ye(Xe(n.maxWait)||0,t):f,O="trailing"in n?!!n.trailing:O);function x(le){var ut=c,Ct=h;return c=h=r,I=le,d=e.apply(Ct,ut),d}function U(le){return I=le,y=Qr(K,t),S?x(le):d}function L(le){var ut=le-m,Ct=le-I,lu=t-ut;return P?Ee(lu,f-Ct):lu}function q(le){var ut=le-m,Ct=le-I;return m===r||ut>=t||ut<0||P&&Ct>=f}function K(){var le=Yi();if(q(le))return F(le);y=Qr(K,L(le))}function F(le){return y=r,O&&c?x(le):(c=h=r,d)}function Ve(){y!==r&&rc(y),I=0,c=m=h=y=r}function Ce(){return y===r?d:F(Yi())}function Ke(){var le=Yi(),ut=q(le);if(c=arguments,h=this,m=le,ut){if(y===r)return U(m);if(P)return rc(y),y=Qr(K,t),x(m)}return y===r&&(y=Qr(K,t)),d}return Ke.cancel=Ve,Ke.flush=Ce,Ke}var vy=V(function(e,t){return Ua(e,1,t)}),my=V(function(e,t,n){return Ua(e,Xe(t)||0,n)});function wy(e){return St(e,$t)}function Zi(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Ge(p);var n=function(){var c=arguments,h=t?t.apply(this,c):c[0],f=n.cache;if(f.has(h))return f.get(h);var d=e.apply(this,c);return n.cache=f.set(h,d)||f,d};return n.cache=new(Zi.Cache||Et),n}Zi.Cache=Et;function Xi(e){if(typeof e!="function")throw new Ge(p);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function _y(e){return Vc(2,e)}var by=ad(function(e,t){t=t.length==1&&k(t[0])?ne(t[0],ke(D())):ne(_e(t,1),ke(D()));var n=t.length;return V(function(c){for(var h=-1,f=Ee(c.length,n);++h<f;)c[h]=t[h].call(this,c[h]);return Me(e,this,c)})}),An=V(function(e,t){var n=Dt(t,Er(An));return St(e,se,r,t,n)}),Bc=V(function(e,t){var n=Dt(t,Er(Bc));return St(e,Pe,r,t,n)}),Ey=Pt(function(e,t){return St(e,Oe,r,r,r,t)});function Iy(e,t){if(typeof e!="function")throw new Ge(p);return t=t===r?t:z(t),V(e,t)}function Sy(e,t){if(typeof e!="function")throw new Ge(p);return t=t==null?0:ye(z(t),0),V(function(n){var c=n[t],h=kt(n,0,t);return c&&Tt(h,c),Me(e,this,h)})}function Py(e,t,n){var c=!0,h=!0;if(typeof e!="function")throw new Ge(p);return oe(n)&&(c="leading"in n?!!n.leading:c,h="trailing"in n?!!n.trailing:h),Wc(e,t,{leading:c,maxWait:t,trailing:h})}function Oy(e){return Lc(e,1)}function Ry(e,t){return An(gn(t),e)}function Ny(){if(!arguments.length)return[];var e=arguments[0];return k(e)?e:[e]}function Cy(e){return Qe(e,W)}function $y(e,t){return t=typeof t=="function"?t:r,Qe(e,W,t)}function Ay(e){return Qe(e,$|W)}function xy(e,t){return t=typeof t=="function"?t:r,Qe(e,$|W,t)}function Ty(e,t){return t==null||Da(e,t,ve(t))}function ct(e,t){return e===t||e!==e&&t!==t}var Dy=Fi(rn),Uy=Fi(function(e,t){return e>=t}),rr=za(function(){return arguments}())?za:function(e){return ae(e)&&Q.call(e,"callee")&&!Oa.call(e,"callee")},k=_.isArray,qy=aa?ke(aa):Hf;function xe(e){return e!=null&&es(e.length)&&!Rt(e)}function he(e){return ae(e)&&xe(e)}function jy(e){return e===!0||e===!1||ae(e)&&Re(e)==$r}var zt=Qp||Vn,My=ca?ke(ca):Ff;function ky(e){return ae(e)&&e.nodeType===1&&!Yr(e)}function zy(e){if(e==null)return!0;if(xe(e)&&(k(e)||typeof e=="string"||typeof e.splice=="function"||zt(e)||Ir(e)||rr(e)))return!e.length;var t=Ie(e);if(t==st||t==nt)return!e.size;if(Jr(e))return!on(e).length;for(var n in e)if(Q.call(e,n))return!1;return!0}function Ly(e,t){return Wr(e,t)}function Vy(e,t,n){n=typeof n=="function"?n:r;var c=n?n(e,t):r;return c===r?Wr(e,t,r,n):!!c}function xn(e){if(!ae(e))return!1;var t=Re(e);return t==pi||t==hl||typeof e.message=="string"&&typeof e.name=="string"&&!Yr(e)}function Ky(e){return typeof e=="number"&&Na(e)}function Rt(e){if(!oe(e))return!1;var t=Re(e);return t==fi||t==Uo||t==ul||t==pl}function Gc(e){return typeof e=="number"&&e==z(e)}function es(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=At}function oe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ae(e){return e!=null&&typeof e=="object"}var Jc=ua?ke(ua):Bf;function Hy(e,t){return e===t||nn(e,t,En(t))}function Fy(e,t,n){return n=typeof n=="function"?n:r,nn(e,t,En(t),n)}function Wy(e){return Qc(e)&&e!=+e}function By(e){if($d(e))throw new M(u);return La(e)}function Gy(e){return e===null}function Jy(e){return e==null}function Qc(e){return typeof e=="number"||ae(e)&&Re(e)==xr}function Yr(e){if(!ae(e)||Re(e)!=_t)return!1;var t=Ri(e);if(t===null)return!0;var n=Q.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Ii.call(n)==Hp}var Tn=ha?ke(ha):Gf;function Qy(e){return Gc(e)&&e>=-At&&e<=At}var Yc=la?ke(la):Jf;function ts(e){return typeof e=="string"||!k(e)&&ae(e)&&Re(e)==Dr}function Le(e){return typeof e=="symbol"||ae(e)&&Re(e)==di}var Ir=pa?ke(pa):Qf;function Yy(e){return e===r}function Zy(e){return ae(e)&&Ie(e)==Ur}function Xy(e){return ae(e)&&Re(e)==dl}var ev=Fi(an),tv=Fi(function(e,t){return e<=t});function Zc(e){if(!e)return[];if(xe(e))return ts(e)?ot(e):Ae(e);if(Mr&&e[Mr])return xp(e[Mr]());var t=Ie(e),n=t==st?Bs:t==nt?_i:Sr;return n(e)}function Nt(e){if(!e)return e===0?e:0;if(e=Xe(e),e===Bt||e===-Bt){var t=e<0?-1:1;return t*nl}return e===e?e:0}function z(e){var t=Nt(e),n=t%1;return t===t?n?t-n:t:0}function Xc(e){return e?Zt(z(e),0,ft):0}function Xe(e){if(typeof e=="number")return e;if(Le(e))return hi;if(oe(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=oe(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ma(e);var n=Ul.test(e);return n||jl.test(e)?gp(e.slice(2),n?2:8):Dl.test(e)?hi:+e}function eu(e){return gt(e,Te(e))}function rv(e){return e?Zt(z(e),-At,At):e===0?e:0}function J(e){return e==null?"":ze(e)}var iv=_r(function(e,t){if(Jr(t)||xe(t)){gt(t,ve(t),e);return}for(var n in t)Q.call(t,n)&&Kr(e,n,t[n])}),tu=_r(function(e,t){gt(t,Te(t),e)}),rs=_r(function(e,t,n,c){gt(t,Te(t),e,c)}),sv=_r(function(e,t,n,c){gt(t,ve(t),e,c)}),nv=Pt(Xs);function ov(e,t){var n=wr(e);return t==null?n:Ta(n,t)}var av=V(function(e,t){e=X(e);var n=-1,c=t.length,h=c>2?t[2]:r;for(h&&Ne(t[0],t[1],h)&&(c=1);++n<c;)for(var f=t[n],d=Te(f),y=-1,m=d.length;++y<m;){var I=d[y],S=e[I];(S===r||ct(S,yr[I])&&!Q.call(e,I))&&(e[I]=f[I])}return e}),cv=V(function(e){return e.push(r,mc),Me(ru,r,e)});function uv(e,t){return da(e,D(t,3),dt)}function hv(e,t){return da(e,D(t,3),tn)}function lv(e,t){return e==null?e:en(e,D(t,3),Te)}function pv(e,t){return e==null?e:Ma(e,D(t,3),Te)}function fv(e,t){return e&&dt(e,D(t,3))}function dv(e,t){return e&&tn(e,D(t,3))}function gv(e){return e==null?[]:ji(e,ve(e))}function yv(e){return e==null?[]:ji(e,Te(e))}function Dn(e,t,n){var c=e==null?r:Xt(e,t);return c===r?n:c}function vv(e,t){return e!=null&&bc(e,t,zf)}function Un(e,t){return e!=null&&bc(e,t,Lf)}var mv=fc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Si.call(t)),e[t]=n},jn(De)),wv=fc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Si.call(t)),Q.call(e,t)?e[t].push(n):e[t]=[n]},D),_v=V(Fr);function ve(e){return xe(e)?Aa(e):on(e)}function Te(e){return xe(e)?Aa(e,!0):Yf(e)}function bv(e,t){var n={};return t=D(t,3),dt(e,function(c,h,f){It(n,t(c,h,f),c)}),n}function Ev(e,t){var n={};return t=D(t,3),dt(e,function(c,h,f){It(n,h,t(c,h,f))}),n}var Iv=_r(function(e,t,n){Mi(e,t,n)}),ru=_r(function(e,t,n,c){Mi(e,t,n,c)}),Sv=Pt(function(e,t){var n={};if(e==null)return n;var c=!1;t=ne(t,function(f){return f=Mt(f,e),c||(c=f.length>1),f}),gt(e,_n(e),n),c&&(n=Qe(n,$|A|W,md));for(var h=t.length;h--;)pn(n,t[h]);return n});function Pv(e,t){return iu(e,Xi(D(t)))}var Ov=Pt(function(e,t){return e==null?{}:Xf(e,t)});function iu(e,t){if(e==null)return{};var n=ne(_n(e),function(c){return[c]});return t=D(t),Ga(e,n,function(c,h){return t(c,h[0])})}function Rv(e,t,n){t=Mt(t,e);var c=-1,h=t.length;for(h||(h=1,e=r);++c<h;){var f=e==null?r:e[yt(t[c])];f===r&&(c=h,f=n),e=Rt(f)?f.call(e):f}return e}function Nv(e,t,n){return e==null?e:Br(e,t,n)}function Cv(e,t,n,c){return c=typeof c=="function"?c:r,e==null?e:Br(e,t,n,c)}var su=yc(ve),nu=yc(Te);function $v(e,t,n){var c=k(e),h=c||zt(e)||Ir(e);if(t=D(t,4),n==null){var f=e&&e.constructor;h?n=c?new f:[]:oe(e)?n=Rt(f)?wr(Ri(e)):{}:n={}}return(h?Be:dt)(e,function(d,y,m){return t(n,d,y,m)}),n}function Av(e,t){return e==null?!0:pn(e,t)}function xv(e,t,n){return e==null?e:Xa(e,t,gn(n))}function Tv(e,t,n,c){return c=typeof c=="function"?c:r,e==null?e:Xa(e,t,gn(n),c)}function Sr(e){return e==null?[]:Ws(e,ve(e))}function Dv(e){return e==null?[]:Ws(e,Te(e))}function Uv(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Xe(n),n=n===n?n:0),t!==r&&(t=Xe(t),t=t===t?t:0),Zt(Xe(e),t,n)}function qv(e,t,n){return t=Nt(t),n===r?(n=t,t=0):n=Nt(n),e=Xe(e),Vf(e,t,n)}function jv(e,t,n){if(n&&typeof n!="boolean"&&Ne(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Nt(e),t===r?(t=e,e=0):t=Nt(t)),e>t){var c=e;e=t,t=c}if(n||e%1||t%1){var h=Ca();return Ee(e+h*(t-e+dp("1e-"+((h+"").length-1))),t)}return un(e,t)}var Mv=br(function(e,t,n){return t=t.toLowerCase(),e+(n?ou(t):t)});function ou(e){return qn(J(e).toLowerCase())}function au(e){return e=J(e),e&&e.replace(kl,Rp).replace(sp,"")}function kv(e,t,n){e=J(e),t=ze(t);var c=e.length;n=n===r?c:Zt(z(n),0,c);var h=n;return n-=t.length,n>=0&&e.slice(n,h)==t}function zv(e){return e=J(e),e&&wl.test(e)?e.replace(Mo,Np):e}function Lv(e){return e=J(e),e&&Pl.test(e)?e.replace($s,"\\$&"):e}var Vv=br(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Kv=br(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Hv=hc("toLowerCase");function Fv(e,t,n){e=J(e),t=z(t);var c=t?dr(e):0;if(!t||c>=t)return e;var h=(t-c)/2;return Hi(Ai(h),n)+e+Hi($i(h),n)}function Wv(e,t,n){e=J(e),t=z(t);var c=t?dr(e):0;return t&&c<t?e+Hi(t-c,n):e}function Bv(e,t,n){e=J(e),t=z(t);var c=t?dr(e):0;return t&&c<t?Hi(t-c,n)+e:e}function Gv(e,t,n){return n||t==null?t=0:t&&(t=+t),ef(J(e).replace(As,""),t||0)}function Jv(e,t,n){return(n?Ne(e,t,n):t===r)?t=1:t=z(t),hn(J(e),t)}function Qv(){var e=arguments,t=J(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Yv=br(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Zv(e,t,n){return n&&typeof n!="number"&&Ne(e,t,n)&&(t=n=r),n=n===r?ft:n>>>0,n?(e=J(e),e&&(typeof t=="string"||t!=null&&!Tn(t))&&(t=ze(t),!t&&fr(e))?kt(ot(e),0,n):e.split(t,n)):[]}var Xv=br(function(e,t,n){return e+(n?" ":"")+qn(t)});function em(e,t,n){return e=J(e),n=n==null?0:Zt(z(n),0,e.length),t=ze(t),e.slice(n,n+t.length)==t}function tm(e,t,n){var c=l.templateSettings;n&&Ne(e,t,n)&&(t=r),e=J(e),t=rs({},t,c,vc);var h=rs({},t.imports,c.imports,vc),f=ve(h),d=Ws(h,f),y,m,I=0,S=t.interpolate||gi,P="__p += '",O=Gs((t.escape||gi).source+"|"+S.source+"|"+(S===ko?Tl:gi).source+"|"+(t.evaluate||gi).source+"|$","g"),x="//# sourceURL="+(Q.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++up+"]")+`
`;e.replace(O,function(q,K,F,Ve,Ce,Ke){return F||(F=Ve),P+=e.slice(I,Ke).replace(zl,Cp),K&&(y=!0,P+=`' +
__e(`+K+`) +
'`),Ce&&(m=!0,P+=`';
`+Ce+`;
__p += '`),F&&(P+=`' +
((__t = (`+F+`)) == null ? '' : __t) +
'`),I=Ke+q.length,q}),P+=`';
`;var U=Q.call(t,"variable")&&t.variable;if(!U)P=`with (obj) {
`+P+`
}
`;else if(Al.test(U))throw new M(g);P=(m?P.replace(gl,""):P).replace(yl,"$1").replace(vl,"$1;"),P="function("+(U||"obj")+`) {
`+(U?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+P+`return __p
}`;var L=uu(function(){return G(f,x+"return "+P).apply(r,d)});if(L.source=P,xn(L))throw L;return L}function rm(e){return J(e).toLowerCase()}function im(e){return J(e).toUpperCase()}function sm(e,t,n){if(e=J(e),e&&(n||t===r))return ma(e);if(!e||!(t=ze(t)))return e;var c=ot(e),h=ot(t),f=wa(c,h),d=_a(c,h)+1;return kt(c,f,d).join("")}function nm(e,t,n){if(e=J(e),e&&(n||t===r))return e.slice(0,Ea(e)+1);if(!e||!(t=ze(t)))return e;var c=ot(e),h=_a(c,ot(t))+1;return kt(c,0,h).join("")}function om(e,t,n){if(e=J(e),e&&(n||t===r))return e.replace(As,"");if(!e||!(t=ze(t)))return e;var c=ot(e),h=wa(c,ot(t));return kt(c,h).join("")}function am(e,t){var n=Xh,c=el;if(oe(t)){var h="separator"in t?t.separator:h;n="length"in t?z(t.length):n,c="omission"in t?ze(t.omission):c}e=J(e);var f=e.length;if(fr(e)){var d=ot(e);f=d.length}if(n>=f)return e;var y=n-dr(c);if(y<1)return c;var m=d?kt(d,0,y).join(""):e.slice(0,y);if(h===r)return m+c;if(d&&(y+=m.length-y),Tn(h)){if(e.slice(y).search(h)){var I,S=m;for(h.global||(h=Gs(h.source,J(zo.exec(h))+"g")),h.lastIndex=0;I=h.exec(S);)var P=I.index;m=m.slice(0,P===r?y:P)}}else if(e.indexOf(ze(h),y)!=y){var O=m.lastIndexOf(h);O>-1&&(m=m.slice(0,O))}return m+c}function cm(e){return e=J(e),e&&ml.test(e)?e.replace(jo,qp):e}var um=br(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),qn=hc("toUpperCase");function cu(e,t,n){return e=J(e),t=n?r:t,t===r?Ap(e)?kp(e):Ep(e):e.match(t)||[]}var uu=V(function(e,t){try{return Me(e,r,t)}catch(n){return xn(n)?n:new M(n)}}),hm=Pt(function(e,t){return Be(t,function(n){n=yt(n),It(e,n,$n(e[n],e))}),e});function lm(e){var t=e==null?0:e.length,n=D();return e=t?ne(e,function(c){if(typeof c[1]!="function")throw new Ge(p);return[n(c[0]),c[1]]}):[],V(function(c){for(var h=-1;++h<t;){var f=e[h];if(Me(f[0],this,c))return Me(f[1],this,c)}})}function pm(e){return jf(Qe(e,$))}function jn(e){return function(){return e}}function fm(e,t){return e==null||e!==e?t:e}var dm=pc(),gm=pc(!0);function De(e){return e}function Mn(e){return Va(typeof e=="function"?e:Qe(e,$))}function ym(e){return Ha(Qe(e,$))}function vm(e,t){return Fa(e,Qe(t,$))}var mm=V(function(e,t){return function(n){return Fr(n,e,t)}}),wm=V(function(e,t){return function(n){return Fr(e,n,t)}});function kn(e,t,n){var c=ve(t),h=ji(t,c);n==null&&!(oe(t)&&(h.length||!c.length))&&(n=t,t=e,e=this,h=ji(t,ve(t)));var f=!(oe(n)&&"chain"in n)||!!n.chain,d=Rt(e);return Be(h,function(y){var m=t[y];e[y]=m,d&&(e.prototype[y]=function(){var I=this.__chain__;if(f||I){var S=e(this.__wrapped__),P=S.__actions__=Ae(this.__actions__);return P.push({func:m,args:arguments,thisArg:e}),S.__chain__=I,S}return m.apply(e,Tt([this.value()],arguments))})}),e}function _m(){return we._===this&&(we._=Fp),this}function zn(){}function bm(e){return e=z(e),V(function(t){return Wa(t,e)})}var Em=vn(ne),Im=vn(fa),Sm=vn(Ls);function hu(e){return Sn(e)?Vs(yt(e)):ed(e)}function Pm(e){return function(t){return e==null?r:Xt(e,t)}}var Om=dc(),Rm=dc(!0);function Ln(){return[]}function Vn(){return!1}function Nm(){return{}}function Cm(){return""}function $m(){return!0}function Am(e,t){if(e=z(e),e<1||e>At)return[];var n=ft,c=Ee(e,ft);t=D(t),e-=ft;for(var h=Fs(c,t);++n<e;)t(n);return h}function xm(e){return k(e)?ne(e,yt):Le(e)?[e]:Ae($c(J(e)))}function Tm(e){var t=++Kp;return J(e)+t}var Dm=Ki(function(e,t){return e+t},0),Um=mn("ceil"),qm=Ki(function(e,t){return e/t},1),jm=mn("floor");function Mm(e){return e&&e.length?qi(e,De,rn):r}function km(e,t){return e&&e.length?qi(e,D(t,2),rn):r}function zm(e){return ya(e,De)}function Lm(e,t){return ya(e,D(t,2))}function Vm(e){return e&&e.length?qi(e,De,an):r}function Km(e,t){return e&&e.length?qi(e,D(t,2),an):r}var Hm=Ki(function(e,t){return e*t},1),Fm=mn("round"),Wm=Ki(function(e,t){return e-t},0);function Bm(e){return e&&e.length?Hs(e,De):0}function Gm(e,t){return e&&e.length?Hs(e,D(t,2)):0}return l.after=yy,l.ary=Lc,l.assign=iv,l.assignIn=tu,l.assignInWith=rs,l.assignWith=sv,l.at=nv,l.before=Vc,l.bind=$n,l.bindAll=hm,l.bindKey=Kc,l.castArray=Ny,l.chain=Mc,l.chunk=jd,l.compact=Md,l.concat=kd,l.cond=lm,l.conforms=pm,l.constant=jn,l.countBy=Bg,l.create=ov,l.curry=Hc,l.curryRight=Fc,l.debounce=Wc,l.defaults=av,l.defaultsDeep=cv,l.defer=vy,l.delay=my,l.difference=zd,l.differenceBy=Ld,l.differenceWith=Vd,l.drop=Kd,l.dropRight=Hd,l.dropRightWhile=Fd,l.dropWhile=Wd,l.fill=Bd,l.filter=Jg,l.flatMap=Zg,l.flatMapDeep=Xg,l.flatMapDepth=ey,l.flatten=Dc,l.flattenDeep=Gd,l.flattenDepth=Jd,l.flip=wy,l.flow=dm,l.flowRight=gm,l.fromPairs=Qd,l.functions=gv,l.functionsIn=yv,l.groupBy=ty,l.initial=Zd,l.intersection=Xd,l.intersectionBy=eg,l.intersectionWith=tg,l.invert=mv,l.invertBy=wv,l.invokeMap=iy,l.iteratee=Mn,l.keyBy=sy,l.keys=ve,l.keysIn=Te,l.map=Qi,l.mapKeys=bv,l.mapValues=Ev,l.matches=ym,l.matchesProperty=vm,l.memoize=Zi,l.merge=Iv,l.mergeWith=ru,l.method=mm,l.methodOf=wm,l.mixin=kn,l.negate=Xi,l.nthArg=bm,l.omit=Sv,l.omitBy=Pv,l.once=_y,l.orderBy=ny,l.over=Em,l.overArgs=by,l.overEvery=Im,l.overSome=Sm,l.partial=An,l.partialRight=Bc,l.partition=oy,l.pick=Ov,l.pickBy=iu,l.property=hu,l.propertyOf=Pm,l.pull=ng,l.pullAll=qc,l.pullAllBy=og,l.pullAllWith=ag,l.pullAt=cg,l.range=Om,l.rangeRight=Rm,l.rearg=Ey,l.reject=uy,l.remove=ug,l.rest=Iy,l.reverse=Nn,l.sampleSize=ly,l.set=Nv,l.setWith=Cv,l.shuffle=py,l.slice=hg,l.sortBy=gy,l.sortedUniq=vg,l.sortedUniqBy=mg,l.split=Zv,l.spread=Sy,l.tail=wg,l.take=_g,l.takeRight=bg,l.takeRightWhile=Eg,l.takeWhile=Ig,l.tap=Mg,l.throttle=Py,l.thru=Ji,l.toArray=Zc,l.toPairs=su,l.toPairsIn=nu,l.toPath=xm,l.toPlainObject=eu,l.transform=$v,l.unary=Oy,l.union=Sg,l.unionBy=Pg,l.unionWith=Og,l.uniq=Rg,l.uniqBy=Ng,l.uniqWith=Cg,l.unset=Av,l.unzip=Cn,l.unzipWith=jc,l.update=xv,l.updateWith=Tv,l.values=Sr,l.valuesIn=Dv,l.without=$g,l.words=cu,l.wrap=Ry,l.xor=Ag,l.xorBy=xg,l.xorWith=Tg,l.zip=Dg,l.zipObject=Ug,l.zipObjectDeep=qg,l.zipWith=jg,l.entries=su,l.entriesIn=nu,l.extend=tu,l.extendWith=rs,kn(l,l),l.add=Dm,l.attempt=uu,l.camelCase=Mv,l.capitalize=ou,l.ceil=Um,l.clamp=Uv,l.clone=Cy,l.cloneDeep=Ay,l.cloneDeepWith=xy,l.cloneWith=$y,l.conformsTo=Ty,l.deburr=au,l.defaultTo=fm,l.divide=qm,l.endsWith=kv,l.eq=ct,l.escape=zv,l.escapeRegExp=Lv,l.every=Gg,l.find=Qg,l.findIndex=xc,l.findKey=uv,l.findLast=Yg,l.findLastIndex=Tc,l.findLastKey=hv,l.floor=jm,l.forEach=kc,l.forEachRight=zc,l.forIn=lv,l.forInRight=pv,l.forOwn=fv,l.forOwnRight=dv,l.get=Dn,l.gt=Dy,l.gte=Uy,l.has=vv,l.hasIn=Un,l.head=Uc,l.identity=De,l.includes=ry,l.indexOf=Yd,l.inRange=qv,l.invoke=_v,l.isArguments=rr,l.isArray=k,l.isArrayBuffer=qy,l.isArrayLike=xe,l.isArrayLikeObject=he,l.isBoolean=jy,l.isBuffer=zt,l.isDate=My,l.isElement=ky,l.isEmpty=zy,l.isEqual=Ly,l.isEqualWith=Vy,l.isError=xn,l.isFinite=Ky,l.isFunction=Rt,l.isInteger=Gc,l.isLength=es,l.isMap=Jc,l.isMatch=Hy,l.isMatchWith=Fy,l.isNaN=Wy,l.isNative=By,l.isNil=Jy,l.isNull=Gy,l.isNumber=Qc,l.isObject=oe,l.isObjectLike=ae,l.isPlainObject=Yr,l.isRegExp=Tn,l.isSafeInteger=Qy,l.isSet=Yc,l.isString=ts,l.isSymbol=Le,l.isTypedArray=Ir,l.isUndefined=Yy,l.isWeakMap=Zy,l.isWeakSet=Xy,l.join=rg,l.kebabCase=Vv,l.last=Ze,l.lastIndexOf=ig,l.lowerCase=Kv,l.lowerFirst=Hv,l.lt=ev,l.lte=tv,l.max=Mm,l.maxBy=km,l.mean=zm,l.meanBy=Lm,l.min=Vm,l.minBy=Km,l.stubArray=Ln,l.stubFalse=Vn,l.stubObject=Nm,l.stubString=Cm,l.stubTrue=$m,l.multiply=Hm,l.nth=sg,l.noConflict=_m,l.noop=zn,l.now=Yi,l.pad=Fv,l.padEnd=Wv,l.padStart=Bv,l.parseInt=Gv,l.random=jv,l.reduce=ay,l.reduceRight=cy,l.repeat=Jv,l.replace=Qv,l.result=Rv,l.round=Fm,l.runInContext=v,l.sample=hy,l.size=fy,l.snakeCase=Yv,l.some=dy,l.sortedIndex=lg,l.sortedIndexBy=pg,l.sortedIndexOf=fg,l.sortedLastIndex=dg,l.sortedLastIndexBy=gg,l.sortedLastIndexOf=yg,l.startCase=Xv,l.startsWith=em,l.subtract=Wm,l.sum=Bm,l.sumBy=Gm,l.template=tm,l.times=Am,l.toFinite=Nt,l.toInteger=z,l.toLength=Xc,l.toLower=rm,l.toNumber=Xe,l.toSafeInteger=rv,l.toString=J,l.toUpper=im,l.trim=sm,l.trimEnd=nm,l.trimStart=om,l.truncate=am,l.unescape=cm,l.uniqueId=Tm,l.upperCase=um,l.upperFirst=qn,l.each=kc,l.eachRight=zc,l.first=Uc,kn(l,function(){var e={};return dt(l,function(t,n){Q.call(l.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),l.VERSION=s,Be(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),Be(["drop","take"],function(e,t){H.prototype[e]=function(n){n=n===r?1:ye(z(n),0);var c=this.__filtered__&&!t?new H(this):this.clone();return c.__filtered__?c.__takeCount__=Ee(n,c.__takeCount__):c.__views__.push({size:Ee(n,ft),type:e+(c.__dir__<0?"Right":"")}),c},H.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Be(["filter","map","takeWhile"],function(e,t){var n=t+1,c=n==Do||n==sl;H.prototype[e]=function(h){var f=this.clone();return f.__iteratees__.push({iteratee:D(h,3),type:n}),f.__filtered__=f.__filtered__||c,f}}),Be(["head","last"],function(e,t){var n="take"+(t?"Right":"");H.prototype[e]=function(){return this[n](1).value()[0]}}),Be(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");H.prototype[e]=function(){return this.__filtered__?new H(this):this[n](1)}}),H.prototype.compact=function(){return this.filter(De)},H.prototype.find=function(e){return this.filter(e).head()},H.prototype.findLast=function(e){return this.reverse().find(e)},H.prototype.invokeMap=V(function(e,t){return typeof e=="function"?new H(this):this.map(function(n){return Fr(n,e,t)})}),H.prototype.reject=function(e){return this.filter(Xi(D(e)))},H.prototype.slice=function(e,t){e=z(e);var n=this;return n.__filtered__&&(e>0||t<0)?new H(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=z(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},H.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},H.prototype.toArray=function(){return this.take(ft)},dt(H.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),c=/^(?:head|last)$/.test(t),h=l[c?"take"+(t=="last"?"Right":""):t],f=c||/^find/.test(t);h&&(l.prototype[t]=function(){var d=this.__wrapped__,y=c?[1]:arguments,m=d instanceof H,I=y[0],S=m||k(d),P=function(K){var F=h.apply(l,Tt([K],y));return c&&O?F[0]:F};S&&n&&typeof I=="function"&&I.length!=1&&(m=S=!1);var O=this.__chain__,x=!!this.__actions__.length,U=f&&!O,L=m&&!x;if(!f&&S){d=L?d:new H(this);var q=e.apply(d,y);return q.__actions__.push({func:Ji,args:[P],thisArg:r}),new Je(q,O)}return U&&L?e.apply(this,y):(q=this.thru(P),U?c?q.value()[0]:q.value():q)})}),Be(["pop","push","shift","sort","splice","unshift"],function(e){var t=bi[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var h=arguments;if(c&&!this.__chain__){var f=this.value();return t.apply(k(f)?f:[],h)}return this[n](function(d){return t.apply(k(d)?d:[],h)})}}),dt(H.prototype,function(e,t){var n=l[t];if(n){var c=n.name+"";Q.call(mr,c)||(mr[c]=[]),mr[c].push({name:t,func:n})}}),mr[Vi(r,ie).name]=[{name:"wrapper",func:r}],H.prototype.clone=cf,H.prototype.reverse=uf,H.prototype.value=hf,l.prototype.at=kg,l.prototype.chain=zg,l.prototype.commit=Lg,l.prototype.next=Vg,l.prototype.plant=Hg,l.prototype.reverse=Fg,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Wg,l.prototype.first=l.prototype.head,Mr&&(l.prototype[Mr]=Kg),l},gr=zp();Gt?((Gt.exports=gr)._=gr,js._=gr):we._=gr}).call(ni)})(po,po.exports);var XE=Object.defineProperty,e1=Object.defineProperties,t1=Object.getOwnPropertyDescriptors,rh=Object.getOwnPropertySymbols,r1=Object.prototype.hasOwnProperty,i1=Object.prototype.propertyIsEnumerable,ih=(a,i,r)=>i in a?XE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ss=(a,i)=>{for(var r in i||(i={}))r1.call(i,r)&&ih(a,r,i[r]);if(rh)for(var r of rh(i))i1.call(i,r)&&ih(a,r,i[r]);return a},s1=(a,i)=>e1(a,t1(i));function it(a,i,r){let s;const o=fo(a);return i.rpcMap&&(s=i.rpcMap[o]),s||(s=`${ZE}?chainId=eip155:${o}&projectId=${r}`),s}function fo(a){return a.includes("eip155")?Number(a.split(":")[1]):Number(a)}function Qh(a){return a.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function n1(a,i){const r=Object.keys(i.namespaces).filter(o=>o.includes(a));if(!r.length)return[];const s=[];return r.forEach(o=>{const u=i.namespaces[o].accounts;s.push(...u)}),s}function o1(a={},i={}){const r=sh(a),s=sh(i);return po.exports.merge(r,s)}function sh(a){var i,r,s,o;const u={};if(!Rr(a))return u;for(const[p,g]of Object.entries(a)){const w=No(p)?[p]:g.chains,b=g.methods||[],N=g.events||[],$=g.rpcMap||{},A=as(p);u[A]=s1(ss(ss({},u[A]),g),{chains:Wn(w,(i=u[A])==null?void 0:i.chains),methods:Wn(b,(r=u[A])==null?void 0:r.methods),events:Wn(N,(s=u[A])==null?void 0:s.events),rpcMap:ss(ss({},$),(o=u[A])==null?void 0:o.rpcMap)})}return u}function a1(a){return a.includes(":")?a.split(":")[2]:a}function c1(a){const i={};for(const[r,s]of Object.entries(a)){const o=s.methods||[],u=s.events||[],p=s.accounts||[],g=No(r)?[r]:s.chains?s.chains:Qh(s.accounts);i[r]={chains:g,methods:o,events:u,accounts:p}}return i}const Yh={},pe=a=>Yh[a],Xn=(a,i)=>{Yh[a]=i};class u1{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const s=r||it(`${this.name}:${i}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;i[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||it(i,this.namespace);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}}class h1{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){const s=fo(i);if(!this.httpProviders[s]){const o=r||it(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,o)}this.chainId=s,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const s=r||it(`${this.name}:${i}`,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=fo(r);i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}async handleSwitchChain(i){var r,s;let o=i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const u=parseInt(o,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class l1{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const s=r||it(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.chainId=i,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;i[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||it(i,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}}class p1{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const s=r||it(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;i[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||it(i,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}}class f1{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const s=r||this.getCardanoRPCUrl(i);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r);i[r]=this.createHttpProvider(r,s)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||this.getCardanoRPCUrl(i);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}}class d1{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const s=r||it(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.chainId=i,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;i[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||it(i,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}}class g1{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const s=r||it(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.chainId=i,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;i[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||it(i,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ft(new ar(s,pe("disableProviderPing")))}}var y1=Object.defineProperty,v1=Object.defineProperties,m1=Object.getOwnPropertyDescriptors,nh=Object.getOwnPropertySymbols,w1=Object.prototype.hasOwnProperty,_1=Object.prototype.propertyIsEnumerable,oh=(a,i,r)=>i in a?y1(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,ns=(a,i)=>{for(var r in i||(i={}))w1.call(i,r)&&oh(a,r,i[r]);if(nh)for(var r of nh(i))_1.call(i,r)&&oh(a,r,i[r]);return a},eo=(a,i)=>v1(a,m1(i));class To{constructor(i){this.events=new vo,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof i?.logger<"u"&&typeof i?.logger!="string"?i.logger:ys(vs({level:i?.logger||eh})),this.disableProviderPing=i?.disableProviderPing||!1}static async init(i){const r=new To(i);return await r.initialize(),r}async request(i,r){const[s,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ns({},i),chainId:`${s}:${o}`,topic:this.session.topic})}sendAsync(i,r,s){this.request(i,s).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:de("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(u=>{this.session=u,this.namespaces||(this.namespaces=c1(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Gh)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{if(!this.session)return;const[s,o]=this.validateChain(i);this.getProvider(s).setDefaultChain(o,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(nr(r)){for(const s of r)i.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await GE.init({logger:this.providerOpts.logger||eh,relayUrl:this.providerOpts.relayUrl||JE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>as(r)))];Xn("client",this.client),Xn("events",this.events),Xn("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const s=n1(r,this.session),o=Qh(s),u=o1(this.namespaces,this.optionalNamespaces),p=eo(ns({},u[r]),{accounts:s,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new h1({namespace:p});break;case"solana":this.rpcProviders[r]=new l1({namespace:p});break;case"cosmos":this.rpcProviders[r]=new p1({namespace:p});break;case"polkadot":this.rpcProviders[r]=new u1({namespace:p});break;case"cip34":this.rpcProviders[r]=new f1({namespace:p});break;case"elrond":this.rpcProviders[r]=new d1({namespace:p});break;case"multiversx":this.rpcProviders[r]=new g1({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:s}=r;if(s.name==="accountsChanged"){const o=s.data;o&&nr(o)&&this.events.emit("accountsChanged",o.map(a1))}else s.name==="chainChanged"?this.onChainChanged(r.chainId):this.events.emit(s.name,s.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var s;const{namespaces:o}=r,u=(s=this.client)==null?void 0:s.session.get(i);this.session=eo(ns({},u),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",eo(ns({},de("USER_DISCONNECTED")),{data:i.topic}))}),this.on(Wt.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:s,sessionProperties:o}=i;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(i){const[r,s]=i?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(p=>as(p)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const o=as(Object.keys(this.namespaces)[0]),u=this.rpcProviders[o].getDefaultChain();return[o,u]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var s;if(!this.namespaces)return;const[o,u]=this.validateChain(i);r||this.getProvider(o).setDefaultChain(u),((s=this.namespaces[o])!=null?s:this.namespaces[`${o}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${th}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${th}/${i}`)}}const b1=To,E1="wc",I1="ethereum_provider",S1=`${E1}@2:${I1}:`,P1="https://rpc.walletconnect.com/v1/",go=["eth_sendTransaction","personal_sign"],O1=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],yo=["chainChanged","accountsChanged"],R1=["message","disconnect","connect"];var N1=Object.defineProperty,C1=Object.defineProperties,$1=Object.getOwnPropertyDescriptors,ah=Object.getOwnPropertySymbols,A1=Object.prototype.hasOwnProperty,x1=Object.prototype.propertyIsEnumerable,ch=(a,i,r)=>i in a?N1(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,oi=(a,i)=>{for(var r in i||(i={}))A1.call(i,r)&&ch(a,r,i[r]);if(ah)for(var r of ah(i))x1.call(i,r)&&ch(a,r,i[r]);return a},uh=(a,i)=>C1(a,$1(i));function fs(a){return Number(a[0].split(":")[1])}function to(a){return`0x${a.toString(16)}`}function T1(a){const{chains:i,optionalChains:r,methods:s,optionalMethods:o,events:u,optionalEvents:p,rpcMap:g}=a;if(!ro(i))throw new Error("Invalid chains");const w={chains:i,methods:s||go,events:u||yo,rpcMap:oi({},i.length?{[fs(i)]:g[fs(i)]}:{})},b=u?.filter(W=>!yo.includes(W)),N=s?.filter(W=>!go.includes(W));if(!r&&!p&&!o&&!(b!=null&&b.length)&&!(N!=null&&N.length))return{required:i.length?w:void 0};const $=b?.length&&N?.length||!r,A={chains:[...new Set($?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:O1))],events:[...new Set(w.events.concat(p||R1))],rpcMap:g};return{required:i.length?w:void 0,optional:r.length?A:void 0}}class Zh{constructor(){this.events=new pt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=S1,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new Zh;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:s}=T1(this.rpc);try{const o=await new Promise(async(p,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(b=>{!b.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(uh(oi({namespaces:oi({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:i?.pairingTopic})).then(b=>{p(b)}).catch(b=>{g(new Error(b.message))})});if(!o)return;this.setChainIds(this.rpc.chains);const u=hw(o.namespaces,[this.namespace]);this.setAccounts(u),this.events.emit("connect",{chainId:to(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",to(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",uh(oi({},pw("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",to(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(i){const[r,s,o]=i.split(":");return{chainId:`${r}:${s}`,address:o}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,s;const o=(r=i?.chains)!=null?r:[],u=(s=i?.optionalChains)!=null?s:[],p=o.concat(u);if(!p.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=o.length?i?.methods||go:[],w=o.length?i?.events||yo:[],b=i?.optionalMethods||[],N=i?.optionalEvents||[],$=i?.rpcMap||this.buildRpcMap(p,i.projectId),A=i?.qrModalOptions||void 0;return{chains:o?.map(W=>this.formatChainId(W)),optionalChains:u.map(W=>this.formatChainId(W)),methods:g,events:w,optionalMethods:b,optionalEvents:N,rpcMap:$,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:A,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const s={};return i.forEach(o=>{s[o]=this.getRpcUrl(o,r)}),s}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?fs(this.rpc.chains):fs(this.rpc.optionalChains),this.signer=await b1.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Jm(()=>import("./index8.js").then(o=>o.i),__vite__mapDeps([0,1,2,3]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(oi({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:s,rpcMap:o}=i;r&&ro(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=o?.[u]||this.getRpcUrl(u)})),s&&ro(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s?.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=o?.[u]||this.getRpcUrl(u)}))}getRpcUrl(i,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[i])||`${P1}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:r?.accounts),this.setAccounts(r?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}export{R1 as OPTIONAL_EVENTS,O1 as OPTIONAL_METHODS,yo as REQUIRED_EVENTS,go as REQUIRED_METHODS,Zh as default};
