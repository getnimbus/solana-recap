{"version":3,"file":"signer-CSn2uQ3I.js","sources":["../../node_modules/@wormhole-foundation/wormhole-connect/lib/signer-CSn2uQ3I.mjs"],"sourcesContent":["var S = Object.defineProperty;\nvar x = (r, t, e) => t in r ? S(r, t, { enumerable: !0, configurable: !0, writable: !0, value: e }) : r[t] = e;\nvar h = (r, t, e) => x(r, typeof t != \"symbol\" ? t + \"\" : t, e);\nimport { e as _, bc as I, ad as P, bd as A, be as M, b8 as y, b9 as R, u as L, bb as b } from \"./index-DgePBEwv.mjs\";\nconst F = 0.5, E = 1, T = 1, k = 1e9, B = 5, U = 25e4;\nasync function V(r, t, e) {\n  const [n, i] = await _.chainFromRpc(r), g = typeof t == \"string\" ? I.fromSecretKey(P.decode(t)) : t;\n  if (e != null && e.priorityFee && e.priorityFee.percentile && e.priorityFee.percentile > 1)\n    throw new Error(\"priorityFeePercentile must be a number between 0 and 1\");\n  return new C(r, i, g, (e == null ? void 0 : e.debug) ?? !1, (e == null ? void 0 : e.priorityFee) ?? {}, (e == null ? void 0 : e.retries) ?? B, e == null ? void 0 : e.sendOpts);\n}\nclass C {\n  constructor(t, e, n, i = !1, g, l = B, u) {\n    h(this, \"_rpc\");\n    h(this, \"_chain\");\n    h(this, \"_keypair\");\n    h(this, \"_debug\");\n    h(this, \"_priorityFee\");\n    h(this, \"_maxResubmits\");\n    h(this, \"_sendOpts\");\n    this._rpc = t, this._chain = e, this._keypair = n, this._debug = i, this._priorityFee = g, this._maxResubmits = l, this._sendOpts = u, this._sendOpts = this._sendOpts ?? {\n      preflightCommitment: this._rpc.commitment\n    };\n  }\n  chain() {\n    return this._chain;\n  }\n  address() {\n    return this._keypair.publicKey.toBase58();\n  }\n  // Handles retrying a Transaction if the error is deemed to be\n  // recoverable. Currently handles:\n  // - Transaction expired\n  // - Blockhash not found\n  // - Not enough bytes (storage account not seen yet)\n  retryable(t) {\n    var n;\n    if (t instanceof A)\n      return !0;\n    if (!(t instanceof M) || !t.message.includes(\"Transaction simulation failed\"))\n      return !1;\n    if (t.message.includes(\"Blockhash not found\"))\n      return !0;\n    const e = (n = t.logs) == null ? void 0 : n.find((i) => i.startsWith(\"Program log: Error: \"));\n    return e ? !!(e.includes(\"Not enough bytes\") || e.includes(\"Unexpected length of input\")) : !1;\n  }\n  async signAndSend(t) {\n    var u;\n    let { blockhash: e, lastValidBlockHeight: n } = await _.latestBlock(this._rpc);\n    const i = [];\n    for (const a of t) {\n      const { description: c, transaction: { transaction: o, signers: s } } = a;\n      this._debug && console.log(`Signing: ${c} for ${this.address()}`);\n      let d;\n      (u = this._priorityFee) != null && u.percentile && this._priorityFee.percentile > 0 && (d = await O(this._rpc, o, this._priorityFee.percentile, this._priorityFee.percentileMultiple, this._priorityFee.min, this._priorityFee.max)), this._debug && D(o);\n      for (let m = 0; m < this._maxResubmits; m++)\n        try {\n          if (y(o)) {\n            if (d && m === 0) {\n              const p = R.decompile(o.message);\n              p.instructions.push(...d), o.message = p.compileToV0Message();\n            }\n            o.message.recentBlockhash = e, o.sign([this._keypair, ...s ?? []]);\n          } else\n            d && m === 0 && o.add(...d), o.recentBlockhash = e, o.lastValidBlockHeight = n, o.partialSign(this._keypair, ...s ?? []);\n          this._debug && console.log(\"Submitting transactions \");\n          const { signature: f } = await _.sendTxWithRetry(this._rpc, o.serialize(), this._sendOpts);\n          i.push(f);\n          break;\n        } catch (f) {\n          if (m === this._maxResubmits - 1 || !this.retryable(f))\n            throw f;\n          this._debug && console.log(`Failed to send transaction on attempt ${m}, retrying: `, f);\n          const { blockhash: p, lastValidBlockHeight: w } = await _.latestBlock(this._rpc);\n          n = w, e = p;\n        }\n    }\n    this._debug && console.log(\"Waiting for confirmation for: \", i);\n    const l = (await Promise.all(i.map(async (a) => {\n      try {\n        return await this._rpc.confirmTransaction({\n          signature: a,\n          blockhash: e,\n          lastValidBlockHeight: n\n        }, this._rpc.commitment);\n      } catch (c) {\n        throw console.error(\"Failed to confirm transaction: \", c), c;\n      }\n    }))).filter((a) => a.value.err).map((a) => a.value.err);\n    if (l.length > 0)\n      throw new Error(`Failed to confirm transaction: ${l}`);\n    return i;\n  }\n}\nfunction D(r) {\n  if (y(r)) {\n    console.log(r.signatures);\n    const t = r.message, e = t.getAccountKeys();\n    t.compiledInstructions.forEach((n) => {\n      console.log(\"Program\", e.get(n.programIdIndex).toBase58()), console.log(\"Data: \", L.encode(n.data)), console.log(\"Keys: \", n.accountKeyIndexes.map((i) => [i, e.get(i).toBase58()]));\n    });\n  } else\n    console.log(r.signatures), console.log(r.feePayer), r.instructions.forEach((t) => {\n      console.log(\"Program\", t.programId.toBase58()), console.log(\"Data: \", t.data.toString(\"hex\")), console.log(\"Keys: \", t.keys.map((e) => [e, e.pubkey.toBase58()]));\n    });\n}\nasync function O(r, t, e = F, n = E, i = T, g = k) {\n  const [l, u] = await Promise.all([\n    K(r, t),\n    W(r, t, e, n, i, g)\n  ]);\n  return [\n    b.setComputeUnitLimit({\n      units: l\n    }),\n    b.setComputeUnitPrice({\n      microLamports: u\n    })\n  ];\n}\nasync function K(r, t) {\n  var n;\n  let e = U;\n  try {\n    const i = await (y(t), r.simulateTransaction(t));\n    i.value.err && console.error(`Error simulating Solana transaction: ${i.value.err}`), (n = i == null ? void 0 : i.value) != null && n.unitsConsumed && (e = Math.round(i.value.unitsConsumed * 1.2));\n  } catch (i) {\n    console.error(`Failed to calculate compute unit limit for Solana transaction: ${i}`);\n  }\n  return e;\n}\nasync function W(r, t, e = F, n = E, i = T, g = k) {\n  let l = i, u = [];\n  if (y(t)) {\n    const a = (await Promise.all(t.message.addressTableLookups.map((s) => r.getAddressLookupTable(s.accountKey)))).map((s) => s.value).filter((s) => s !== null), c = t.message, o = c.getAccountKeys({\n      addressLookupTableAccounts: a ?? void 0\n    });\n    u = c.compiledInstructions.flatMap((s) => s.accountKeyIndexes).map((s) => c.isAccountWritable(s) ? o.get(s) : null).filter((s) => s !== null);\n  } else\n    u = t.instructions.flatMap((a) => a.keys).map((a) => a.isWritable ? a.pubkey : null).filter((a) => a !== null);\n  try {\n    const a = await r.getRecentPrioritizationFees({\n      lockedWritableAccounts: u\n    });\n    if (a) {\n      const c = a.map((s) => s.prioritizationFee).sort((s, d) => s - d), o = Math.ceil(c.length * e);\n      if (c.length > o) {\n        let s = c[o];\n        n > 0 && (s *= n), l = Math.max(l, s);\n      }\n    }\n  } catch (a) {\n    console.error(\"Error fetching Solana recent fees\", a);\n  }\n  return Math.min(Math.max(l, i), g);\n}\nexport {\n  W as d,\n  V as g\n};\n"],"names":["S","x","r","t","e","h","F","E","T","k","B","U","V","n","_","g","I","P","C","l","u","A","M","i","a","c","o","s","d","O","D","m","y","p","R","f","w","L","K","W","b"],"mappings":"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","x_google_ignoreList":[0]}