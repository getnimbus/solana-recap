{"version":3,"file":"TMATonAuth.js","sources":["../../src/UI/Auth/TMATonAuth.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import * as browser from \"webextension-polyfill\";\n  import { useQueryClient } from \"@tanstack/svelte-query\";\n  import {\n    isDarkMode,\n    tonConnector,\n    wallet,\n    chain,\n    typeWallet,\n    tab,\n  } from \"~/store\";\n  import mixpanel from \"mixpanel-browser\";\n  import { nimbus } from \"~/lib/network\";\n  import { triggerToast } from \"~/utils/functions\";\n  import { bigGeneration, otherGeneration } from \"~/lib/chains\";\n\n  import Ton from \"~/assets/chains/ton.png\";\n  import Button from \"~/components/Button.svelte\";\n  import { shorterAddress } from \"~/utils\";\n\n  export let selectYourWalletsBundle: any;\n  export let closeMobileAddAccountModal = () => {};\n  export let isFromHero = false;\n\n  const queryClient = useQueryClient();\n\n  const handleTonAuth = async () => {\n    mixpanel.track(\"user_login_ton\");\n\n    if ($tonConnector?.connected) {\n      $tonConnector.disconnect();\n    }\n\n    handleLoginTON();\n  };\n\n  const handleLoginTON = async () => {\n    try {\n      $tonConnector.openModal();\n\n      $tonConnector.onStatusChange((wallet) => {\n        handleAddTon(wallet);\n      });\n    } catch (e) {\n      if ($tonConnector?.connected) {\n        $tonConnector.disconnect();\n      }\n    }\n  };\n\n  const handleAddTon = async (data: any) => {\n    try {\n      if (data && data?.account?.address) {\n        const dataFormat = {\n          id: data?.account?.address,\n          label: `TON Wallet ${shorterAddress(data?.account?.address)}`,\n          value: data?.account?.address,\n        };\n\n        if (selectYourWalletsBundle && selectYourWalletsBundle.length !== 0) {\n          await nimbus.put(\n            `/address/personalize/bundle?name=${\"Your wallets\"}`,\n            {\n              name: \"Your wallets\",\n              addresses: selectYourWalletsBundle?.concat([dataFormat.value]),\n            },\n          );\n          queryClient.invalidateQueries([\"list-bundle\"]);\n        }\n\n        const response: any = await nimbus.post(\"/accounts\", {\n          type: \"DEX\",\n          publicAddress: dataFormat.value,\n          accountId: dataFormat.value,\n          label: dataFormat.label,\n        });\n\n        if (response?.error) {\n          triggerToast(\"Can't add new wallet address at this time!\", \"fail\");\n          return;\n        }\n\n        queryClient.invalidateQueries([\"list-address\"]);\n        wallet.update((n) => (n = dataFormat.value));\n        chain.update((n) => (n = \"ALL\"));\n        typeWallet.update((n) => (n = \"MOVE\"));\n\n        browser.storage.sync.set({ selectedChain: \"ALL\" });\n        browser.storage.sync.set({\n          typeWalletAddress: \"MOVE\",\n        });\n        browser.storage.sync.set({\n          selectedWallet: dataFormat.value,\n        });\n\n        if (bigGeneration.includes(\"MOVE\")) {\n          window.history.replaceState(\n            null,\n            \"\",\n            window.location.pathname +\n              `?tab=${$tab}&type=${\"MOVE\"}&chain=ALL&address=${dataFormat.value}`,\n          );\n        }\n\n        if (otherGeneration.includes(\"MOVE\")) {\n          window.history.replaceState(\n            null,\n            \"\",\n            window.location.pathname +\n              `?tab=${$tab}&type=${\"MOVE\"}&address=${dataFormat.value}`,\n          );\n        }\n\n        closeMobileAddAccountModal();\n\n        if ($tonConnector?.connected) {\n          $tonConnector.disconnect();\n        }\n\n        triggerToast(\"Successfully add TON account!\", \"success\");\n\n        mixpanel.track(\"user_add_address\");\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  };\n</script>\n\n{#if isFromHero}\n  <Button on:click={handleTonAuth}>Connect TON</Button>\n{:else}\n  <div\n    class={`flex items-center justify-center gap-3 text-white border cursor-pointer rounded-[12px] w-[219px] h-[46px] ${\n      $isDarkMode\n        ? \"border-white text-white\"\n        : \"border-[#27326f] text-[#27326f]\"\n    }`}\n    style=\"padding: 9px 21px 11px;\"\n    on:click={handleTonAuth}\n  >\n    <img src={Ton} alt=\"\" class=\"h-[22px] w-[24px]\" />\n    <div class=\"font-medium text-base\">Connect TON</div>\n  </div>\n{/if}\n\n<style></style>\n"],"names":["Ton","attr","img","img_src_value","ctx","insert","target","div1","anchor","append","div0"],"mappings":"qdA6IcA,CAAG,GAAAC,EAAAC,EAAA,MAAAC,CAAA,iPAPXC,EAAC,CAAA,EACG,0BACA,iCAAgC,EAAA,EAAA,iBAAA,yCAJxCC,EAWKC,EAAAC,EAAAC,CAAA,EAFHC,EAAiDF,EAAAL,CAAA,SACjDO,EAAmDF,EAAAG,CAAA,oBAHzCN,EAAa,CAAA,CAAA,2IALrBA,EAAC,CAAA,EACG,0BACA,iCAAgC,EAAA,EAAA,0KANtBA,EAAa,CAAA,CAAA,qOAAE,aAAW,0GADzCA,EAAU,CAAA,EAAA"}