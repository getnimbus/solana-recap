import{bu as Iw}from"./index.js";import{r as be,a as xo}from"./events-BZxm5jrM.js";import{m as X,dr as Pw,ac as To,dp as Nu,aw as Sw}from"./Bridge.js";import{s as $,y as Ao,g as zl,p as Vl,G as Ow,L as Hl,R as Oi}from"./index-q3BebMyx.js";import{Y as xi,D as Ti,k as Ai,$ as zt,d as Jt,B as hr,W as Nw,J as qr,G as Kl,w as _e,a as Di,x as Be,l as Do,X as qo,V as Ru,U as Rw,m as de,b as se,Z as Cw,M as xw,o as Tw,H as Cu,A as Aw,F as Dw,q as qw,u as xu,j as $w}from"./index-B4RQFL8S.js";var it={};Object.defineProperty(it,"__esModule",{value:!0});it.getLocalStorage=it.getLocalStorageOrThrow=it.getCrypto=it.getCryptoOrThrow=it.getLocation=it.getLocationOrThrow=it.getNavigator=it.getNavigatorOrThrow=it.getDocument=it.getDocumentOrThrow=it.getFromWindowOrThrow=it.getFromWindow=void 0;function pr(o){let e;return typeof window<"u"&&typeof window[o]<"u"&&(e=window[o]),e}it.getFromWindow=pr;function Ur(o){const e=pr(o);if(!e)throw new Error(`${o} is not defined in Window`);return e}it.getFromWindowOrThrow=Ur;function jw(){return Ur("document")}it.getDocumentOrThrow=jw;function Uw(){return pr("document")}it.getDocument=Uw;function Mw(){return Ur("navigator")}it.getNavigatorOrThrow=Mw;function Lw(){return pr("navigator")}it.getNavigator=Lw;function kw(){return Ur("location")}it.getLocationOrThrow=kw;function zw(){return pr("location")}it.getLocation=zw;function Vw(){return Ur("crypto")}it.getCryptoOrThrow=Vw;function Hw(){return pr("crypto")}it.getCrypto=Hw;function Kw(){return Ur("localStorage")}it.getLocalStorageOrThrow=Kw;function Ww(){return pr("localStorage")}it.getLocalStorage=Ww;var $o={};Object.defineProperty($o,"__esModule",{value:!0});$o.getWindowMetadata=void 0;const Tu=it;function Fw(){let o,e;try{o=Tu.getDocumentOrThrow(),e=Tu.getLocationOrThrow()}catch{return null}function r(){const S=o.getElementsByTagName("link"),O=[];for(let R=0;R<S.length;R++){const U=S[R],D=U.getAttribute("rel");if(D&&D.toLowerCase().indexOf("icon")>-1){const A=U.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if(A.indexOf("/")===0)F+=A;else{const Y=e.pathname.split("/");Y.pop();const yt=Y.join("/");F+=yt+"/"+A}O.push(F)}else if(A.indexOf("//")===0){const F=e.protocol+A;O.push(F)}else O.push(A)}}return O}function i(...S){const O=o.getElementsByTagName("meta");for(let R=0;R<O.length;R++){const U=O[R],D=["itemprop","property","name"].map(A=>U.getAttribute(A)).filter(A=>A?S.includes(A):!1);if(D.length&&D){const A=U.getAttribute("content");if(A)return A}}return""}function a(){let S=i("name","og:site_name","og:title","twitter:title");return S||(S=o.title),S}function u(){return i("description","og:description","twitter:description","keywords")}const h=a(),g=u(),w=e.origin,b=r();return{description:g,url:w,icons:b,name:h}}$o.getWindowMetadata=Fw;function Bw(o,e=[]){const r=[];return Object.keys(o).forEach(i=>{if(e.length&&!e.includes(i))return;const a=o[i];r.push(...a.accounts)}),r}const Gw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Jw(o,e){const{message:r,code:i}=Gw[o];return{message:r,code:i}}function vo(o,e){return!!Array.isArray(o)}var Mr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yo=function(o,e){return yo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a])},yo(o,e)};function Qw(o,e){yo(o,e);function r(){this.constructor=o}o.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var mo=function(){return mo=Object.assign||function(o){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=e[a])}return o},mo.apply(this,arguments)};function Yw(o,e){var r={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&e.indexOf(i)<0&&(r[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(o);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(o,i[a])&&(r[i[a]]=o[i[a]]);return r}function Zw(o,e,r,i){var a=arguments.length,u=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,e,r,i);else for(var g=o.length-1;g>=0;g--)(h=o[g])&&(u=(a<3?h(u):a>3?h(e,r,u):h(e,r))||u);return a>3&&u&&Object.defineProperty(e,r,u),u}function Xw(o,e){return function(r,i){e(r,i,o)}}function t_(o,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,e)}function e_(o,e,r,i){function a(u){return u instanceof r?u:new r(function(h){h(u)})}return new(r||(r=Promise))(function(u,h){function g(S){try{b(i.next(S))}catch(O){h(O)}}function w(S){try{b(i.throw(S))}catch(O){h(O)}}function b(S){S.done?u(S.value):a(S.value).then(g,w)}b((i=i.apply(o,e||[])).next())})}function r_(o,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,a,u,h;return h={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function g(b){return function(S){return w([b,S])}}function w(b){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(u=b[0]&2?a.return:b[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,b[1])).done)return u;switch(a=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,a=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){r.label=b[1];break}if(b[0]===6&&r.label<u[1]){r.label=u[1],u=b;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(b);break}u[2]&&r.ops.pop(),r.trys.pop();continue}b=e.call(o,r)}catch(S){b=[6,S],a=0}finally{i=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function n_(o,e,r,i){i===void 0&&(i=r),o[i]=e[r]}function i_(o,e){for(var r in o)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=o[r])}function wo(o){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&o[e],i=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wl(o,e){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var i=r.call(o),a,u=[],h;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)u.push(a.value)}catch(g){h={error:g}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(h)throw h.error}}return u}function s_(){for(var o=[],e=0;e<arguments.length;e++)o=o.concat(Wl(arguments[e]));return o}function o_(){for(var o=0,e=0,r=arguments.length;e<r;e++)o+=arguments[e].length;for(var i=Array(o),a=0,e=0;e<r;e++)for(var u=arguments[e],h=0,g=u.length;h<g;h++,a++)i[a]=u[h];return i}function En(o){return this instanceof En?(this.v=o,this):new En(o)}function a_(o,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(o,e||[]),a,u=[];return a={},h("next"),h("throw"),h("return"),a[Symbol.asyncIterator]=function(){return this},a;function h(R){i[R]&&(a[R]=function(U){return new Promise(function(D,A){u.push([R,U,D,A])>1||g(R,U)})})}function g(R,U){try{w(i[R](U))}catch(D){O(u[0][3],D)}}function w(R){R.value instanceof En?Promise.resolve(R.value.v).then(b,S):O(u[0][2],R)}function b(R){g("next",R)}function S(R){g("throw",R)}function O(R,U){R(U),u.shift(),u.length&&g(u[0][0],u[0][1])}}function c_(o){var e,r;return e={},i("next"),i("throw",function(a){throw a}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(a,u){e[a]=o[a]?function(h){return(r=!r)?{value:En(o[a](h)),done:a==="return"}:u?u(h):h}:u}}function u_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],r;return e?e.call(o):(o=typeof wo=="function"?wo(o):o[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(u){r[u]=o[u]&&function(h){return new Promise(function(g,w){h=o[u](h),a(g,w,h.done,h.value)})}}function a(u,h,g,w){Promise.resolve(w).then(function(b){u({value:b,done:g})},h)}}function l_(o,e){return Object.defineProperty?Object.defineProperty(o,"raw",{value:e}):o.raw=e,o}function h_(o){if(o&&o.__esModule)return o;var e={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e.default=o,e}function p_(o){return o&&o.__esModule?o:{default:o}}function f_(o,e){if(!e.has(o))throw new TypeError("attempted to get private field on non-instance");return e.get(o)}function d_(o,e,r){if(!e.has(o))throw new TypeError("attempted to set private field on non-instance");return e.set(o,r),r}const g_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return mo},__asyncDelegator:c_,__asyncGenerator:a_,__asyncValues:u_,__await:En,__awaiter:e_,__classPrivateFieldGet:f_,__classPrivateFieldSet:d_,__createBinding:n_,__decorate:Zw,__exportStar:i_,__extends:Qw,__generator:r_,__importDefault:p_,__importStar:h_,__makeTemplateObject:l_,__metadata:t_,__param:Xw,__read:Wl,__rest:Yw,__spread:s_,__spreadArrays:o_,__values:wo},Symbol.toStringTag,{value:"Module"})),qi=To(g_);var pn={},Au={},fn={};const v_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:hr},Symbol.toStringTag,{value:"Module"})),y_=To(v_);var Du;function m_(){if(Du)return fn;Du=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.IHeartBeat=void 0;const o=y_;class e extends o.IEvents{constructor(i){super()}}return fn.IHeartBeat=e,fn}var qu;function Fl(){return qu||(qu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),qi.__exportStar(m_(),o)}(Au)),Au}var $u={},cr={},ju;function w_(){if(ju)return cr;ju=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.HEARTBEAT_EVENTS=cr.HEARTBEAT_INTERVAL=void 0;const o=$;return cr.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,cr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},cr}var Uu;function Bl(){return Uu||(Uu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),qi.__exportStar(w_(),o)}($u)),$u}var Mu;function __(){if(Mu)return pn;Mu=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.HeartBeat=void 0;const o=qi,e=Pw(),r=$,i=Fl(),a=Bl();class u extends i.IHeartBeat{constructor(g){super(g),this.events=new e.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=g?.interval||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const w=new u(g);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return pn.HeartBeat=u,pn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const e=qi;e.__exportStar(__(),o),e.__exportStar(Fl(),o),e.__exportStar(Bl(),o)})(Mr);class b_ extends hr{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let E_=class extends hr{constructor(o,e){super(),this.core=o,this.logger=e,this.records=new Map}};class I_{constructor(e,r){this.logger=e,this.core=r}}let P_=class extends hr{constructor(o,e){super(),this.relayer=o,this.logger=e}},S_=class extends hr{constructor(o){super()}},O_=class{constructor(o,e,r,i){this.core=o,this.logger=e,this.name=r}},N_=class extends hr{constructor(o,e){super(),this.relayer=o,this.logger=e}},R_=class extends hr{constructor(o,e){super(),this.core=o,this.logger=e}},C_=class{constructor(o,e){this.projectId=o,this.logger=e}},x_=class{constructor(o,e){this.projectId=o,this.logger=e}},T_=class{constructor(o){this.opts=o,this.protocol="wc",this.version=2}},A_=class{constructor(o){this.client=o}};const D_=o=>JSON.stringify(o,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),q_=o=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function $_(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return q_(o)}catch{return o}}function j_(o){return typeof o=="string"?o:D_(o)||""}var Lu=function(o,e,r){for(var i=0,a=e.length,u;i<a;i++)(u||!(i in e))&&(u||(u=Array.prototype.slice.call(e,0,i)),u[i]=e[i]);return o.concat(u||Array.prototype.slice.call(e))},U_=function(){function o(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return o}(),M_=function(){function o(e){this.version=e,this.type="node",this.name="node",this.os=X.process.platform}return o}(),L_=function(){function o(e,r,i,a){this.name=e,this.version=r,this.os=i,this.bot=a,this.type="bot-device"}return o}(),k_=function(){function o(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return o}(),z_=function(){function o(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return o}(),V_=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,H_=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ku=3,K_=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",V_]],zu=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function W_(o){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new z_:typeof navigator<"u"?B_(navigator.userAgent):J_()}function F_(o){return o!==""&&K_.reduce(function(e,r){var i=r[0],a=r[1];if(e)return e;var u=a.exec(o);return!!u&&[i,u]},!1)}function B_(o){var e=F_(o);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new k_;var a=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);a?a.length<ku&&(a=Lu(Lu([],a,!0),Q_(ku-a.length))):a=[];var u=a.join("."),h=G_(o),g=H_.exec(o);return g&&g[1]?new L_(r,u,h,g[1]):new U_(r,u,h)}function G_(o){for(var e=0,r=zu.length;e<r;e++){var i=zu[e],a=i[0],u=i[1],h=u.exec(o);if(h)return a}return null}function J_(){var o=typeof X.process<"u"&&X.process.version;return o?new M_(X.process.version.slice(1)):null}function Q_(o){for(var e=[],r=0;r<o;r++)e.push("0");return e}var st={};Object.defineProperty(st,"__esModule",{value:!0});st.getLocalStorage=st.getLocalStorageOrThrow=st.getCrypto=st.getCryptoOrThrow=Gl=st.getLocation=st.getLocationOrThrow=Uo=st.getNavigator=st.getNavigatorOrThrow=jo=st.getDocument=st.getDocumentOrThrow=st.getFromWindowOrThrow=st.getFromWindow=void 0;function fr(o){let e;return typeof window<"u"&&typeof window[o]<"u"&&(e=window[o]),e}st.getFromWindow=fr;function Lr(o){const e=fr(o);if(!e)throw new Error(`${o} is not defined in Window`);return e}st.getFromWindowOrThrow=Lr;function Y_(){return Lr("document")}st.getDocumentOrThrow=Y_;function Z_(){return fr("document")}var jo=st.getDocument=Z_;function X_(){return Lr("navigator")}st.getNavigatorOrThrow=X_;function tb(){return fr("navigator")}var Uo=st.getNavigator=tb;function eb(){return Lr("location")}st.getLocationOrThrow=eb;function rb(){return fr("location")}var Gl=st.getLocation=rb;function nb(){return Lr("crypto")}st.getCryptoOrThrow=nb;function ib(){return fr("crypto")}st.getCrypto=ib;function sb(){return Lr("localStorage")}st.getLocalStorageOrThrow=sb;function ob(){return fr("localStorage")}st.getLocalStorage=ob;var Mo={};Object.defineProperty(Mo,"__esModule",{value:!0});var Jl=Mo.getWindowMetadata=void 0;const Vu=st;function ab(){let o,e;try{o=Vu.getDocumentOrThrow(),e=Vu.getLocationOrThrow()}catch{return null}function r(){const S=o.getElementsByTagName("link"),O=[];for(let R=0;R<S.length;R++){const U=S[R],D=U.getAttribute("rel");if(D&&D.toLowerCase().indexOf("icon")>-1){const A=U.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let F=e.protocol+"//"+e.host;if(A.indexOf("/")===0)F+=A;else{const Y=e.pathname.split("/");Y.pop();const yt=Y.join("/");F+=yt+"/"+A}O.push(F)}else if(A.indexOf("//")===0){const F=e.protocol+A;O.push(F)}else O.push(A)}}return O}function i(...S){const O=o.getElementsByTagName("meta");for(let R=0;R<O.length;R++){const U=O[R],D=["itemprop","property","name"].map(A=>U.getAttribute(A)).filter(A=>A?S.includes(A):!1);if(D.length&&D){const A=U.getAttribute("content");if(A)return A}}return""}function a(){let S=i("name","og:site_name","og:title","twitter:title");return S||(S=o.title),S}function u(){return i("description","og:description","twitter:description","keywords")}const h=a(),g=u(),w=e.origin,b=r();return{description:g,url:w,icons:b,name:h}}Jl=Mo.getWindowMetadata=ab;const cb=":";function ub(o){const[e,r]=o.split(cb);return{namespace:e,reference:r}}function Ql(o,e){return o.includes(":")?[o]:e.chains||[]}const Yl="base10",Dt="base16",_o="base64pad",Lo="utf8",Zl=0,dr=1,lb=0,Hu=1,bo=12,ko=32;function hb(){const o=zl.generateKeyPair();return{privateKey:se(o.secretKey,Dt),publicKey:se(o.publicKey,Dt)}}function Eo(){const o=Vl.randomBytes(ko);return se(o,Dt)}function pb(o,e){const r=zl.sharedKey(de(o,Dt),de(e,Dt),!0),i=new Ow(Ao.SHA256,r).expand(ko);return se(i,Dt)}function fb(o){const e=Ao.hash(de(o,Dt));return se(e,Dt)}function $r(o){const e=Ao.hash(de(o,Lo));return se(e,Dt)}function db(o){return de(`${o}`,Yl)}function Pn(o){return Number(se(o,Yl))}function gb(o){const e=db(typeof o.type<"u"?o.type:Zl);if(Pn(e)===dr&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?de(o.senderPublicKey,Dt):void 0,i=typeof o.iv<"u"?de(o.iv,Dt):Vl.randomBytes(bo),a=new Hl.ChaCha20Poly1305(de(o.symKey,Dt)).seal(i,de(o.message,Lo));return yb({type:e,sealed:a,iv:i,senderPublicKey:r})}function vb(o){const e=new Hl.ChaCha20Poly1305(de(o.symKey,Dt)),{sealed:r,iv:i}=Ni(o.encoded),a=e.open(i,r);if(a===null)throw new Error("Failed to decrypt");return se(a,Lo)}function yb(o){if(Pn(o.type)===dr){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return se(xu([o.type,o.senderPublicKey,o.iv,o.sealed]),_o)}return se(xu([o.type,o.iv,o.sealed]),_o)}function Ni(o){const e=de(o,_o),r=e.slice(lb,Hu),i=Hu;if(Pn(r)===dr){const g=i+ko,w=g+bo,b=e.slice(i,g),S=e.slice(g,w),O=e.slice(w);return{type:r,sealed:O,iv:S,senderPublicKey:b}}const a=i+bo,u=e.slice(i,a),h=e.slice(a);return{type:r,sealed:h,iv:u}}function mb(o,e){const r=Ni(o);return Xl({type:Pn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?se(r.senderPublicKey,Dt):void 0,receiverPublicKey:e?.receiverPublicKey})}function Xl(o){const e=o?.type||Zl;if(e===dr){if(typeof o?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof o?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:o?.senderPublicKey,receiverPublicKey:o?.receiverPublicKey}}function Ku(o){return o.type===dr&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var wb=Object.defineProperty,Wu=Object.getOwnPropertySymbols,_b=Object.prototype.hasOwnProperty,bb=Object.prototype.propertyIsEnumerable,Fu=(o,e,r)=>e in o?wb(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Bu=(o,e)=>{for(var r in e||(e={}))_b.call(e,r)&&Fu(o,r,e[r]);if(Wu)for(var r of Wu(e))bb.call(e,r)&&Fu(o,r,e[r]);return o};const Eb="ReactNative",Gt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Ib="js";function zo(){return typeof X.process<"u"&&typeof X.process.versions<"u"&&typeof X.process.versions.node<"u"}function kr(){return!jo()&&!!Uo()&&navigator.product===Eb}function zr(){return!zo()&&!!Uo()&&!!jo()}function Sn(){return kr()?Gt.reactNative:zo()?Gt.node:zr()?Gt.browser:Gt.unknown}function Pb(){var o;try{return kr()&&typeof X.global<"u"&&typeof(X.global==null?void 0:X.global.Application)<"u"?(o=X.global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function Sb(o,e){let r=Oi.parse(o);return r=Bu(Bu({},r),e),o=Oi.stringify(r),o}function Ob(){return Jl()||{name:"",description:"",url:"",icons:[""]}}function Nb(){if(Sn()===Gt.reactNative&&typeof X.global<"u"&&typeof(X.global==null?void 0:X.global.Platform)<"u"){const{OS:r,Version:i}=X.global.Platform;return[r,i].join("-")}const o=W_();if(o===null)return"unknown";const e=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[e,o.name,o.version].join("-"):[e,o.version].join("-")}function Rb(){var o;const e=Sn();return e===Gt.browser?[e,((o=Gl())==null?void 0:o.host)||"unknown"].join(":"):e}function Cb(o,e,r){const i=Nb(),a=Rb();return[[o,e].join("-"),[Ib,r].join("-"),i,a].join("/")}function xb({protocol:o,version:e,relayUrl:r,sdkVersion:i,auth:a,projectId:u,useOnCloseEvent:h,bundleId:g}){const w=r.split("?"),b=Cb(o,e,i),S={auth:a,ua:b,projectId:u,useOnCloseEvent:h||void 0,origin:g||void 0},O=Sb(w[1]||"",S);return w[0]+"?"+O}function ur(o,e){return o.filter(r=>e.includes(r)).length===o.length}function th(o){return Object.fromEntries(o.entries())}function eh(o){return new Map(Object.entries(o))}function Ar(o=$.FIVE_MINUTES,e){const r=$.toMiliseconds(o||$.FIVE_MINUTES);let i,a,u;return{resolve:h=>{u&&i&&(clearTimeout(u),i(h))},reject:h=>{u&&a&&(clearTimeout(u),a(h))},done:()=>new Promise((h,g)=>{u=setTimeout(()=>{g(new Error(e))},r),i=h,a=g})}}function In(o,e,r){return new Promise(async(i,a)=>{const u=setTimeout(()=>a(new Error(r)),e);try{const h=await o;i(h)}catch(h){a(h)}clearTimeout(u)})}function rh(o,e){if(typeof e=="string"&&e.startsWith(`${o}:`))return e;if(o.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(o.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${o}`)}function Tb(o){return rh("topic",o)}function Ab(o){return rh("id",o)}function nh(o){const[e,r]=o.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function fe(o,e){return $.fromMiliseconds(Date.now()+$.toMiliseconds(o))}function Ge(o){return Date.now()>=$.toMiliseconds(o)}function vt(o,e){return`${o}${e?`:${e}`:""}`}function io(o=[],e=[]){return[...new Set([...o,...e])]}async function Db({id:o,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let a=i?.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${e}`,h=Sn();h===Gt.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):h===Gt.reactNative&&typeof(X.global==null?void 0:X.global.Linking)<"u"&&await X.global.Linking.openURL(u)}catch(i){console.error(i)}}async function qb(o,e){try{return await o.getItem(e)||(zr()?localStorage.getItem(e):void 0)}catch(r){console.error(r)}}const $b="irn";function Io(o){return o?.relay||{protocol:$b}}function Pi(o){const e=$w[o];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${o}`);return e}var jb=Object.defineProperty,Gu=Object.getOwnPropertySymbols,Ub=Object.prototype.hasOwnProperty,Mb=Object.prototype.propertyIsEnumerable,Ju=(o,e,r)=>e in o?jb(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Lb=(o,e)=>{for(var r in e||(e={}))Ub.call(e,r)&&Ju(o,r,e[r]);if(Gu)for(var r of Gu(e))Mb.call(e,r)&&Ju(o,r,e[r]);return o};function kb(o,e="-"){const r={},i="relay"+e;return Object.keys(o).forEach(a=>{if(a.startsWith(i)){const u=a.replace(i,""),h=o[a];r[u]=h}}),r}function Qu(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const e=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,i=o.substring(0,e),a=o.substring(e+1,r).split("@"),u=typeof r<"u"?o.substring(r):"",h=Oi.parse(u);return{protocol:i,topic:zb(a[0]),version:parseInt(a[1],10),symKey:h.symKey,relay:kb(h)}}function zb(o){return o.startsWith("//")?o.substring(2):o}function Vb(o,e="-"){const r="relay",i={};return Object.keys(o).forEach(a=>{const u=r+e+a;o[a]&&(i[u]=o[a])}),i}function Hb(o){return`${o.protocol}:${o.topic}@${o.version}?`+Oi.stringify(Lb({symKey:o.symKey},Vb(o.relay)))}function Vr(o){const e=[];return o.forEach(r=>{const[i,a]=r.split(":");e.push(`${i}:${a}`)}),e}function Kb(o){const e=[];return Object.values(o).forEach(r=>{e.push(...Vr(r.accounts))}),e}function Wb(o,e){const r=[];return Object.values(o).forEach(i=>{Vr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Fb(o,e){const r=[];return Object.values(o).forEach(i=>{Vr(i.accounts).includes(e)&&r.push(...i.events)}),r}function Bb(o,e){const r=Si(o,e);if(r)throw new Error(r.message);const i={};for(const[a,u]of Object.entries(o))i[a]={methods:u.methods,events:u.events,chains:u.accounts.map(h=>`${h.split(":")[0]}:${h.split(":")[1]}`)};return i}function Vo(o){return o.includes(":")}function wn(o){return Vo(o)?o.split(":")[0]:o}const Gb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Jb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function C(o,e){const{message:r,code:i}=Jb[o];return{message:e?`${r} ${e}`:r,code:i}}function gt(o,e){const{message:r,code:i}=Gb[o];return{message:e?`${r} ${e}`:r,code:i}}function lr(o,e){return!!Array.isArray(o)}function jr(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function kt(o){return typeof o>"u"}function bt(o,e){return e&&kt(o)?!0:typeof o=="string"&&!!o.trim().length}function Ho(o,e){return typeof o=="number"&&!isNaN(o)}function Qb(o,e){const{requiredNamespaces:r}=e,i=Object.keys(o.namespaces),a=Object.keys(r);let u=!0;return ur(a,i)?(i.forEach(h=>{const{accounts:g,methods:w,events:b}=o.namespaces[h],S=Vr(g),O=r[h];(!ur(Ql(h,O),S)||!ur(O.methods,w)||!ur(O.events,b))&&(u=!1)}),u):!1}function Ri(o){return bt(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Yb(o){if(bt(o,!1)&&o.includes(":")){const e=o.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Ri(r)}}return!1}function Zb(o){if(bt(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function Xb(o){var e;return(e=o?.proposer)==null?void 0:e.publicKey}function t0(o){return o?.topic}function e0(o,e){let r=null;return bt(o?.publicKey,!1)||(r=C("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Yu(o){let e=!0;return lr(o)?o.length&&(e=o.every(r=>bt(r,!1))):e=!1,e}function r0(o,e,r){let i=null;return lr(e)&&e.length?e.forEach(a=>{i||Ri(a)||(i=gt("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Ri(o)||(i=gt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function n0(o,e,r){let i=null;return Object.entries(o).forEach(([a,u])=>{if(i)return;const h=r0(a,Ql(a,u),`${e} ${r}`);h&&(i=h)}),i}function i0(o,e){let r=null;return lr(o)?o.forEach(i=>{r||Yb(i)||(r=gt("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=gt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function s0(o,e){let r=null;return Object.values(o).forEach(i=>{if(r)return;const a=i0(i?.accounts,`${e} namespace`);a&&(r=a)}),r}function o0(o,e){let r=null;return Yu(o?.methods)?Yu(o?.events)||(r=gt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=gt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ih(o,e){let r=null;return Object.values(o).forEach(i=>{if(r)return;const a=o0(i,`${e}, namespace`);a&&(r=a)}),r}function a0(o,e,r){let i=null;if(o&&jr(o)){const a=ih(o,e);a&&(i=a);const u=n0(o,e,r);u&&(i=u)}else i=C("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Si(o,e){let r=null;if(o&&jr(o)){const i=ih(o,e);i&&(r=i);const a=s0(o,e);a&&(r=a)}else r=C("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function sh(o){return bt(o.protocol,!0)}function c0(o,e){let r=!1;return o?o&&lr(o)&&o.length&&o.forEach(i=>{r=sh(i)}):r=!0,r}function u0(o){return typeof o=="number"}function Lt(o){return typeof o<"u"&&typeof o!==null}function l0(o){return!(!o||typeof o!="object"||!o.code||!Ho(o.code)||!o.message||!bt(o.message,!1))}function h0(o){return!(kt(o)||!bt(o.method,!1))}function p0(o){return!(kt(o)||kt(o.result)&&kt(o.error)||!Ho(o.id)||!bt(o.jsonrpc,!1))}function f0(o){return!(kt(o)||!bt(o.name,!1))}function Zu(o,e){return!(!Ri(e)||!Kb(o).includes(e))}function d0(o,e,r){return bt(r,!1)?Wb(o,e).includes(r):!1}function g0(o,e,r){return bt(r,!1)?Fb(o,e).includes(r):!1}function Xu(o,e,r){let i=null;const a=v0(o),u=y0(e),h=Object.keys(a),g=Object.keys(u),w=tl(Object.keys(o)),b=tl(Object.keys(e)),S=w.filter(O=>!b.includes(O));return S.length&&(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${S.toString()}
      Received: ${Object.keys(e).toString()}`)),ur(h,g)||(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${h.toString()}
      Approved: ${g.toString()}`)),Object.keys(e).forEach(O=>{if(!O.includes(":")||i)return;const R=Vr(e[O].accounts);R.includes(O)||(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${R.toString()}`))}),h.forEach(O=>{i||(ur(a[O].methods,u[O].methods)?ur(a[O].events,u[O].events)||(i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):i=C("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),i}function v0(o){const e={};return Object.keys(o).forEach(r=>{var i;r.includes(":")?e[r]=o[r]:(i=o[r].chains)==null||i.forEach(a=>{e[a]={methods:o[r].methods,events:o[r].events}})}),e}function tl(o){return[...new Set(o.map(e=>e.includes(":")?e.split(":")[0]:e))]}function y0(o){const e={};return Object.keys(o).forEach(r=>{if(r.includes(":"))e[r]=o[r];else{const i=Vr(o[r].accounts);i?.forEach(a=>{e[a]={accounts:o[r].accounts.filter(u=>u.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),e}function m0(o,e){return Ho(o)&&o<=e.max&&o>=e.min}function el(){const o=Sn();return new Promise(e=>{switch(o){case Gt.browser:e(w0());break;case Gt.reactNative:e(_0());break;case Gt.node:e(b0());break;default:e(!0)}})}function w0(){return zr()&&navigator?.onLine}async function _0(){if(kr()&&typeof X.global<"u"&&X.global!=null&&X.global.NetInfo){const o=await(X.global==null?void 0:X.global.NetInfo.fetch());return o?.isConnected}return!0}function b0(){return!0}function E0(o){switch(Sn()){case Gt.browser:I0(o);break;case Gt.reactNative:P0(o);break}}function I0(o){!kr()&&zr()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function P0(o){var e;kr()&&typeof X.global<"u"&&X.global!=null&&X.global.NetInfo&&((e=X.global)==null||e.NetInfo.addEventListener(r=>o(r?.isConnected)))}const so={};let _i=class{static get(o){return so[o]}static set(o,e){so[o]=e}static delete(o){delete so[o]}};class qe extends Nw{constructor(e){super(e),this.events=new be.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(qr(e.method,e.params||[],e.id||Kl().toString()),r)}async requestStrict(e,r){return new Promise(async(i,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${e.id}`,u=>{_e(u)?a(u.error):i(u.result)});try{await this.connection.send(e,r)}catch(u){a(u)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Di(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}function S0(o,e){return e=e||{},new Promise(function(r,i){var a=new XMLHttpRequest,u=[],h=[],g={},w=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:w,headers:{keys:function(){return u},entries:function(){return h},get:function(S){return g[S.toLowerCase()]},has:function(S){return S.toLowerCase()in g}}}};for(var b in a.open(e.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(S,O,R){u.push(O=O.toLowerCase()),h.push([O,R]),g[O]=g[O]?g[O]+","+R:R}),r(w())},a.onerror=i,a.withCredentials=e.credentials=="include",e.headers)a.setRequestHeader(b,e.headers[b]);a.send(e.body||null)})}const O0=Object.freeze(Object.defineProperty({__proto__:null,default:S0},Symbol.toStringTag,{value:"Module"})),rl=To(O0);var N0=self.fetch||(self.fetch=rl.default||rl);const R0=Sw(N0);function C0(o,e){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),h=u.charCodeAt(0);if(r[h]!==255)throw new TypeError(u+" is ambiguous");r[h]=a}var g=o.length,w=o.charAt(0),b=Math.log(g)/Math.log(256),S=Math.log(256)/Math.log(g);function O(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var A=0,F=0,Y=0,yt=D.length;Y!==yt&&D[Y]===0;)Y++,A++;for(var et=(yt-Y)*S+1>>>0,J=new Uint8Array(et);Y!==yt;){for(var at=D[Y],Rt=0,pt=et-1;(at!==0||Rt<F)&&pt!==-1;pt--,Rt++)at+=256*J[pt]>>>0,J[pt]=at%g>>>0,at=at/g>>>0;if(at!==0)throw new Error("Non-zero carry");F=Rt,Y++}for(var Ct=et-F;Ct!==et&&J[Ct]===0;)Ct++;for(var je=w.repeat(A);Ct<et;++Ct)je+=o.charAt(J[Ct]);return je}function R(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var A=0;if(D[A]!==" "){for(var F=0,Y=0;D[A]===w;)F++,A++;for(var yt=(D.length-A)*b+1>>>0,et=new Uint8Array(yt);D[A];){var J=r[D.charCodeAt(A)];if(J===255)return;for(var at=0,Rt=yt-1;(J!==0||at<Y)&&Rt!==-1;Rt--,at++)J+=g*et[Rt]>>>0,et[Rt]=J%256>>>0,J=J/256>>>0;if(J!==0)throw new Error("Non-zero carry");Y=at,A++}if(D[A]!==" "){for(var pt=yt-Y;pt!==yt&&et[pt]===0;)pt++;for(var Ct=new Uint8Array(F+(yt-pt)),je=F;pt!==yt;)Ct[je++]=et[pt++];return Ct}}}function U(D){var A=R(D);if(A)return A;throw new Error(`Non-${e} character`)}return{encode:O,decodeUnsafe:R,decode:U}}var x0=C0,T0=x0;const oh=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},A0=o=>new TextEncoder().encode(o),D0=o=>new TextDecoder().decode(o);class q0{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class $0{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ah(this,e)}}class j0{constructor(e){this.decoders=e}or(e){return ah(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ah=(o,e)=>new j0({...o.decoders||{[o.prefix]:o},...e.decoders||{[e.prefix]:e}});class U0{constructor(e,r,i,a){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=a,this.encoder=new q0(e,r,i),this.decoder=new $0(e,r,a)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const $i=({name:o,prefix:e,encode:r,decode:i})=>new U0(o,e,r,i),On=({prefix:o,name:e,alphabet:r})=>{const{encode:i,decode:a}=T0(r,e);return $i({prefix:o,name:e,encode:i,decode:u=>oh(a(u))})},M0=(o,e,r,i)=>{const a={};for(let S=0;S<e.length;++S)a[e[S]]=S;let u=o.length;for(;o[u-1]==="=";)--u;const h=new Uint8Array(u*r/8|0);let g=0,w=0,b=0;for(let S=0;S<u;++S){const O=a[o[S]];if(O===void 0)throw new SyntaxError(`Non-${i} character`);w=w<<r|O,g+=r,g>=8&&(g-=8,h[b++]=255&w>>g)}if(g>=r||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return h},L0=(o,e,r)=>{const i=e[e.length-1]==="=",a=(1<<r)-1;let u="",h=0,g=0;for(let w=0;w<o.length;++w)for(g=g<<8|o[w],h+=8;h>r;)h-=r,u+=e[a&g>>h];if(h&&(u+=e[a&g<<r-h]),i)for(;u.length*r&7;)u+="=";return u},Pt=({name:o,prefix:e,bitsPerChar:r,alphabet:i})=>$i({prefix:e,name:o,encode(a){return L0(a,i,r)},decode(a){return M0(a,i,r,o)}}),k0=$i({prefix:"\0",name:"identity",encode:o=>D0(o),decode:o=>A0(o)});var z0=Object.freeze({__proto__:null,identity:k0});const V0=Pt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var H0=Object.freeze({__proto__:null,base2:V0});const K0=Pt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var W0=Object.freeze({__proto__:null,base8:K0});const F0=On({prefix:"9",name:"base10",alphabet:"0123456789"});var B0=Object.freeze({__proto__:null,base10:F0});const G0=Pt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),J0=Pt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Q0=Object.freeze({__proto__:null,base16:G0,base16upper:J0});const Y0=Pt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Z0=Pt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),X0=Pt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),tE=Pt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eE=Pt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),rE=Pt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nE=Pt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),iE=Pt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),sE=Pt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var oE=Object.freeze({__proto__:null,base32:Y0,base32upper:Z0,base32pad:X0,base32padupper:tE,base32hex:eE,base32hexupper:rE,base32hexpad:nE,base32hexpadupper:iE,base32z:sE});const aE=On({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),cE=On({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var uE=Object.freeze({__proto__:null,base36:aE,base36upper:cE});const lE=On({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hE=On({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var pE=Object.freeze({__proto__:null,base58btc:lE,base58flickr:hE});const fE=Pt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dE=Pt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),gE=Pt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vE=Pt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var yE=Object.freeze({__proto__:null,base64:fE,base64pad:dE,base64url:gE,base64urlpad:vE});const ch=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),mE=ch.reduce((o,e,r)=>(o[r]=e,o),[]),wE=ch.reduce((o,e,r)=>(o[e.codePointAt(0)]=r,o),[]);function _E(o){return o.reduce((e,r)=>(e+=mE[r],e),"")}function bE(o){const e=[];for(const r of o){const i=wE[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const EE=$i({prefix:"🚀",name:"base256emoji",encode:_E,decode:bE});var IE=Object.freeze({__proto__:null,base256emoji:EE}),PE=uh,nl=128,SE=127,OE=~SE,NE=Math.pow(2,31);function uh(o,e,r){e=e||[],r=r||0;for(var i=r;o>=NE;)e[r++]=o&255|nl,o/=128;for(;o&OE;)e[r++]=o&255|nl,o>>>=7;return e[r]=o|0,uh.bytes=r-i+1,e}var RE=Po,CE=128,il=127;function Po(o,i){var r=0,i=i||0,a=0,u=i,h,g=o.length;do{if(u>=g)throw Po.bytes=0,new RangeError("Could not decode varint");h=o[u++],r+=a<28?(h&il)<<a:(h&il)*Math.pow(2,a),a+=7}while(h>=CE);return Po.bytes=u-i,r}var xE=Math.pow(2,7),TE=Math.pow(2,14),AE=Math.pow(2,21),DE=Math.pow(2,28),qE=Math.pow(2,35),$E=Math.pow(2,42),jE=Math.pow(2,49),UE=Math.pow(2,56),ME=Math.pow(2,63),LE=function(o){return o<xE?1:o<TE?2:o<AE?3:o<DE?4:o<qE?5:o<$E?6:o<jE?7:o<UE?8:o<ME?9:10},kE={encode:PE,decode:RE,encodingLength:LE},lh=kE;const sl=(o,e,r=0)=>(lh.encode(o,e,r),e),ol=o=>lh.encodingLength(o),So=(o,e)=>{const r=e.byteLength,i=ol(o),a=i+ol(r),u=new Uint8Array(a+r);return sl(o,u,0),sl(r,u,i),u.set(e,a),new zE(o,r,e,u)};class zE{constructor(e,r,i,a){this.code=e,this.size=r,this.digest=i,this.bytes=a}}const hh=({name:o,code:e,encode:r})=>new VE(o,e,r);class VE{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?So(this.code,r):r.then(i=>So(this.code,i))}else throw Error("Unknown type, must be binary type")}}const ph=o=>async e=>new Uint8Array(await crypto.subtle.digest(o,e)),HE=hh({name:"sha2-256",code:18,encode:ph("SHA-256")}),KE=hh({name:"sha2-512",code:19,encode:ph("SHA-512")});var WE=Object.freeze({__proto__:null,sha256:HE,sha512:KE});const fh=0,FE="identity",dh=oh,BE=o=>So(fh,dh(o)),GE={code:fh,name:FE,encode:dh,digest:BE};var JE=Object.freeze({__proto__:null,identity:GE});new TextEncoder,new TextDecoder;const al={...z0,...H0,...W0,...B0,...Q0,...oE,...uE,...pE,...yE,...IE};({...WE,...JE});function gh(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function QE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?gh(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function vh(o,e,r,i){return{name:o,prefix:e,encoder:{name:o,prefix:e,encode:r},decoder:{decode:i}}}const cl=vh("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),oo=vh("ascii","a",o=>{let e="a";for(let r=0;r<o.length;r++)e+=String.fromCharCode(o[r]);return e},o=>{o=o.substring(1);const e=QE(o.length);for(let r=0;r<o.length;r++)e[r]=o.charCodeAt(r);return e}),YE={utf8:cl,"utf-8":cl,hex:al.base16,latin1:oo,ascii:oo,binary:oo,...al};function ZE(o,e="utf8"){const r=YE[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?gh(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const yh="wc",XE=2,Ko="core",Je=`${yh}@2:${Ko}:`,tI={name:Ko,logger:"error"},eI={database:":memory:"},rI="crypto",ul="client_ed25519_seed",nI=$.ONE_DAY,iI="keychain",sI="0.3",oI="messages",aI="0.3",cI=$.SIX_HOURS,uI="publisher",mh="irn",lI="error",wh="wss://relay.walletconnect.com",ll="wss://relay.walletconnect.org",hI="relayer",Nt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},pI="_subscription",Ae={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},fI=$.ONE_SECOND,dI="2.11.0",gI=1e4,vI="0.3",yI="WALLETCONNECT_CLIENT_ID",pe={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},mI="subscription",wI="0.3",_I=$.FIVE_SECONDS*1e3,bI="pairing",EI="0.3",dn={wc_pairingDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:$.ONE_DAY,prompt:!1,tag:0},res:{ttl:$.ONE_DAY,prompt:!1,tag:0}}},_n={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},we={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},II="history",PI="0.3",SI="expirer",ie={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},OI="0.3",ao="verify-api",Dr="https://verify.walletconnect.com",Oo="https://verify.walletconnect.org",NI=[Dr,Oo],RI="echo",CI="https://echo.walletconnect.com";class xI{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=iI,this.version=sI,this.initialized=!1,this.storagePrefix=Je,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,a)=>{this.isInitialized(),this.keychain.set(i,a),await this.persist()},this.get=i=>{this.isInitialized();const a=this.keychain.get(i);if(typeof a>"u"){const{message:u}=C("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(u)}return a},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=zt(r,this.name)}get context(){return Jt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,th(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?eh(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class TI{constructor(e,r,i){this.core=e,this.logger=r,this.name=rI,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=Cu(a);return Aw(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=hb();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),h=Cu(u),g=Eo();return await Dw(g,a,nI,h)},this.generateSharedKey=(a,u,h)=>{this.isInitialized();const g=this.getPrivateKey(a),w=pb(g,u);return this.setSymKey(w,h)},this.setSymKey=async(a,u)=>{this.isInitialized();const h=u||fb(a);return await this.keychain.set(h,a),h},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,h)=>{this.isInitialized();const g=Xl(h),w=j_(u);if(Ku(g)){const R=g.senderPublicKey,U=g.receiverPublicKey;a=await this.generateSharedKey(R,U)}const b=this.getSymKey(a),{type:S,senderPublicKey:O}=g;return gb({type:S,symKey:b,message:w,senderPublicKey:O})},this.decode=async(a,u,h)=>{this.isInitialized();const g=mb(u,h);if(Ku(g)){const w=g.receiverPublicKey,b=g.senderPublicKey;a=await this.generateSharedKey(w,b)}try{const w=this.getSymKey(a),b=vb({symKey:w,encoded:u});return $_(b)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const u=Ni(a);return Pn(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Ni(a);return u.senderPublicKey?se(u.senderPublicKey,Dt):void 0},this.core=e,this.logger=zt(r,this.name),this.keychain=i||new xI(this.core,this.logger)}get context(){return Jt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ul)}catch{e=Eo(),await this.keychain.set(ul,e)}return ZE(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class AI extends I_{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=oI,this.version=aI,this.initialized=!1,this.storagePrefix=Je,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,a)=>{this.isInitialized();const u=$r(a);let h=this.messages.get(i);return typeof h>"u"&&(h={}),typeof h[u]<"u"||(h[u]=a,this.messages.set(i,h),await this.persist()),u},this.get=i=>{this.isInitialized();let a=this.messages.get(i);return typeof a>"u"&&(a={}),a},this.has=(i,a)=>{this.isInitialized();const u=this.get(i),h=$r(a);return typeof u[h]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=zt(e,this.name),this.core=r}get context(){return Jt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,th(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?eh(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class DI extends P_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new be.EventEmitter,this.name=uI,this.queue=new Map,this.publishTimeout=$.toMiliseconds($.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,a,u)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:a,opts:u}});try{const g=u?.ttl||cI,w=Io(u),b=u?.prompt||!1,S=u?.tag||0,O=u?.id||Kl().toString(),R={topic:i,message:a,opts:{ttl:g,relay:w,prompt:b,tag:S,id:O}},U=setTimeout(()=>this.queue.set(O,R),this.publishTimeout);try{await await In(this.rpcPublish(i,a,g,w,b,S,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Nt.publish,R)}catch(D){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=u?.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(O),D;return}finally{clearTimeout(U)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:a,opts:u}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.relayer=e,this.logger=zt(r,this.name),this.registerEventListeners()}get context(){return Jt(this.logger)}rpcPublish(e,r,i,a,u,h,g){var w,b,S,O;const R={method:Pi(a.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:u,tag:h},id:g};return kt((w=R.params)==null?void 0:w.prompt)&&((b=R.params)==null||delete b.prompt),kt((S=R.params)==null?void 0:S.tag)&&((O=R.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:a}=e;await this.publish(r,i,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Nt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Nt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class qI{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const a=i.filter(u=>u!==r);if(!a.length){this.map.delete(e);return}this.map.set(e,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var $I=Object.defineProperty,jI=Object.defineProperties,UI=Object.getOwnPropertyDescriptors,hl=Object.getOwnPropertySymbols,MI=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,pl=(o,e,r)=>e in o?$I(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,gn=(o,e)=>{for(var r in e||(e={}))MI.call(e,r)&&pl(o,r,e[r]);if(hl)for(var r of hl(e))LI.call(e,r)&&pl(o,r,e[r]);return o},co=(o,e)=>jI(o,UI(e));class kI extends N_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new qI,this.events=new be.EventEmitter,this.name=mI,this.version=wI,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Je,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:a}});try{const u=Io(a),h={topic:i,relay:u};this.pending.set(i,h);const g=await this.rpcSubscribe(i,u);return this.onSubscribe(g,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:a}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(i,a)=>{await this.restartToComplete(),this.isInitialized(),typeof a?.id<"u"?await this.unsubscribeById(i,a.id,a):await this.unsubscribeByTopic(i,a)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((a,u)=>{const h=new $.Watch;h.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(g),h.stop(this.pendingSubscriptionWatchLabel),a(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=_I&&(clearInterval(g),h.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=zt(r,this.name),this.clientId=""}get context(){return Jt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async a=>await this.unsubscribeById(e,a,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const a=Io(i);await this.rpcUnsubscribe(e,r,a);const u=gt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(e,r){const i={method:Pi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await In(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Nt.connection_stalled)}return $r(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:Pi(r.protocol).batchSubscribe,params:{topics:e.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await In(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Nt.connection_stalled)}}rpcUnsubscribe(e,r,i){const a={method:Pi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(e,r){this.setSubscription(e,co(gn({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,gn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,gn({},r)),this.topicMap.set(r.topic,e),this.events.emit(pe.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(pe.deleted,co(gn({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(pe.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(pe.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);lr(r)&&this.onBatchSubscribe(r.map((i,a)=>co(gn({},e[a]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Nt.connect,async()=>{await this.onConnect()}),this.relayer.on(Nt.disconnect,()=>{this.onDisconnect()}),this.events.on(pe.created,async e=>{const r=pe.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(pe.deleted,async e=>{const r=pe.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var zI=Object.defineProperty,fl=Object.getOwnPropertySymbols,VI=Object.prototype.hasOwnProperty,HI=Object.prototype.propertyIsEnumerable,dl=(o,e,r)=>e in o?zI(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,KI=(o,e)=>{for(var r in e||(e={}))VI.call(e,r)&&dl(o,r,e[r]);if(fl)for(var r of fl(e))HI.call(e,r)&&dl(o,r,e[r]);return o};class WI extends S_{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new be.EventEmitter,this.name=hI,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Nt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Nt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Ae.payload,this.onPayloadHandler),this.provider.on(Ae.connect,this.onConnectHandler),this.provider.on(Ae.disconnect,this.onDisconnectHandler),this.provider.on(Ae.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?zt(e.logger,this.name):xi(Ti({level:e.logger||lI})),this.messages=new AI(this.logger,e.core),this.subscriber=new kI(this,this.logger),this.publisher=new DI(this,this.logger),this.relayUrl=e?.relayUrl||wh,this.projectId=e.projectId,this.bundleId=Pb(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ll}...`),await this.restartTransport(ll)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},gI)}get context(){return Jt(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";if(a)return a;let u;const h=g=>{g.topic===e&&(this.subscriber.off(pe.created,h),u())};return await Promise.all([new Promise(g=>{u=g,this.subscriber.on(pe.created,h)}),new Promise(async g=>{a=await this.subscriber.subscribe(e,r),g()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await In(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(pe.resubscribed,()=>{r()})}),new Promise(async(r,i)=>{try{await In(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){i(a);return}r()})])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.provider.events.emit(Ae.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await el())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new qe(new qw(xb({sdkVersion:dI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,i);return a&&this.logger.debug(`Ignoring duplicate message: ${i}`),a}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),qo(e)){if(!e.method.endsWith(pI))return;const r=e.params,{topic:i,message:a,publishedAt:u}=r.data,h={topic:i,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(KI({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(e),await this.onMessageEvent(h)}else Di(e)&&this.events.emit(Nt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Nt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Ai(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Ae.payload,this.onPayloadHandler),this.provider.off(Ae.connect,this.onConnectHandler),this.provider.off(Ae.disconnect,this.onDisconnectHandler),this.provider.off(Ae.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Nt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await el();E0(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(Nt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},$.toMiliseconds(fI)))}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var FI=Object.defineProperty,gl=Object.getOwnPropertySymbols,BI=Object.prototype.hasOwnProperty,GI=Object.prototype.propertyIsEnumerable,vl=(o,e,r)=>e in o?FI(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,yl=(o,e)=>{for(var r in e||(e={}))BI.call(e,r)&&vl(o,r,e[r]);if(gl)for(var r of gl(e))GI.call(e,r)&&vl(o,r,e[r]);return o};class ji extends O_{constructor(e,r,i,a=Je,u=void 0){super(e,r,i,a),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=vI,this.cached=[],this.initialized=!1,this.storagePrefix=Je,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!kt(h)?this.map.set(this.getKey(h),h):Xb(h)?this.map.set(h.id,h):t0(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,g)=>{this.isInitialized(),this.map.has(h)?await this.update(h,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:g}),this.map.set(h,g),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(g=>Object.keys(h).every(w=>Cw(g[w],h[w]))):this.values),this.update=async(h,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:g});const w=yl(yl({},this.getData(h)),g);this.map.set(h,w),await this.persist()},this.delete=async(h,g)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:g}),this.map.delete(h),await this.persist())},this.logger=zt(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return Jt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class JI{constructor(e,r){this.core=e,this.logger=r,this.name=bI,this.version=EI,this.events=new xo,this.initialized=!1,this.storagePrefix=Je,this.ignoredPayloadTypes=[dr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Eo(),a=await this.core.crypto.setSymKey(i),u=fe($.FIVE_MINUTES),h={protocol:mh},g={topic:a,expiry:u,relay:h,active:!1},w=Hb({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:i,relay:h});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:w}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:a,symKey:u,relay:h}=Qu(i.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=fe($.FIVE_MINUTES),b={topic:a,relay:h,expiry:w,active:!1};return await this.pairings.set(a,b),this.core.expirer.set(a,w),i.activatePairing&&await this.activate({topic:a}),this.events.emit(_n.create,b),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:h})),b},this.activate=async({topic:i})=>{this.isInitialized();const a=fe($.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:a}),this.core.expirer.set(i,a)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:a}=i;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:h,resolve:g,reject:w}=Ar();this.events.once(vt("pairing_ping",u),({error:b})=>{b?w(b):g()}),await h()}},this.updateExpiry=async({topic:i,expiry:a})=>{this.isInitialized(),await this.pairings.update(i,{expiry:a})},this.updateMetadata=async({topic:i,metadata:a})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:a}=i;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",gt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(i,a,u)=>{const h=qr(a,u),g=await this.core.crypto.encode(i,h),w=dn[a].req;return this.core.history.set(i,h),this.core.relayer.publish(i,g,w),h.id},this.sendResult=async(i,a,u)=>{const h=Ai(i,u),g=await this.core.crypto.encode(a,h),w=await this.core.history.get(a,i),b=dn[w.request.method].res;await this.core.relayer.publish(a,g,b),await this.core.history.resolve(h)},this.sendError=async(i,a,u)=>{const h=Do(i,u),g=await this.core.crypto.encode(a,h),w=await this.core.history.get(a,i),b=dn[w.request.method]?dn[w.request.method].res:dn.unregistered_method.res;await this.core.relayer.publish(a,g,b),await this.core.history.resolve(h)},this.deletePairing=async(i,a)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,gt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),a?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(a=>Ge(a.expiry));await Promise.all(i.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=i=>{const{topic:a,payload:u}=i;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async i=>{const{topic:a,payload:u}=i,h=(await this.core.history.get(a,u.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(i,a)=>{const{id:u}=a;try{this.isValidPing({topic:i}),await this.sendResult(u,i,!0),this.events.emit(_n.ping,{id:u,topic:i})}catch(h){await this.sendError(u,i,h),this.logger.error(h)}},this.onPairingPingResponse=(i,a)=>{const{id:u}=a;setTimeout(()=>{Be(a)?this.events.emit(vt("pairing_ping",u),{}):_e(a)&&this.events.emit(vt("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(i,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(_n.delete,{id:u,topic:i})}catch(h){await this.sendError(u,i,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(i,a)=>{const{id:u,method:h}=a;try{if(this.registeredMethods.includes(h))return;const g=gt("WC_METHOD_UNSUPPORTED",h);await this.sendError(u,i,g),this.logger.error(g)}catch(g){await this.sendError(u,i,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(gt("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{var a;if(!Lt(i)){const{message:h}=C("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(h)}if(!Zb(i.uri)){const{message:h}=C("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(h)}const u=Qu(i.uri);if(!((a=u?.relay)!=null&&a.protocol)){const{message:h}=C("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(u!=null&&u.symKey)){const{message:h}=C("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async i=>{if(!Lt(i)){const{message:u}=C("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(u)}const{topic:a}=i;await this.isValidPairingTopic(a)},this.isValidDisconnect=async i=>{if(!Lt(i)){const{message:u}=C("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(u)}const{topic:a}=i;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async i=>{if(!bt(i,!1)){const{message:a}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(a)}if(!this.pairings.keys.includes(i)){const{message:a}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(a)}if(Ge(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:a}=C("EXPIRED",`pairing topic: ${i}`);throw new Error(a)}},this.core=e,this.logger=zt(r,this.name),this.pairings=new ji(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Jt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Nt.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const a=await this.core.crypto.decode(r,i);try{qo(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Di(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(ie.expired,async e=>{const{topic:r}=nh(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(_n.expire,{topic:r}))})}}class QI extends E_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new be.EventEmitter,this.name=II,this.version=PI,this.cached=[],this.initialized=!1,this.storagePrefix=Je,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:a,chainId:u}),this.records.has(a.id))return;const h={id:a.id,topic:i,request:{method:a.method,params:a.params||null},chainId:u,expiry:fe($.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(we.created,h)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const a=await this.getRecord(i.id);typeof a.response>"u"&&(a.response=_e(i)?{error:i.error}:{result:i.result},this.records.set(a.id,a),this.events.emit(we.updated,a))},this.get=async(i,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:a}),await this.getRecord(a)),this.delete=(i,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===i){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(we.deleted,u)}})},this.exists=async(i,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===i:!1),this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.logger=zt(r,this.name)}get context(){return Jt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:qr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(we.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(we.created,e=>{const r=we.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(we.updated,e=>{const r=we.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(we.deleted,e=>{const r=we.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{$.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class YI extends R_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new be.EventEmitter,this.name=SI,this.version=OI,this.cached=[],this.initialized=!1,this.storagePrefix=Je,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const a=this.formatTarget(i);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(i,a)=>{this.isInitialized();const u=this.formatTarget(i),h={target:u,expiry:a};this.expirations.set(u,h),this.checkExpiry(u,h),this.events.emit(ie.created,{target:u,expiration:h})},this.get=i=>{this.isInitialized();const a=this.formatTarget(i);return this.getExpiration(a)},this.del=i=>{if(this.isInitialized(),this.has(i)){const a=this.formatTarget(i),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(ie.deleted,{target:a,expiration:u})}},this.on=(i,a)=>{this.events.on(i,a)},this.once=(i,a)=>{this.events.once(i,a)},this.off=(i,a)=>{this.events.off(i,a)},this.removeListener=(i,a)=>{this.events.removeListener(i,a)},this.logger=zt(r,this.name)}get context(){return Jt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Tb(e);if(typeof e=="number")return Ab(e);const{message:r}=C("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ie.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;$.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ie.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Mr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ie.created,e=>{const r=ie.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ie.expired,e=>{const r=ie.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ie.deleted,e=>{const r=ie.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ZI extends C_{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=ao,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||kr()||!zr())return;const a=this.getVerifyUrl(i?.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Oo;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(i?.verifyUrl);let u;try{u=await this.fetchAttestation(i.attestationId,a)}catch(h){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${a}`),this.logger.info(h),u=await this.fetchAttestation(i.attestationId,Oo)}return u},this.fetchAttestation=async(i,a)=>{this.logger.info(`resolving attestation: ${i} from url: ${a}`);const u=this.startAbortTimer($.ONE_SECOND*2),h=await fetch(`${a}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(u),h.status===200?await h.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),i())};await Promise.race([new Promise(u=>{if(document.getElementById(ao))return u();window.addEventListener("message",a);const h=document.createElement("iframe");h.id=ao,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,i=u}),new Promise((u,h)=>setTimeout(()=>{window.removeEventListener("message",a),h("verify iframe load timeout")},$.toMiliseconds($.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=i=>{let a=i||Dr;return NI.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Dr}`),a=Dr),a},this.logger=zt(r,this.name),this.verifyUrl=Dr,this.abortController=new AbortController,this.isDevEnv=zo()&&X.process.env.IS_VITEST}get context(){return Jt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),$.toMiliseconds(e))}}class XI extends x_{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=RI,this.registerDeviceToken=async i=>{const{clientId:a,token:u,notificationType:h,enableEncrypted:g=!1}=i,w=`${CI}/${this.projectId}/clients`;await R0(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:h,token:u,always_raw:g})})},this.logger=zt(r,this.context)}}var tP=Object.defineProperty,ml=Object.getOwnPropertySymbols,eP=Object.prototype.hasOwnProperty,rP=Object.prototype.propertyIsEnumerable,wl=(o,e,r)=>e in o?tP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,_l=(o,e)=>{for(var r in e||(e={}))eP.call(e,r)&&wl(o,r,e[r]);if(ml)for(var r of ml(e))rP.call(e,r)&&wl(o,r,e[r]);return o};class Wo extends b_{constructor(e){super(e),this.protocol=yh,this.version=XE,this.name=Ko,this.events=new be.EventEmitter,this.initialized=!1,this.on=(i,a)=>this.events.on(i,a),this.once=(i,a)=>this.events.once(i,a),this.off=(i,a)=>this.events.off(i,a),this.removeListener=(i,a)=>this.events.removeListener(i,a),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||wh,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:xi(Ti({level:e?.logger||tI.logger}));this.logger=zt(r,this.name),this.heartbeat=new Mr.HeartBeat,this.crypto=new TI(this,this.logger,e?.keychain),this.history=new QI(this,this.logger),this.expirer=new YI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new xw(_l(_l({},eI),e?.storageOptions)),this.relayer=new WI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new JI(this,this.logger),this.verify=new ZI(this.projectId||"",this.logger),this.echoClient=new XI(this.projectId||"",this.logger)}static async init(e){const r=new Wo(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(yI,i),r}get context(){return Jt(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const nP=Wo,_h="wc",bh=2,Eh="client",Fo=`${_h}@${bh}:${Eh}:`,uo={name:Eh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},bl="WALLETCONNECT_DEEPLINK_CHOICE",iP="proposal",Ih="Proposal expired",sP="session",bi=$.SEVEN_DAYS,oP="engine",vn={wc_sessionPropose:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1115}}},lo={min:$.FIVE_MINUTES,max:$.SEVEN_DAYS},De={idle:"IDLE",active:"ACTIVE"},aP="request",cP=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var uP=Object.defineProperty,lP=Object.defineProperties,hP=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,pP=Object.prototype.hasOwnProperty,fP=Object.prototype.propertyIsEnumerable,Il=(o,e,r)=>e in o?uP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Mt=(o,e)=>{for(var r in e||(e={}))pP.call(e,r)&&Il(o,r,e[r]);if(El)for(var r of El(e))fP.call(e,r)&&Il(o,r,e[r]);return o},yn=(o,e)=>lP(o,hP(e));class dP extends A_{constructor(e){super(e),this.name=oP,this.events=new xo,this.initialized=!1,this.ignoredPayloadTypes=[dr],this.requestQueue={state:De.idle,queue:[]},this.sessionRequestQueue={state:De.idle,queue:[]},this.requestQueueDelay=$.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(vn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},$.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const i=yn(Mt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:h,sessionProperties:g,relays:w}=i;let b=a,S,O=!1;if(b&&(O=this.client.core.pairing.pairings.get(b).active),!b||!O){const{topic:et,uri:J}=await this.client.core.pairing.create();b=et,S=J}const R=await this.client.core.crypto.generateKeyPair(),U=Mt({requiredNamespaces:u,optionalNamespaces:h,relays:w??[{protocol:mh}],proposer:{publicKey:R,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:D,resolve:A,done:F}=Ar($.FIVE_MINUTES,Ih);if(this.events.once(vt("session_connect"),async({error:et,session:J})=>{if(et)D(et);else if(J){J.self.publicKey=R;const at=yn(Mt({},J),{requiredNamespaces:J.requiredNamespaces,optionalNamespaces:J.optionalNamespaces});await this.client.session.set(J.topic,at),await this.setExpiry(J.topic,J.expiry),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:J.peer.metadata}),A(at)}}),!b){const{message:et}=C("NO_MATCHING_KEY",`connect() pairing topic: ${b}`);throw new Error(et)}const Y=await this.sendRequest({topic:b,method:"wc_sessionPropose",params:U}),yt=fe($.FIVE_MINUTES);return await this.setProposal(Y,Mt({id:Y,expiry:yt},U)),{uri:S,approval:F}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:a,namespaces:u,sessionProperties:h}=r,g=this.client.proposal.get(i);let{pairingTopic:w,proposer:b,requiredNamespaces:S,optionalNamespaces:O}=g;w=w||"",jr(S)||(S=Bb(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),U=b.publicKey,D=await this.client.core.crypto.generateSharedKey(R,U);w&&i&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:b.metadata}),await this.sendResult({id:i,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(i,gt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const A=Mt({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:S,optionalNamespaces:O,pairingTopic:w,controller:{publicKey:R,metadata:this.client.metadata},expiry:fe(bi)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(D),await this.sendRequest({topic:D,method:"wc_sessionSettle",params:A,throwOnFailedPublish:!0});const F=yn(Mt({},A),{topic:D,pairingTopic:w,acknowledged:!1,self:A.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:R});return await this.client.session.set(D,F),await this.setExpiry(D,fe(bi)),{topic:D,acknowledged:()=>new Promise(Y=>setTimeout(()=>Y(this.client.session.get(D)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:i,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(i);u&&(await this.sendError(i,u,a),await this.client.proposal.delete(i,gt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:a}=r,u=await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:h,resolve:g,reject:w}=Ar();return this.events.once(vt("session_update",u),({error:b})=>{b?w(b):g()}),await this.client.session.update(i,{namespaces:a}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,a=await this.sendRequest({topic:i,method:"wc_sessionExtend",params:{}}),{done:u,resolve:h,reject:g}=Ar();return this.events.once(vt("session_extend",a),({error:w})=>{w?g(w):h()}),await this.setExpiry(i,fe(bi)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:a,topic:u,expiry:h}=r,g=Tw(),{done:w,resolve:b,reject:S}=Ar(h,"Request expired. Please try again.");return this.events.once(vt("session_request",g),({error:O,result:R})=>{O?S(O):b(R)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:g,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:i},expiry:h,throwOnFailedPublish:!0}).catch(R=>S(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:i,id:g}),O()}),new Promise(async O=>{const R=await qb(this.client.core.storage,bl);Db({id:g,topic:u,wcDeepLink:R}),O()}),w()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:a}=r,{id:u}=a;Be(a)?await this.sendResult({id:u,topic:i,result:a.result,throwOnFailedPublish:!0}):_e(a)&&await this.sendError(u,i,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const a=await this.sendRequest({topic:i,method:"wc_sessionPing",params:{}}),{done:u,resolve:h,reject:g}=Ar();this.events.once(vt("session_ping",a),({error:w})=>{w?g(w):h()}),await u()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:a,chainId:u}=r;await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest({topic:i,method:"wc_sessionDelete",params:gt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Qb(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var h,g;return((h=u.peerMetadata)==null?void 0:h.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==i.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,gt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(bl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,gt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,gt("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=De.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=vn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:h,verifyContext:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:h,verifyContext:g}),i&&this.client.core.expirer.set(a,fe(i))},this.sendRequest=async r=>{const{topic:i,method:a,params:u,expiry:h,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:b}=r,S=qr(a,u,w);if(zr()&&cP.includes(a)){const U=$r(JSON.stringify(S));this.client.core.verify.register({attestationId:U})}const O=await this.client.core.crypto.encode(i,S),R=vn[a].req;return h&&(R.ttl=h),g&&(R.id=g),this.client.core.history.set(i,S),b?(R.internal=yn(Mt({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,O,R)):this.client.core.relayer.publish(i,O,R).catch(U=>this.client.logger.error(U)),S.id},this.sendResult=async r=>{const{id:i,topic:a,result:u,throwOnFailedPublish:h}=r,g=Ai(i,u),w=await this.client.core.crypto.encode(a,g),b=await this.client.core.history.get(a,i),S=vn[b.request.method].res;h?(S.internal=yn(Mt({},S.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,S)):this.client.core.relayer.publish(a,w,S).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(g)},this.sendError=async(r,i,a)=>{const u=Do(r,a),h=await this.client.core.crypto.encode(i,u),g=await this.client.core.history.get(i,r),w=vn[g.request.method].res;this.client.core.relayer.publish(i,h,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(a=>{Ge(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Ge(a.expiry)&&i.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...i.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===De.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=De.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=De.idle},this.processRequest=r=>{const{topic:i,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(i,a);case"wc_sessionSettle":return this.onSessionSettleRequest(i,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,a);case"wc_sessionExtend":return this.onSessionExtendRequest(i,a);case"wc_sessionPing":return this.onSessionPingRequest(i,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,a);case"wc_sessionRequest":return this.onSessionRequest(i,a);case"wc_sessionEvent":return this.onSessionEventRequest(i,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:a}=r,u=(await this.client.core.history.get(i,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(i,a);case"wc_sessionSettle":return this.onSessionSettleResponse(i,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,a);case"wc_sessionExtend":return this.onSessionExtendResponse(i,a);case"wc_sessionPing":return this.onSessionPingResponse(i,a);case"wc_sessionRequest":return this.onSessionRequestResponse(i,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:a}=C("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,i)=>{const{params:a,id:u}=i;try{this.isValidConnect(Mt({},i.params));const h=fe($.FIVE_MINUTES),g=Mt({id:u,pairingTopic:r,expiry:h},a);await this.setProposal(u,g);const w=$r(JSON.stringify(i)),b=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:b})}catch(h){await this.sendError(u,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,i)=>{const{id:a}=i;if(Be(i)){const{result:u}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const h=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const g=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const b=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:b});const S=await this.client.core.relayer.subscribe(b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:S}),await this.client.core.pairing.activate({topic:r})}else _e(i)&&(await this.client.proposal.delete(a,gt("USER_DISCONNECTED")),this.events.emit(vt("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:a,params:u}=i;try{this.isValidSessionSettleRequest(u);const{relay:h,controller:g,expiry:w,namespaces:b,requiredNamespaces:S,optionalNamespaces:O,sessionProperties:R,pairingTopic:U}=i.params,D=Mt({topic:r,relay:h,expiry:w,namespaces:b,acknowledged:!0,pairingTopic:U,requiredNamespaces:S,optionalNamespaces:O,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},R&&{sessionProperties:R});await this.sendResult({id:i.id,topic:r,result:!0}),this.events.emit(vt("session_connect"),{session:D}),this.cleanupDuplicatePairings(D)}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,i)=>{const{id:a}=i;Be(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(vt("session_approve",a),{})):_e(i)&&(await this.client.session.delete(r,gt("USER_DISCONNECTED")),this.events.emit(vt("session_approve",a),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:a,id:u}=i;try{const h=`${r}_session_update`,g=_i.get(h);if(g&&this.isRequestOutOfSync(g,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(Mt({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),_i.set(h,u)}catch(h){await this.sendError(u,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,i)=>{const{id:a}=i;Be(i)?this.events.emit(vt("session_update",a),{}):_e(i)&&this.events.emit(vt("session_update",a),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:a}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,fe(bi)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,i)=>{const{id:a}=i;Be(i)?this.events.emit(vt("session_extend",a),{}):_e(i)&&this.events.emit(vt("session_extend",a),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:a}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,i)=>{const{id:a}=i;setTimeout(()=>{Be(i)?this.events.emit(vt("session_ping",a),{}):_e(i)&&this.events.emit(vt("session_ping",a),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:a}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Nt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,i)=>{const{id:a,params:u}=i;try{this.isValidRequest(Mt({topic:r},u));const h=$r(JSON.stringify(qr("wc_sessionRequest",u,a))),g=this.client.session.get(r),w=await this.getVerifyContext(h,g.peer.metadata),b={id:a,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(b),this.addSessionRequestToSessionRequestQueue(b),this.processSessionRequestQueue()}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,i)=>{const{id:a}=i;Be(i)?this.events.emit(vt("session_request",a),{result:i.result}):_e(i)&&this.events.emit(vt("session_request",a),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:a,params:u}=i;try{const h=`${r}_session_event_${u.event.name}`,g=_i.get(h);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Mt({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),_i.set(h,a)}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=De.idle,this.processSessionRequestQueue()},$.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===De.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=De.active,this.client.events.emit("session_request",r)}catch(i){this.client.logger.error(i)}},this.onPairingCreated=r=>{if(r.active)return;const i=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);i&&this.onSessionProposeRequest(r.topic,qr("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id))},this.isValidConnect=async r=>{if(!Lt(r)){const{message:w}=C("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:i,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:h,relays:g}=r;if(kt(i)||await this.isValidPairingTopic(i),!c0(g)){const{message:w}=C("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!kt(a)&&jr(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!kt(u)&&jr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),kt(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,i)=>{const a=a0(r,"connect()",i);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Lt(r))throw new Error(C("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:a,relayProtocol:u,sessionProperties:h}=r;await this.isValidProposalId(i);const g=this.client.proposal.get(i),w=Si(a,"approve()");if(w)throw new Error(w.message);const b=Xu(g.requiredNamespaces,a,"approve()");if(b)throw new Error(b.message);if(!bt(u,!0)){const{message:S}=C("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(S)}kt(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!Lt(r)){const{message:u}=C("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:i,reason:a}=r;if(await this.isValidProposalId(i),!l0(a)){const{message:u}=C("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!Lt(r)){const{message:b}=C("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(b)}const{relay:i,controller:a,namespaces:u,expiry:h}=r;if(!sh(i)){const{message:b}=C("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(b)}const g=e0(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=Si(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Ge(h)){const{message:b}=C("EXPIRED","onSessionSettleRequest()");throw new Error(b)}},this.isValidUpdate=async r=>{if(!Lt(r)){const{message:w}=C("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:i,namespaces:a}=r;await this.isValidSessionTopic(i);const u=this.client.session.get(i),h=Si(a,"update()");if(h)throw new Error(h.message);const g=Xu(u.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!Lt(r)){const{message:a}=C("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!Lt(r)){const{message:w}=C("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:i,request:a,chainId:u,expiry:h}=r;await this.isValidSessionTopic(i);const{namespaces:g}=this.client.session.get(i);if(!Zu(g,u)){const{message:w}=C("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!h0(a)){const{message:w}=C("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!d0(g,u,a.method)){const{message:w}=C("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(h&&!m0(h,lo)){const{message:w}=C("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${lo.min} and ${lo.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var i;if(!Lt(r)){const{message:h}=C("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(h){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),h}if(!p0(u)){const{message:h}=C("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!Lt(r)){const{message:a}=C("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!Lt(r)){const{message:g}=C("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:i,event:a,chainId:u}=r;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!Zu(h,u)){const{message:g}=C("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!f0(a)){const{message:g}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!g0(h,u,a.name)){const{message:g}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!Lt(r)){const{message:a}=C("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const a={verified:{verifyUrl:i.verifyUrl||Dr,validation:"UNKNOWN",origin:i.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(i.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(a=>{if(!bt(a,!1)){const{message:u}=C("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Nt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const a=await this.client.core.crypto.decode(r,i);try{qo(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Di(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(ie.expired,async e=>{const{topic:r,id:i}=nh(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,C("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(_n.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!bt(e,!1)){const{message:r}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ge(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=C("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!bt(e,!1)){const{message:r}=C("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ge(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=C("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(bt(e,!1)){const{message:r}=C("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=C("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!u0(e)){const{message:r}=C("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ge(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=C("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class gP extends ji{constructor(e,r){super(e,r,iP,Fo),this.core=e,this.logger=r}}class vP extends ji{constructor(e,r){super(e,r,sP,Fo),this.core=e,this.logger=r}}class yP extends ji{constructor(e,r){super(e,r,aP,Fo,i=>i.id),this.core=e,this.logger=r}}let mP=class Ph extends T_{constructor(e){super(e),this.protocol=_h,this.version=bh,this.name=uo.name,this.events=new be.EventEmitter,this.on=(i,a)=>this.events.on(i,a),this.once=(i,a)=>this.events.once(i,a),this.off=(i,a)=>this.events.off(i,a),this.removeListener=(i,a)=>this.events.removeListener(i,a),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(a){throw this.logger.error(a.message),a}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(a){throw this.logger.error(a.message),a}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(a){throw this.logger.error(a.message),a}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(a){throw this.logger.error(a.message),a}},this.update=async i=>{try{return await this.engine.update(i)}catch(a){throw this.logger.error(a.message),a}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(a){throw this.logger.error(a.message),a}},this.request=async i=>{try{return await this.engine.request(i)}catch(a){throw this.logger.error(a.message),a}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(a){throw this.logger.error(a.message),a}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(a){throw this.logger.error(a.message),a}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(a){throw this.logger.error(a.message),a}},this.find=i=>{try{return this.engine.find(i)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=e?.name||uo.name,this.metadata=e?.metadata||Ob();const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:xi(Ti({level:e?.logger||uo.logger}));this.core=e?.core||new nP(e),this.logger=zt(r,this.name),this.session=new vP(this.core,this.logger),this.proposal=new gP(this.core,this.logger),this.pendingRequest=new yP(this.core,this.logger),this.engine=new dP(this)}static async init(e){const r=new Ph(e);return await r.initialize(),r}get context(){return Jt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const wP=o=>JSON.stringify(o,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),_P=o=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=o.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function bP(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return _P(o)}catch{return o}}function Pl(o){return typeof o=="string"?o:wP(o)||""}var EP=Object.defineProperty,IP=Object.defineProperties,PP=Object.getOwnPropertyDescriptors,Sl=Object.getOwnPropertySymbols,SP=Object.prototype.hasOwnProperty,OP=Object.prototype.propertyIsEnumerable,Ol=(o,e,r)=>e in o?EP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Nl=(o,e)=>{for(var r in e||(e={}))SP.call(e,r)&&Ol(o,r,e[r]);if(Sl)for(var r of Sl(e))OP.call(e,r)&&Ol(o,r,e[r]);return o},Rl=(o,e)=>IP(o,PP(e));const NP={Accept:"application/json","Content-Type":"application/json"},RP="POST",Cl={headers:NP,method:RP},xl=10;let Ye=class{constructor(o,e=!1){if(this.url=o,this.disableProviderPing=e,this.events=new be.EventEmitter,this.isAvailable=!1,this.registering=!1,!Ru(o))throw new Error(`Provided URL is not compatible with HTTP connection: ${o}`);this.url=o,this.disableProviderPing=e}get connected(){return this.isAvailable}get connecting(){return this.registering}on(o,e){this.events.on(o,e)}once(o,e){this.events.once(o,e)}off(o,e){this.events.off(o,e)}removeListener(o,e){this.events.removeListener(o,e)}async open(o=this.url){await this.register(o)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(o){this.isAvailable||await this.register();try{const e=Pl(o),r=await(await Nu(this.url,Rl(Nl({},Cl),{body:e}))).json();this.onPayload({data:r})}catch(e){this.onError(o.id,e)}}async register(o=this.url){if(!Ru(o))throw new Error(`Provided URL is not compatible with HTTP connection: ${o}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((r,i)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),i(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));r()})})}this.url=o,this.registering=!0;try{if(!this.disableProviderPing){const e=Pl({id:1,jsonrpc:"2.0",method:"test",params:[]});await Nu(o,Rl(Nl({},Cl),{body:e}))}this.onOpen()}catch(e){const r=this.parseError(e);throw this.events.emit("register_error",r),this.onClose(),r}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(o){if(typeof o.data>"u")return;const e=typeof o.data=="string"?bP(o.data):o.data;this.events.emit("payload",e)}onError(o,e){const r=this.parseError(e),i=r.message||r.toString(),a=Do(o,i);this.events.emit("payload",a)}parseError(o,e=this.url){return Rw(o,e,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>xl&&this.events.setMaxListeners(xl)}};const Tl="error",CP="wss://relay.walletconnect.com",xP="wc",TP="universal_provider",Al=`${xP}@2:${TP}:`,AP="https://rpc.walletconnect.com/v1/",$e={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof X.global<"u"?X.global:typeof self<"u"?self:{},No={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,e){(function(){var r,i="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,S="__lodash_placeholder__",O=1,R=2,U=4,D=1,A=2,F=1,Y=2,yt=4,et=8,J=16,at=32,Rt=64,pt=128,Ct=256,je=512,Nh=30,Rh="...",Ch=800,xh=16,Jo=1,Th=2,Ah=3,Ze=1/0,Ue=9007199254740991,Dh=17976931348623157e292,Nn=NaN,ge=4294967295,qh=ge-1,$h=ge>>>1,jh=[["ary",pt],["bind",F],["bindKey",Y],["curry",et],["curryRight",J],["flip",je],["partial",at],["partialRight",Rt],["rearg",Ct]],vr="[object Arguments]",Rn="[object Array]",Uh="[object AsyncFunction]",Hr="[object Boolean]",Kr="[object Date]",Mh="[object DOMException]",Cn="[object Error]",xn="[object Function]",Qo="[object GeneratorFunction]",oe="[object Map]",Wr="[object Number]",Lh="[object Null]",Ee="[object Object]",Yo="[object Promise]",kh="[object Proxy]",Fr="[object RegExp]",ae="[object Set]",Br="[object String]",Tn="[object Symbol]",zh="[object Undefined]",Gr="[object WeakMap]",Vh="[object WeakSet]",Jr="[object ArrayBuffer]",yr="[object DataView]",Ui="[object Float32Array]",Mi="[object Float64Array]",Li="[object Int8Array]",ki="[object Int16Array]",zi="[object Int32Array]",Vi="[object Uint8Array]",Hi="[object Uint8ClampedArray]",Ki="[object Uint16Array]",Wi="[object Uint32Array]",Hh=/\b__p \+= '';/g,Kh=/\b(__p \+=) '' \+/g,Wh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Zo=/&(?:amp|lt|gt|quot|#39);/g,Xo=/[&<>"']/g,Fh=RegExp(Zo.source),Bh=RegExp(Xo.source),Gh=/<%-([\s\S]+?)%>/g,Jh=/<%([\s\S]+?)%>/g,ta=/<%=([\s\S]+?)%>/g,Qh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yh=/^\w*$/,Zh=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fi=/[\\^$.*+?()[\]{}|]/g,Xh=RegExp(Fi.source),Bi=/^\s+/,tp=/\s/,ep=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,rp=/\{\n\/\* \[wrapped with (.+)\] \*/,np=/,? & /,ip=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sp=/[()=,{}\[\]\/\s]/,op=/\\(\\)?/g,ap=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ea=/\w*$/,cp=/^[-+]0x[0-9a-f]+$/i,up=/^0b[01]+$/i,lp=/^\[object .+?Constructor\]$/,hp=/^0o[0-7]+$/i,pp=/^(?:0|[1-9]\d*)$/,fp=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,An=/($^)/,dp=/['\n\r\u2028\u2029\\]/g,Dn="\\ud800-\\udfff",gp="\\u0300-\\u036f",vp="\\ufe20-\\ufe2f",yp="\\u20d0-\\u20ff",ra=gp+vp+yp,na="\\u2700-\\u27bf",ia="a-z\\xdf-\\xf6\\xf8-\\xff",mp="\\xac\\xb1\\xd7\\xf7",wp="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",_p="\\u2000-\\u206f",bp=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",sa="A-Z\\xc0-\\xd6\\xd8-\\xde",oa="\\ufe0e\\ufe0f",aa=mp+wp+_p+bp,Gi="['’]",Ep="["+Dn+"]",ca="["+aa+"]",qn="["+ra+"]",ua="\\d+",Ip="["+na+"]",la="["+ia+"]",ha="[^"+Dn+aa+ua+na+ia+sa+"]",Ji="\\ud83c[\\udffb-\\udfff]",Pp="(?:"+qn+"|"+Ji+")",pa="[^"+Dn+"]",Qi="(?:\\ud83c[\\udde6-\\uddff]){2}",Yi="[\\ud800-\\udbff][\\udc00-\\udfff]",mr="["+sa+"]",fa="\\u200d",da="(?:"+la+"|"+ha+")",Sp="(?:"+mr+"|"+ha+")",ga="(?:"+Gi+"(?:d|ll|m|re|s|t|ve))?",va="(?:"+Gi+"(?:D|LL|M|RE|S|T|VE))?",ya=Pp+"?",ma="["+oa+"]?",Op="(?:"+fa+"(?:"+[pa,Qi,Yi].join("|")+")"+ma+ya+")*",Np="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Rp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",wa=ma+ya+Op,Cp="(?:"+[Ip,Qi,Yi].join("|")+")"+wa,xp="(?:"+[pa+qn+"?",qn,Qi,Yi,Ep].join("|")+")",Tp=RegExp(Gi,"g"),Ap=RegExp(qn,"g"),Zi=RegExp(Ji+"(?="+Ji+")|"+xp+wa,"g"),Dp=RegExp([mr+"?"+la+"+"+ga+"(?="+[ca,mr,"$"].join("|")+")",Sp+"+"+va+"(?="+[ca,mr+da,"$"].join("|")+")",mr+"?"+da+"+"+ga,mr+"+"+va,Rp,Np,ua,Cp].join("|"),"g"),qp=RegExp("["+fa+Dn+ra+oa+"]"),$p=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Up=-1,ot={};ot[Ui]=ot[Mi]=ot[Li]=ot[ki]=ot[zi]=ot[Vi]=ot[Hi]=ot[Ki]=ot[Wi]=!0,ot[vr]=ot[Rn]=ot[Jr]=ot[Hr]=ot[yr]=ot[Kr]=ot[Cn]=ot[xn]=ot[oe]=ot[Wr]=ot[Ee]=ot[Fr]=ot[ae]=ot[Br]=ot[Gr]=!1;var nt={};nt[vr]=nt[Rn]=nt[Jr]=nt[yr]=nt[Hr]=nt[Kr]=nt[Ui]=nt[Mi]=nt[Li]=nt[ki]=nt[zi]=nt[oe]=nt[Wr]=nt[Ee]=nt[Fr]=nt[ae]=nt[Br]=nt[Tn]=nt[Vi]=nt[Hi]=nt[Ki]=nt[Wi]=!0,nt[Cn]=nt[xn]=nt[Gr]=!1;var Mp={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Lp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},kp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},zp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Vp=parseFloat,Hp=parseInt,_a=typeof mn=="object"&&mn&&mn.Object===Object&&mn,Kp=typeof self=="object"&&self&&self.Object===Object&&self,Et=_a||Kp||Function("return this")(),Xi=e&&!e.nodeType&&e,Xe=Xi&&!0&&o&&!o.nodeType&&o,ba=Xe&&Xe.exports===Xi,ts=ba&&_a.process,Qt=function(){try{var y=Xe&&Xe.require&&Xe.require("util").types;return y||ts&&ts.binding&&ts.binding("util")}catch{}}(),Ea=Qt&&Qt.isArrayBuffer,Ia=Qt&&Qt.isDate,Pa=Qt&&Qt.isMap,Sa=Qt&&Qt.isRegExp,Oa=Qt&&Qt.isSet,Na=Qt&&Qt.isTypedArray;function Vt(y,E,_){switch(_.length){case 0:return y.call(E);case 1:return y.call(E,_[0]);case 2:return y.call(E,_[0],_[1]);case 3:return y.call(E,_[0],_[1],_[2])}return y.apply(E,_)}function Wp(y,E,_,T){for(var k=-1,Q=y==null?0:y.length;++k<Q;){var mt=y[k];E(T,mt,_(mt),y)}return T}function Yt(y,E){for(var _=-1,T=y==null?0:y.length;++_<T&&E(y[_],_,y)!==!1;);return y}function Fp(y,E){for(var _=y==null?0:y.length;_--&&E(y[_],_,y)!==!1;);return y}function Ra(y,E){for(var _=-1,T=y==null?0:y.length;++_<T;)if(!E(y[_],_,y))return!1;return!0}function Me(y,E){for(var _=-1,T=y==null?0:y.length,k=0,Q=[];++_<T;){var mt=y[_];E(mt,_,y)&&(Q[k++]=mt)}return Q}function $n(y,E){var _=y==null?0:y.length;return!!_&&wr(y,E,0)>-1}function es(y,E,_){for(var T=-1,k=y==null?0:y.length;++T<k;)if(_(E,y[T]))return!0;return!1}function ct(y,E){for(var _=-1,T=y==null?0:y.length,k=Array(T);++_<T;)k[_]=E(y[_],_,y);return k}function Le(y,E){for(var _=-1,T=E.length,k=y.length;++_<T;)y[k+_]=E[_];return y}function rs(y,E,_,T){var k=-1,Q=y==null?0:y.length;for(T&&Q&&(_=y[++k]);++k<Q;)_=E(_,y[k],k,y);return _}function Bp(y,E,_,T){var k=y==null?0:y.length;for(T&&k&&(_=y[--k]);k--;)_=E(_,y[k],k,y);return _}function ns(y,E){for(var _=-1,T=y==null?0:y.length;++_<T;)if(E(y[_],_,y))return!0;return!1}var Gp=is("length");function Jp(y){return y.split("")}function Qp(y){return y.match(ip)||[]}function Ca(y,E,_){var T;return _(y,function(k,Q,mt){if(E(k,Q,mt))return T=Q,!1}),T}function jn(y,E,_,T){for(var k=y.length,Q=_+(T?1:-1);T?Q--:++Q<k;)if(E(y[Q],Q,y))return Q;return-1}function wr(y,E,_){return E===E?uf(y,E,_):jn(y,xa,_)}function Yp(y,E,_,T){for(var k=_-1,Q=y.length;++k<Q;)if(T(y[k],E))return k;return-1}function xa(y){return y!==y}function Ta(y,E){var _=y==null?0:y.length;return _?os(y,E)/_:Nn}function is(y){return function(E){return E==null?r:E[y]}}function ss(y){return function(E){return y==null?r:y[E]}}function Aa(y,E,_,T,k){return k(y,function(Q,mt,rt){_=T?(T=!1,Q):E(_,Q,mt,rt)}),_}function Zp(y,E){var _=y.length;for(y.sort(E);_--;)y[_]=y[_].value;return y}function os(y,E){for(var _,T=-1,k=y.length;++T<k;){var Q=E(y[T]);Q!==r&&(_=_===r?Q:_+Q)}return _}function as(y,E){for(var _=-1,T=Array(y);++_<y;)T[_]=E(_);return T}function Xp(y,E){return ct(E,function(_){return[_,y[_]]})}function Da(y){return y&&y.slice(0,Ua(y)+1).replace(Bi,"")}function Ht(y){return function(E){return y(E)}}function cs(y,E){return ct(E,function(_){return y[_]})}function Qr(y,E){return y.has(E)}function qa(y,E){for(var _=-1,T=y.length;++_<T&&wr(E,y[_],0)>-1;);return _}function $a(y,E){for(var _=y.length;_--&&wr(E,y[_],0)>-1;);return _}function tf(y,E){for(var _=y.length,T=0;_--;)y[_]===E&&++T;return T}var ef=ss(Mp),rf=ss(Lp);function nf(y){return"\\"+zp[y]}function sf(y,E){return y==null?r:y[E]}function _r(y){return qp.test(y)}function of(y){return $p.test(y)}function af(y){for(var E,_=[];!(E=y.next()).done;)_.push(E.value);return _}function us(y){var E=-1,_=Array(y.size);return y.forEach(function(T,k){_[++E]=[k,T]}),_}function ja(y,E){return function(_){return y(E(_))}}function ke(y,E){for(var _=-1,T=y.length,k=0,Q=[];++_<T;){var mt=y[_];(mt===E||mt===S)&&(y[_]=S,Q[k++]=_)}return Q}function Un(y){var E=-1,_=Array(y.size);return y.forEach(function(T){_[++E]=T}),_}function cf(y){var E=-1,_=Array(y.size);return y.forEach(function(T){_[++E]=[T,T]}),_}function uf(y,E,_){for(var T=_-1,k=y.length;++T<k;)if(y[T]===E)return T;return-1}function lf(y,E,_){for(var T=_+1;T--;)if(y[T]===E)return T;return T}function br(y){return _r(y)?pf(y):Gp(y)}function ce(y){return _r(y)?ff(y):Jp(y)}function Ua(y){for(var E=y.length;E--&&tp.test(y.charAt(E)););return E}var hf=ss(kp);function pf(y){for(var E=Zi.lastIndex=0;Zi.test(y);)++E;return E}function ff(y){return y.match(Zi)||[]}function df(y){return y.match(Dp)||[]}var gf=function y(E){E=E==null?Et:Er.defaults(Et.Object(),E,Er.pick(Et,jp));var _=E.Array,T=E.Date,k=E.Error,Q=E.Function,mt=E.Math,rt=E.Object,ls=E.RegExp,vf=E.String,Zt=E.TypeError,Mn=_.prototype,yf=Q.prototype,Ir=rt.prototype,Ln=E["__core-js_shared__"],kn=yf.toString,tt=Ir.hasOwnProperty,mf=0,Ma=function(){var t=/[^.]+$/.exec(Ln&&Ln.keys&&Ln.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),zn=Ir.toString,wf=kn.call(rt),_f=Et._,bf=ls("^"+kn.call(tt).replace(Fi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vn=ba?E.Buffer:r,ze=E.Symbol,Hn=E.Uint8Array,La=Vn?Vn.allocUnsafe:r,Kn=ja(rt.getPrototypeOf,rt),ka=rt.create,za=Ir.propertyIsEnumerable,Wn=Mn.splice,Va=ze?ze.isConcatSpreadable:r,Yr=ze?ze.iterator:r,tr=ze?ze.toStringTag:r,Fn=function(){try{var t=sr(rt,"defineProperty");return t({},"",{}),t}catch{}}(),Ef=E.clearTimeout!==Et.clearTimeout&&E.clearTimeout,If=T&&T.now!==Et.Date.now&&T.now,Pf=E.setTimeout!==Et.setTimeout&&E.setTimeout,Bn=mt.ceil,Gn=mt.floor,hs=rt.getOwnPropertySymbols,Sf=Vn?Vn.isBuffer:r,Ha=E.isFinite,Of=Mn.join,Nf=ja(rt.keys,rt),wt=mt.max,St=mt.min,Rf=T.now,Cf=E.parseInt,Ka=mt.random,xf=Mn.reverse,ps=sr(E,"DataView"),Zr=sr(E,"Map"),fs=sr(E,"Promise"),Pr=sr(E,"Set"),Xr=sr(E,"WeakMap"),tn=sr(rt,"create"),Jn=Xr&&new Xr,Sr={},Tf=or(ps),Af=or(Zr),Df=or(fs),qf=or(Pr),$f=or(Xr),Qn=ze?ze.prototype:r,en=Qn?Qn.valueOf:r,Wa=Qn?Qn.toString:r;function p(t){if(ht(t)&&!z(t)&&!(t instanceof B)){if(t instanceof Xt)return t;if(tt.call(t,"__wrapped__"))return Fc(t)}return new Xt(t)}var Or=function(){function t(){}return function(n){if(!lt(n))return{};if(ka)return ka(n);t.prototype=n;var s=new t;return t.prototype=r,s}}();function Yn(){}function Xt(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=r}p.templateSettings={escape:Gh,evaluate:Jh,interpolate:ta,variable:"",imports:{_:p}},p.prototype=Yn.prototype,p.prototype.constructor=p,Xt.prototype=Or(Yn.prototype),Xt.prototype.constructor=Xt;function B(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ge,this.__views__=[]}function jf(){var t=new B(this.__wrapped__);return t.__actions__=qt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=qt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=qt(this.__views__),t}function Uf(){if(this.__filtered__){var t=new B(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Mf(){var t=this.__wrapped__.value(),n=this.__dir__,s=z(t),c=n<0,l=s?t.length:0,f=Qd(0,l,this.__views__),d=f.start,v=f.end,m=v-d,I=c?v:d-1,P=this.__iteratees__,N=P.length,x=0,q=St(m,this.__takeCount__);if(!s||!c&&l==m&&q==m)return gc(t,this.__actions__);var M=[];t:for(;m--&&x<q;){I+=n;for(var H=-1,L=t[I];++H<N;){var W=P[H],G=W.iteratee,Ft=W.type,At=G(L);if(Ft==Th)L=At;else if(!At){if(Ft==Jo)continue t;break t}}M[x++]=L}return M}B.prototype=Or(Yn.prototype),B.prototype.constructor=B;function er(t){var n=-1,s=t==null?0:t.length;for(this.clear();++n<s;){var c=t[n];this.set(c[0],c[1])}}function Lf(){this.__data__=tn?tn(null):{},this.size=0}function kf(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n}function zf(t){var n=this.__data__;if(tn){var s=n[t];return s===w?r:s}return tt.call(n,t)?n[t]:r}function Vf(t){var n=this.__data__;return tn?n[t]!==r:tt.call(n,t)}function Hf(t,n){var s=this.__data__;return this.size+=this.has(t)?0:1,s[t]=tn&&n===r?w:n,this}er.prototype.clear=Lf,er.prototype.delete=kf,er.prototype.get=zf,er.prototype.has=Vf,er.prototype.set=Hf;function Ie(t){var n=-1,s=t==null?0:t.length;for(this.clear();++n<s;){var c=t[n];this.set(c[0],c[1])}}function Kf(){this.__data__=[],this.size=0}function Wf(t){var n=this.__data__,s=Zn(n,t);if(s<0)return!1;var c=n.length-1;return s==c?n.pop():Wn.call(n,s,1),--this.size,!0}function Ff(t){var n=this.__data__,s=Zn(n,t);return s<0?r:n[s][1]}function Bf(t){return Zn(this.__data__,t)>-1}function Gf(t,n){var s=this.__data__,c=Zn(s,t);return c<0?(++this.size,s.push([t,n])):s[c][1]=n,this}Ie.prototype.clear=Kf,Ie.prototype.delete=Wf,Ie.prototype.get=Ff,Ie.prototype.has=Bf,Ie.prototype.set=Gf;function Pe(t){var n=-1,s=t==null?0:t.length;for(this.clear();++n<s;){var c=t[n];this.set(c[0],c[1])}}function Jf(){this.size=0,this.__data__={hash:new er,map:new(Zr||Ie),string:new er}}function Qf(t){var n=li(this,t).delete(t);return this.size-=n?1:0,n}function Yf(t){return li(this,t).get(t)}function Zf(t){return li(this,t).has(t)}function Xf(t,n){var s=li(this,t),c=s.size;return s.set(t,n),this.size+=s.size==c?0:1,this}Pe.prototype.clear=Jf,Pe.prototype.delete=Qf,Pe.prototype.get=Yf,Pe.prototype.has=Zf,Pe.prototype.set=Xf;function rr(t){var n=-1,s=t==null?0:t.length;for(this.__data__=new Pe;++n<s;)this.add(t[n])}function td(t){return this.__data__.set(t,w),this}function ed(t){return this.__data__.has(t)}rr.prototype.add=rr.prototype.push=td,rr.prototype.has=ed;function ue(t){var n=this.__data__=new Ie(t);this.size=n.size}function rd(){this.__data__=new Ie,this.size=0}function nd(t){var n=this.__data__,s=n.delete(t);return this.size=n.size,s}function id(t){return this.__data__.get(t)}function sd(t){return this.__data__.has(t)}function od(t,n){var s=this.__data__;if(s instanceof Ie){var c=s.__data__;if(!Zr||c.length<a-1)return c.push([t,n]),this.size=++s.size,this;s=this.__data__=new Pe(c)}return s.set(t,n),this.size=s.size,this}ue.prototype.clear=rd,ue.prototype.delete=nd,ue.prototype.get=id,ue.prototype.has=sd,ue.prototype.set=od;function Fa(t,n){var s=z(t),c=!s&&ar(t),l=!s&&!c&&Fe(t),f=!s&&!c&&!l&&xr(t),d=s||c||l||f,v=d?as(t.length,vf):[],m=v.length;for(var I in t)(n||tt.call(t,I))&&!(d&&(I=="length"||l&&(I=="offset"||I=="parent")||f&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||Re(I,m)))&&v.push(I);return v}function Ba(t){var n=t.length;return n?t[Ps(0,n-1)]:r}function ad(t,n){return hi(qt(t),nr(n,0,t.length))}function cd(t){return hi(qt(t))}function ds(t,n,s){(s!==r&&!le(t[n],s)||s===r&&!(n in t))&&Se(t,n,s)}function rn(t,n,s){var c=t[n];(!(tt.call(t,n)&&le(c,s))||s===r&&!(n in t))&&Se(t,n,s)}function Zn(t,n){for(var s=t.length;s--;)if(le(t[s][0],n))return s;return-1}function ud(t,n,s,c){return Ve(t,function(l,f,d){n(c,l,s(l),d)}),c}function Ga(t,n){return t&&ye(n,_t(n),t)}function ld(t,n){return t&&ye(n,jt(n),t)}function Se(t,n,s){n=="__proto__"&&Fn?Fn(t,n,{configurable:!0,enumerable:!0,value:s,writable:!0}):t[n]=s}function gs(t,n){for(var s=-1,c=n.length,l=_(c),f=t==null;++s<c;)l[s]=f?r:Js(t,n[s]);return l}function nr(t,n,s){return t===t&&(s!==r&&(t=t<=s?t:s),n!==r&&(t=t>=n?t:n)),t}function te(t,n,s,c,l,f){var d,v=n&O,m=n&R,I=n&U;if(s&&(d=l?s(t,c,l,f):s(t)),d!==r)return d;if(!lt(t))return t;var P=z(t);if(P){if(d=Zd(t),!v)return qt(t,d)}else{var N=Ot(t),x=N==xn||N==Qo;if(Fe(t))return mc(t,v);if(N==Ee||N==vr||x&&!l){if(d=m||x?{}:Uc(t),!v)return m?zd(t,ld(d,t)):kd(t,Ga(d,t))}else{if(!nt[N])return l?t:{};d=Xd(t,N,v)}}f||(f=new ue);var q=f.get(t);if(q)return q;f.set(t,d),pu(t)?t.forEach(function(L){d.add(te(L,n,s,L,t,f))}):lu(t)&&t.forEach(function(L,W){d.set(W,te(L,n,s,W,t,f))});var M=I?m?$s:qs:m?jt:_t,H=P?r:M(t);return Yt(H||t,function(L,W){H&&(W=L,L=t[W]),rn(d,W,te(L,n,s,W,t,f))}),d}function hd(t){var n=_t(t);return function(s){return Ja(s,t,n)}}function Ja(t,n,s){var c=s.length;if(t==null)return!c;for(t=rt(t);c--;){var l=s[c],f=n[l],d=t[l];if(d===r&&!(l in t)||!f(d))return!1}return!0}function Qa(t,n,s){if(typeof t!="function")throw new Zt(h);return ln(function(){t.apply(r,s)},n)}function nn(t,n,s,c){var l=-1,f=$n,d=!0,v=t.length,m=[],I=n.length;if(!v)return m;s&&(n=ct(n,Ht(s))),c?(f=es,d=!1):n.length>=a&&(f=Qr,d=!1,n=new rr(n));t:for(;++l<v;){var P=t[l],N=s==null?P:s(P);if(P=c||P!==0?P:0,d&&N===N){for(var x=I;x--;)if(n[x]===N)continue t;m.push(P)}else f(n,N,c)||m.push(P)}return m}var Ve=Ic(ve),Ya=Ic(ys,!0);function pd(t,n){var s=!0;return Ve(t,function(c,l,f){return s=!!n(c,l,f),s}),s}function Xn(t,n,s){for(var c=-1,l=t.length;++c<l;){var f=t[c],d=n(f);if(d!=null&&(v===r?d===d&&!Wt(d):s(d,v)))var v=d,m=f}return m}function fd(t,n,s,c){var l=t.length;for(s=V(s),s<0&&(s=-s>l?0:l+s),c=c===r||c>l?l:V(c),c<0&&(c+=l),c=s>c?0:du(c);s<c;)t[s++]=n;return t}function Za(t,n){var s=[];return Ve(t,function(c,l,f){n(c,l,f)&&s.push(c)}),s}function It(t,n,s,c,l){var f=-1,d=t.length;for(s||(s=eg),l||(l=[]);++f<d;){var v=t[f];n>0&&s(v)?n>1?It(v,n-1,s,c,l):Le(l,v):c||(l[l.length]=v)}return l}var vs=Pc(),Xa=Pc(!0);function ve(t,n){return t&&vs(t,n,_t)}function ys(t,n){return t&&Xa(t,n,_t)}function ti(t,n){return Me(n,function(s){return Ce(t[s])})}function ir(t,n){n=Ke(n,t);for(var s=0,c=n.length;t!=null&&s<c;)t=t[me(n[s++])];return s&&s==c?t:r}function tc(t,n,s){var c=n(t);return z(t)?c:Le(c,s(t))}function xt(t){return t==null?t===r?zh:Lh:tr&&tr in rt(t)?Jd(t):cg(t)}function ms(t,n){return t>n}function dd(t,n){return t!=null&&tt.call(t,n)}function gd(t,n){return t!=null&&n in rt(t)}function vd(t,n,s){return t>=St(n,s)&&t<wt(n,s)}function ws(t,n,s){for(var c=s?es:$n,l=t[0].length,f=t.length,d=f,v=_(f),m=1/0,I=[];d--;){var P=t[d];d&&n&&(P=ct(P,Ht(n))),m=St(P.length,m),v[d]=!s&&(n||l>=120&&P.length>=120)?new rr(d&&P):r}P=t[0];var N=-1,x=v[0];t:for(;++N<l&&I.length<m;){var q=P[N],M=n?n(q):q;if(q=s||q!==0?q:0,!(x?Qr(x,M):c(I,M,s))){for(d=f;--d;){var H=v[d];if(!(H?Qr(H,M):c(t[d],M,s)))continue t}x&&x.push(M),I.push(q)}}return I}function yd(t,n,s,c){return ve(t,function(l,f,d){n(c,s(l),f,d)}),c}function sn(t,n,s){n=Ke(n,t),t=zc(t,n);var c=t==null?t:t[me(re(n))];return c==null?r:Vt(c,t,s)}function ec(t){return ht(t)&&xt(t)==vr}function md(t){return ht(t)&&xt(t)==Jr}function wd(t){return ht(t)&&xt(t)==Kr}function on(t,n,s,c,l){return t===n?!0:t==null||n==null||!ht(t)&&!ht(n)?t!==t&&n!==n:_d(t,n,s,c,on,l)}function _d(t,n,s,c,l,f){var d=z(t),v=z(n),m=d?Rn:Ot(t),I=v?Rn:Ot(n);m=m==vr?Ee:m,I=I==vr?Ee:I;var P=m==Ee,N=I==Ee,x=m==I;if(x&&Fe(t)){if(!Fe(n))return!1;d=!0,P=!1}if(x&&!P)return f||(f=new ue),d||xr(t)?qc(t,n,s,c,l,f):Bd(t,n,m,s,c,l,f);if(!(s&D)){var q=P&&tt.call(t,"__wrapped__"),M=N&&tt.call(n,"__wrapped__");if(q||M){var H=q?t.value():t,L=M?n.value():n;return f||(f=new ue),l(H,L,s,c,f)}}return x?(f||(f=new ue),Gd(t,n,s,c,l,f)):!1}function bd(t){return ht(t)&&Ot(t)==oe}function _s(t,n,s,c){var l=s.length,f=l,d=!c;if(t==null)return!f;for(t=rt(t);l--;){var v=s[l];if(d&&v[2]?v[1]!==t[v[0]]:!(v[0]in t))return!1}for(;++l<f;){v=s[l];var m=v[0],I=t[m],P=v[1];if(d&&v[2]){if(I===r&&!(m in t))return!1}else{var N=new ue;if(c)var x=c(I,P,m,t,n,N);if(!(x===r?on(P,I,D|A,c,N):x))return!1}}return!0}function rc(t){if(!lt(t)||ng(t))return!1;var n=Ce(t)?bf:lp;return n.test(or(t))}function Ed(t){return ht(t)&&xt(t)==Fr}function Id(t){return ht(t)&&Ot(t)==ae}function Pd(t){return ht(t)&&yi(t.length)&&!!ot[xt(t)]}function nc(t){return typeof t=="function"?t:t==null?Ut:typeof t=="object"?z(t)?oc(t[0],t[1]):sc(t):Su(t)}function bs(t){if(!un(t))return Nf(t);var n=[];for(var s in rt(t))tt.call(t,s)&&s!="constructor"&&n.push(s);return n}function Sd(t){if(!lt(t))return ag(t);var n=un(t),s=[];for(var c in t)c=="constructor"&&(n||!tt.call(t,c))||s.push(c);return s}function Es(t,n){return t<n}function ic(t,n){var s=-1,c=$t(t)?_(t.length):[];return Ve(t,function(l,f,d){c[++s]=n(l,f,d)}),c}function sc(t){var n=Us(t);return n.length==1&&n[0][2]?Lc(n[0][0],n[0][1]):function(s){return s===t||_s(s,t,n)}}function oc(t,n){return Ls(t)&&Mc(n)?Lc(me(t),n):function(s){var c=Js(s,t);return c===r&&c===n?Qs(s,t):on(n,c,D|A)}}function ei(t,n,s,c,l){t!==n&&vs(n,function(f,d){if(l||(l=new ue),lt(f))Od(t,n,d,s,ei,c,l);else{var v=c?c(zs(t,d),f,d+"",t,n,l):r;v===r&&(v=f),ds(t,d,v)}},jt)}function Od(t,n,s,c,l,f,d){var v=zs(t,s),m=zs(n,s),I=d.get(m);if(I){ds(t,s,I);return}var P=f?f(v,m,s+"",t,n,d):r,N=P===r;if(N){var x=z(m),q=!x&&Fe(m),M=!x&&!q&&xr(m);P=m,x||q||M?z(v)?P=v:ft(v)?P=qt(v):q?(N=!1,P=mc(m,!0)):M?(N=!1,P=wc(m,!0)):P=[]:hn(m)||ar(m)?(P=v,ar(v)?P=gu(v):(!lt(v)||Ce(v))&&(P=Uc(m))):N=!1}N&&(d.set(m,P),l(P,m,c,f,d),d.delete(m)),ds(t,s,P)}function ac(t,n){var s=t.length;if(s)return n+=n<0?s:0,Re(n,s)?t[n]:r}function cc(t,n,s){n.length?n=ct(n,function(f){return z(f)?function(d){return ir(d,f.length===1?f[0]:f)}:f}):n=[Ut];var c=-1;n=ct(n,Ht(j()));var l=ic(t,function(f,d,v){var m=ct(n,function(I){return I(f)});return{criteria:m,index:++c,value:f}});return Zp(l,function(f,d){return Ld(f,d,s)})}function Nd(t,n){return uc(t,n,function(s,c){return Qs(t,c)})}function uc(t,n,s){for(var c=-1,l=n.length,f={};++c<l;){var d=n[c],v=ir(t,d);s(v,d)&&an(f,Ke(d,t),v)}return f}function Rd(t){return function(n){return ir(n,t)}}function Is(t,n,s,c){var l=c?Yp:wr,f=-1,d=n.length,v=t;for(t===n&&(n=qt(n)),s&&(v=ct(t,Ht(s)));++f<d;)for(var m=0,I=n[f],P=s?s(I):I;(m=l(v,P,m,c))>-1;)v!==t&&Wn.call(v,m,1),Wn.call(t,m,1);return t}function lc(t,n){for(var s=t?n.length:0,c=s-1;s--;){var l=n[s];if(s==c||l!==f){var f=l;Re(l)?Wn.call(t,l,1):Ns(t,l)}}return t}function Ps(t,n){return t+Gn(Ka()*(n-t+1))}function Cd(t,n,s,c){for(var l=-1,f=wt(Bn((n-t)/(s||1)),0),d=_(f);f--;)d[c?f:++l]=t,t+=s;return d}function Ss(t,n){var s="";if(!t||n<1||n>Ue)return s;do n%2&&(s+=t),n=Gn(n/2),n&&(t+=t);while(n);return s}function K(t,n){return Vs(kc(t,n,Ut),t+"")}function xd(t){return Ba(Tr(t))}function Td(t,n){var s=Tr(t);return hi(s,nr(n,0,s.length))}function an(t,n,s,c){if(!lt(t))return t;n=Ke(n,t);for(var l=-1,f=n.length,d=f-1,v=t;v!=null&&++l<f;){var m=me(n[l]),I=s;if(m==="__proto__"||m==="constructor"||m==="prototype")return t;if(l!=d){var P=v[m];I=c?c(P,m,v):r,I===r&&(I=lt(P)?P:Re(n[l+1])?[]:{})}rn(v,m,I),v=v[m]}return t}var hc=Jn?function(t,n){return Jn.set(t,n),t}:Ut,Ad=Fn?function(t,n){return Fn(t,"toString",{configurable:!0,enumerable:!1,value:Zs(n),writable:!0})}:Ut;function Dd(t){return hi(Tr(t))}function ee(t,n,s){var c=-1,l=t.length;n<0&&(n=-n>l?0:l+n),s=s>l?l:s,s<0&&(s+=l),l=n>s?0:s-n>>>0,n>>>=0;for(var f=_(l);++c<l;)f[c]=t[c+n];return f}function qd(t,n){var s;return Ve(t,function(c,l,f){return s=n(c,l,f),!s}),!!s}function ri(t,n,s){var c=0,l=t==null?c:t.length;if(typeof n=="number"&&n===n&&l<=$h){for(;c<l;){var f=c+l>>>1,d=t[f];d!==null&&!Wt(d)&&(s?d<=n:d<n)?c=f+1:l=f}return l}return Os(t,n,Ut,s)}function Os(t,n,s,c){var l=0,f=t==null?0:t.length;if(f===0)return 0;n=s(n);for(var d=n!==n,v=n===null,m=Wt(n),I=n===r;l<f;){var P=Gn((l+f)/2),N=s(t[P]),x=N!==r,q=N===null,M=N===N,H=Wt(N);if(d)var L=c||M;else I?L=M&&(c||x):v?L=M&&x&&(c||!q):m?L=M&&x&&!q&&(c||!H):q||H?L=!1:L=c?N<=n:N<n;L?l=P+1:f=P}return St(f,qh)}function pc(t,n){for(var s=-1,c=t.length,l=0,f=[];++s<c;){var d=t[s],v=n?n(d):d;if(!s||!le(v,m)){var m=v;f[l++]=d===0?0:d}}return f}function fc(t){return typeof t=="number"?t:Wt(t)?Nn:+t}function Kt(t){if(typeof t=="string")return t;if(z(t))return ct(t,Kt)+"";if(Wt(t))return Wa?Wa.call(t):"";var n=t+"";return n=="0"&&1/t==-Ze?"-0":n}function He(t,n,s){var c=-1,l=$n,f=t.length,d=!0,v=[],m=v;if(s)d=!1,l=es;else if(f>=a){var I=n?null:Wd(t);if(I)return Un(I);d=!1,l=Qr,m=new rr}else m=n?[]:v;t:for(;++c<f;){var P=t[c],N=n?n(P):P;if(P=s||P!==0?P:0,d&&N===N){for(var x=m.length;x--;)if(m[x]===N)continue t;n&&m.push(N),v.push(P)}else l(m,N,s)||(m!==v&&m.push(N),v.push(P))}return v}function Ns(t,n){return n=Ke(n,t),t=zc(t,n),t==null||delete t[me(re(n))]}function dc(t,n,s,c){return an(t,n,s(ir(t,n)),c)}function ni(t,n,s,c){for(var l=t.length,f=c?l:-1;(c?f--:++f<l)&&n(t[f],f,t););return s?ee(t,c?0:f,c?f+1:l):ee(t,c?f+1:0,c?l:f)}function gc(t,n){var s=t;return s instanceof B&&(s=s.value()),rs(n,function(c,l){return l.func.apply(l.thisArg,Le([c],l.args))},s)}function Rs(t,n,s){var c=t.length;if(c<2)return c?He(t[0]):[];for(var l=-1,f=_(c);++l<c;)for(var d=t[l],v=-1;++v<c;)v!=l&&(f[l]=nn(f[l]||d,t[v],n,s));return He(It(f,1),n,s)}function vc(t,n,s){for(var c=-1,l=t.length,f=n.length,d={};++c<l;){var v=c<f?n[c]:r;s(d,t[c],v)}return d}function Cs(t){return ft(t)?t:[]}function xs(t){return typeof t=="function"?t:Ut}function Ke(t,n){return z(t)?t:Ls(t,n)?[t]:Wc(Z(t))}var $d=K;function We(t,n,s){var c=t.length;return s=s===r?c:s,!n&&s>=c?t:ee(t,n,s)}var yc=Ef||function(t){return Et.clearTimeout(t)};function mc(t,n){if(n)return t.slice();var s=t.length,c=La?La(s):new t.constructor(s);return t.copy(c),c}function Ts(t){var n=new t.constructor(t.byteLength);return new Hn(n).set(new Hn(t)),n}function jd(t,n){var s=n?Ts(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.byteLength)}function Ud(t){var n=new t.constructor(t.source,ea.exec(t));return n.lastIndex=t.lastIndex,n}function Md(t){return en?rt(en.call(t)):{}}function wc(t,n){var s=n?Ts(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.length)}function _c(t,n){if(t!==n){var s=t!==r,c=t===null,l=t===t,f=Wt(t),d=n!==r,v=n===null,m=n===n,I=Wt(n);if(!v&&!I&&!f&&t>n||f&&d&&m&&!v&&!I||c&&d&&m||!s&&m||!l)return 1;if(!c&&!f&&!I&&t<n||I&&s&&l&&!c&&!f||v&&s&&l||!d&&l||!m)return-1}return 0}function Ld(t,n,s){for(var c=-1,l=t.criteria,f=n.criteria,d=l.length,v=s.length;++c<d;){var m=_c(l[c],f[c]);if(m){if(c>=v)return m;var I=s[c];return m*(I=="desc"?-1:1)}}return t.index-n.index}function bc(t,n,s,c){for(var l=-1,f=t.length,d=s.length,v=-1,m=n.length,I=wt(f-d,0),P=_(m+I),N=!c;++v<m;)P[v]=n[v];for(;++l<d;)(N||l<f)&&(P[s[l]]=t[l]);for(;I--;)P[v++]=t[l++];return P}function Ec(t,n,s,c){for(var l=-1,f=t.length,d=-1,v=s.length,m=-1,I=n.length,P=wt(f-v,0),N=_(P+I),x=!c;++l<P;)N[l]=t[l];for(var q=l;++m<I;)N[q+m]=n[m];for(;++d<v;)(x||l<f)&&(N[q+s[d]]=t[l++]);return N}function qt(t,n){var s=-1,c=t.length;for(n||(n=_(c));++s<c;)n[s]=t[s];return n}function ye(t,n,s,c){var l=!s;s||(s={});for(var f=-1,d=n.length;++f<d;){var v=n[f],m=c?c(s[v],t[v],v,s,t):r;m===r&&(m=t[v]),l?Se(s,v,m):rn(s,v,m)}return s}function kd(t,n){return ye(t,Ms(t),n)}function zd(t,n){return ye(t,$c(t),n)}function ii(t,n){return function(s,c){var l=z(s)?Wp:ud,f=n?n():{};return l(s,t,j(c,2),f)}}function Nr(t){return K(function(n,s){var c=-1,l=s.length,f=l>1?s[l-1]:r,d=l>2?s[2]:r;for(f=t.length>3&&typeof f=="function"?(l--,f):r,d&&Tt(s[0],s[1],d)&&(f=l<3?r:f,l=1),n=rt(n);++c<l;){var v=s[c];v&&t(n,v,c,f)}return n})}function Ic(t,n){return function(s,c){if(s==null)return s;if(!$t(s))return t(s,c);for(var l=s.length,f=n?l:-1,d=rt(s);(n?f--:++f<l)&&c(d[f],f,d)!==!1;);return s}}function Pc(t){return function(n,s,c){for(var l=-1,f=rt(n),d=c(n),v=d.length;v--;){var m=d[t?v:++l];if(s(f[m],m,f)===!1)break}return n}}function Vd(t,n,s){var c=n&F,l=cn(t);function f(){var d=this&&this!==Et&&this instanceof f?l:t;return d.apply(c?s:this,arguments)}return f}function Sc(t){return function(n){n=Z(n);var s=_r(n)?ce(n):r,c=s?s[0]:n.charAt(0),l=s?We(s,1).join(""):n.slice(1);return c[t]()+l}}function Rr(t){return function(n){return rs(Iu(Eu(n).replace(Tp,"")),t,"")}}function cn(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var s=Or(t.prototype),c=t.apply(s,n);return lt(c)?c:s}}function Hd(t,n,s){var c=cn(t);function l(){for(var f=arguments.length,d=_(f),v=f,m=Cr(l);v--;)d[v]=arguments[v];var I=f<3&&d[0]!==m&&d[f-1]!==m?[]:ke(d,m);if(f-=I.length,f<s)return xc(t,n,si,l.placeholder,r,d,I,r,r,s-f);var P=this&&this!==Et&&this instanceof l?c:t;return Vt(P,this,d)}return l}function Oc(t){return function(n,s,c){var l=rt(n);if(!$t(n)){var f=j(s,3);n=_t(n),s=function(v){return f(l[v],v,l)}}var d=t(n,s,c);return d>-1?l[f?n[d]:d]:r}}function Nc(t){return Ne(function(n){var s=n.length,c=s,l=Xt.prototype.thru;for(t&&n.reverse();c--;){var f=n[c];if(typeof f!="function")throw new Zt(h);if(l&&!d&&ui(f)=="wrapper")var d=new Xt([],!0)}for(c=d?c:s;++c<s;){f=n[c];var v=ui(f),m=v=="wrapper"?js(f):r;m&&ks(m[0])&&m[1]==(pt|et|at|Ct)&&!m[4].length&&m[9]==1?d=d[ui(m[0])].apply(d,m[3]):d=f.length==1&&ks(f)?d[v]():d.thru(f)}return function(){var I=arguments,P=I[0];if(d&&I.length==1&&z(P))return d.plant(P).value();for(var N=0,x=s?n[N].apply(this,I):P;++N<s;)x=n[N].call(this,x);return x}})}function si(t,n,s,c,l,f,d,v,m,I){var P=n&pt,N=n&F,x=n&Y,q=n&(et|J),M=n&je,H=x?r:cn(t);function L(){for(var W=arguments.length,G=_(W),Ft=W;Ft--;)G[Ft]=arguments[Ft];if(q)var At=Cr(L),Bt=tf(G,At);if(c&&(G=bc(G,c,l,q)),f&&(G=Ec(G,f,d,q)),W-=Bt,q&&W<I){var dt=ke(G,At);return xc(t,n,si,L.placeholder,s,G,dt,v,m,I-W)}var he=N?s:this,Te=x?he[t]:t;return W=G.length,v?G=ug(G,v):M&&W>1&&G.reverse(),P&&m<W&&(G.length=m),this&&this!==Et&&this instanceof L&&(Te=H||cn(Te)),Te.apply(he,G)}return L}function Rc(t,n){return function(s,c){return yd(s,t,n(c),{})}}function oi(t,n){return function(s,c){var l;if(s===r&&c===r)return n;if(s!==r&&(l=s),c!==r){if(l===r)return c;typeof s=="string"||typeof c=="string"?(s=Kt(s),c=Kt(c)):(s=fc(s),c=fc(c)),l=t(s,c)}return l}}function As(t){return Ne(function(n){return n=ct(n,Ht(j())),K(function(s){var c=this;return t(n,function(l){return Vt(l,c,s)})})})}function ai(t,n){n=n===r?" ":Kt(n);var s=n.length;if(s<2)return s?Ss(n,t):n;var c=Ss(n,Bn(t/br(n)));return _r(n)?We(ce(c),0,t).join(""):c.slice(0,t)}function Kd(t,n,s,c){var l=n&F,f=cn(t);function d(){for(var v=-1,m=arguments.length,I=-1,P=c.length,N=_(P+m),x=this&&this!==Et&&this instanceof d?f:t;++I<P;)N[I]=c[I];for(;m--;)N[I++]=arguments[++v];return Vt(x,l?s:this,N)}return d}function Cc(t){return function(n,s,c){return c&&typeof c!="number"&&Tt(n,s,c)&&(s=c=r),n=xe(n),s===r?(s=n,n=0):s=xe(s),c=c===r?n<s?1:-1:xe(c),Cd(n,s,c,t)}}function ci(t){return function(n,s){return typeof n=="string"&&typeof s=="string"||(n=ne(n),s=ne(s)),t(n,s)}}function xc(t,n,s,c,l,f,d,v,m,I){var P=n&et,N=P?d:r,x=P?r:d,q=P?f:r,M=P?r:f;n|=P?at:Rt,n&=~(P?Rt:at),n&yt||(n&=~(F|Y));var H=[t,n,l,q,N,M,x,v,m,I],L=s.apply(r,H);return ks(t)&&Vc(L,H),L.placeholder=c,Hc(L,t,n)}function Ds(t){var n=mt[t];return function(s,c){if(s=ne(s),c=c==null?0:St(V(c),292),c&&Ha(s)){var l=(Z(s)+"e").split("e"),f=n(l[0]+"e"+(+l[1]+c));return l=(Z(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return n(s)}}var Wd=Pr&&1/Un(new Pr([,-0]))[1]==Ze?function(t){return new Pr(t)}:eo;function Tc(t){return function(n){var s=Ot(n);return s==oe?us(n):s==ae?cf(n):Xp(n,t(n))}}function Oe(t,n,s,c,l,f,d,v){var m=n&Y;if(!m&&typeof t!="function")throw new Zt(h);var I=c?c.length:0;if(I||(n&=~(at|Rt),c=l=r),d=d===r?d:wt(V(d),0),v=v===r?v:V(v),I-=l?l.length:0,n&Rt){var P=c,N=l;c=l=r}var x=m?r:js(t),q=[t,n,s,c,l,P,N,f,d,v];if(x&&og(q,x),t=q[0],n=q[1],s=q[2],c=q[3],l=q[4],v=q[9]=q[9]===r?m?0:t.length:wt(q[9]-I,0),!v&&n&(et|J)&&(n&=~(et|J)),!n||n==F)var M=Vd(t,n,s);else n==et||n==J?M=Hd(t,n,v):(n==at||n==(F|at))&&!l.length?M=Kd(t,n,s,c):M=si.apply(r,q);var H=x?hc:Vc;return Hc(H(M,q),t,n)}function Ac(t,n,s,c){return t===r||le(t,Ir[s])&&!tt.call(c,s)?n:t}function Dc(t,n,s,c,l,f){return lt(t)&&lt(n)&&(f.set(n,t),ei(t,n,r,Dc,f),f.delete(n)),t}function Fd(t){return hn(t)?r:t}function qc(t,n,s,c,l,f){var d=s&D,v=t.length,m=n.length;if(v!=m&&!(d&&m>v))return!1;var I=f.get(t),P=f.get(n);if(I&&P)return I==n&&P==t;var N=-1,x=!0,q=s&A?new rr:r;for(f.set(t,n),f.set(n,t);++N<v;){var M=t[N],H=n[N];if(c)var L=d?c(H,M,N,n,t,f):c(M,H,N,t,n,f);if(L!==r){if(L)continue;x=!1;break}if(q){if(!ns(n,function(W,G){if(!Qr(q,G)&&(M===W||l(M,W,s,c,f)))return q.push(G)})){x=!1;break}}else if(!(M===H||l(M,H,s,c,f))){x=!1;break}}return f.delete(t),f.delete(n),x}function Bd(t,n,s,c,l,f,d){switch(s){case yr:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case Jr:return!(t.byteLength!=n.byteLength||!f(new Hn(t),new Hn(n)));case Hr:case Kr:case Wr:return le(+t,+n);case Cn:return t.name==n.name&&t.message==n.message;case Fr:case Br:return t==n+"";case oe:var v=us;case ae:var m=c&D;if(v||(v=Un),t.size!=n.size&&!m)return!1;var I=d.get(t);if(I)return I==n;c|=A,d.set(t,n);var P=qc(v(t),v(n),c,l,f,d);return d.delete(t),P;case Tn:if(en)return en.call(t)==en.call(n)}return!1}function Gd(t,n,s,c,l,f){var d=s&D,v=qs(t),m=v.length,I=qs(n),P=I.length;if(m!=P&&!d)return!1;for(var N=m;N--;){var x=v[N];if(!(d?x in n:tt.call(n,x)))return!1}var q=f.get(t),M=f.get(n);if(q&&M)return q==n&&M==t;var H=!0;f.set(t,n),f.set(n,t);for(var L=d;++N<m;){x=v[N];var W=t[x],G=n[x];if(c)var Ft=d?c(G,W,x,n,t,f):c(W,G,x,t,n,f);if(!(Ft===r?W===G||l(W,G,s,c,f):Ft)){H=!1;break}L||(L=x=="constructor")}if(H&&!L){var At=t.constructor,Bt=n.constructor;At!=Bt&&"constructor"in t&&"constructor"in n&&!(typeof At=="function"&&At instanceof At&&typeof Bt=="function"&&Bt instanceof Bt)&&(H=!1)}return f.delete(t),f.delete(n),H}function Ne(t){return Vs(kc(t,r,Jc),t+"")}function qs(t){return tc(t,_t,Ms)}function $s(t){return tc(t,jt,$c)}var js=Jn?function(t){return Jn.get(t)}:eo;function ui(t){for(var n=t.name+"",s=Sr[n],c=tt.call(Sr,n)?s.length:0;c--;){var l=s[c],f=l.func;if(f==null||f==t)return l.name}return n}function Cr(t){var n=tt.call(p,"placeholder")?p:t;return n.placeholder}function j(){var t=p.iteratee||Xs;return t=t===Xs?nc:t,arguments.length?t(arguments[0],arguments[1]):t}function li(t,n){var s=t.__data__;return rg(n)?s[typeof n=="string"?"string":"hash"]:s.map}function Us(t){for(var n=_t(t),s=n.length;s--;){var c=n[s],l=t[c];n[s]=[c,l,Mc(l)]}return n}function sr(t,n){var s=sf(t,n);return rc(s)?s:r}function Jd(t){var n=tt.call(t,tr),s=t[tr];try{t[tr]=r;var c=!0}catch{}var l=zn.call(t);return c&&(n?t[tr]=s:delete t[tr]),l}var Ms=hs?function(t){return t==null?[]:(t=rt(t),Me(hs(t),function(n){return za.call(t,n)}))}:ro,$c=hs?function(t){for(var n=[];t;)Le(n,Ms(t)),t=Kn(t);return n}:ro,Ot=xt;(ps&&Ot(new ps(new ArrayBuffer(1)))!=yr||Zr&&Ot(new Zr)!=oe||fs&&Ot(fs.resolve())!=Yo||Pr&&Ot(new Pr)!=ae||Xr&&Ot(new Xr)!=Gr)&&(Ot=function(t){var n=xt(t),s=n==Ee?t.constructor:r,c=s?or(s):"";if(c)switch(c){case Tf:return yr;case Af:return oe;case Df:return Yo;case qf:return ae;case $f:return Gr}return n});function Qd(t,n,s){for(var c=-1,l=s.length;++c<l;){var f=s[c],d=f.size;switch(f.type){case"drop":t+=d;break;case"dropRight":n-=d;break;case"take":n=St(n,t+d);break;case"takeRight":t=wt(t,n-d);break}}return{start:t,end:n}}function Yd(t){var n=t.match(rp);return n?n[1].split(np):[]}function jc(t,n,s){n=Ke(n,t);for(var c=-1,l=n.length,f=!1;++c<l;){var d=me(n[c]);if(!(f=t!=null&&s(t,d)))break;t=t[d]}return f||++c!=l?f:(l=t==null?0:t.length,!!l&&yi(l)&&Re(d,l)&&(z(t)||ar(t)))}function Zd(t){var n=t.length,s=new t.constructor(n);return n&&typeof t[0]=="string"&&tt.call(t,"index")&&(s.index=t.index,s.input=t.input),s}function Uc(t){return typeof t.constructor=="function"&&!un(t)?Or(Kn(t)):{}}function Xd(t,n,s){var c=t.constructor;switch(n){case Jr:return Ts(t);case Hr:case Kr:return new c(+t);case yr:return jd(t,s);case Ui:case Mi:case Li:case ki:case zi:case Vi:case Hi:case Ki:case Wi:return wc(t,s);case oe:return new c;case Wr:case Br:return new c(t);case Fr:return Ud(t);case ae:return new c;case Tn:return Md(t)}}function tg(t,n){var s=n.length;if(!s)return t;var c=s-1;return n[c]=(s>1?"& ":"")+n[c],n=n.join(s>2?", ":" "),t.replace(ep,`{
/* [wrapped with `+n+`] */
`)}function eg(t){return z(t)||ar(t)||!!(Va&&t&&t[Va])}function Re(t,n){var s=typeof t;return n=n??Ue,!!n&&(s=="number"||s!="symbol"&&pp.test(t))&&t>-1&&t%1==0&&t<n}function Tt(t,n,s){if(!lt(s))return!1;var c=typeof n;return(c=="number"?$t(s)&&Re(n,s.length):c=="string"&&n in s)?le(s[n],t):!1}function Ls(t,n){if(z(t))return!1;var s=typeof t;return s=="number"||s=="symbol"||s=="boolean"||t==null||Wt(t)?!0:Yh.test(t)||!Qh.test(t)||n!=null&&t in rt(n)}function rg(t){var n=typeof t;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null}function ks(t){var n=ui(t),s=p[n];if(typeof s!="function"||!(n in B.prototype))return!1;if(t===s)return!0;var c=js(s);return!!c&&t===c[0]}function ng(t){return!!Ma&&Ma in t}var ig=Ln?Ce:no;function un(t){var n=t&&t.constructor,s=typeof n=="function"&&n.prototype||Ir;return t===s}function Mc(t){return t===t&&!lt(t)}function Lc(t,n){return function(s){return s==null?!1:s[t]===n&&(n!==r||t in rt(s))}}function sg(t){var n=gi(t,function(c){return s.size===b&&s.clear(),c}),s=n.cache;return n}function og(t,n){var s=t[1],c=n[1],l=s|c,f=l<(F|Y|pt),d=c==pt&&s==et||c==pt&&s==Ct&&t[7].length<=n[8]||c==(pt|Ct)&&n[7].length<=n[8]&&s==et;if(!(f||d))return t;c&F&&(t[2]=n[2],l|=s&F?0:yt);var v=n[3];if(v){var m=t[3];t[3]=m?bc(m,v,n[4]):v,t[4]=m?ke(t[3],S):n[4]}return v=n[5],v&&(m=t[5],t[5]=m?Ec(m,v,n[6]):v,t[6]=m?ke(t[5],S):n[6]),v=n[7],v&&(t[7]=v),c&pt&&(t[8]=t[8]==null?n[8]:St(t[8],n[8])),t[9]==null&&(t[9]=n[9]),t[0]=n[0],t[1]=l,t}function ag(t){var n=[];if(t!=null)for(var s in rt(t))n.push(s);return n}function cg(t){return zn.call(t)}function kc(t,n,s){return n=wt(n===r?t.length-1:n,0),function(){for(var c=arguments,l=-1,f=wt(c.length-n,0),d=_(f);++l<f;)d[l]=c[n+l];l=-1;for(var v=_(n+1);++l<n;)v[l]=c[l];return v[n]=s(d),Vt(t,this,v)}}function zc(t,n){return n.length<2?t:ir(t,ee(n,0,-1))}function ug(t,n){for(var s=t.length,c=St(n.length,s),l=qt(t);c--;){var f=n[c];t[c]=Re(f,s)?l[f]:r}return t}function zs(t,n){if(!(n==="constructor"&&typeof t[n]=="function")&&n!="__proto__")return t[n]}var Vc=Kc(hc),ln=Pf||function(t,n){return Et.setTimeout(t,n)},Vs=Kc(Ad);function Hc(t,n,s){var c=n+"";return Vs(t,tg(c,lg(Yd(c),s)))}function Kc(t){var n=0,s=0;return function(){var c=Rf(),l=xh-(c-s);if(s=c,l>0){if(++n>=Ch)return arguments[0]}else n=0;return t.apply(r,arguments)}}function hi(t,n){var s=-1,c=t.length,l=c-1;for(n=n===r?c:n;++s<n;){var f=Ps(s,l),d=t[f];t[f]=t[s],t[s]=d}return t.length=n,t}var Wc=sg(function(t){var n=[];return t.charCodeAt(0)===46&&n.push(""),t.replace(Zh,function(s,c,l,f){n.push(l?f.replace(op,"$1"):c||s)}),n});function me(t){if(typeof t=="string"||Wt(t))return t;var n=t+"";return n=="0"&&1/t==-Ze?"-0":n}function or(t){if(t!=null){try{return kn.call(t)}catch{}try{return t+""}catch{}}return""}function lg(t,n){return Yt(jh,function(s){var c="_."+s[0];n&s[1]&&!$n(t,c)&&t.push(c)}),t.sort()}function Fc(t){if(t instanceof B)return t.clone();var n=new Xt(t.__wrapped__,t.__chain__);return n.__actions__=qt(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}function hg(t,n,s){(s?Tt(t,n,s):n===r)?n=1:n=wt(V(n),0);var c=t==null?0:t.length;if(!c||n<1)return[];for(var l=0,f=0,d=_(Bn(c/n));l<c;)d[f++]=ee(t,l,l+=n);return d}function pg(t){for(var n=-1,s=t==null?0:t.length,c=0,l=[];++n<s;){var f=t[n];f&&(l[c++]=f)}return l}function fg(){var t=arguments.length;if(!t)return[];for(var n=_(t-1),s=arguments[0],c=t;c--;)n[c-1]=arguments[c];return Le(z(s)?qt(s):[s],It(n,1))}var dg=K(function(t,n){return ft(t)?nn(t,It(n,1,ft,!0)):[]}),gg=K(function(t,n){var s=re(n);return ft(s)&&(s=r),ft(t)?nn(t,It(n,1,ft,!0),j(s,2)):[]}),vg=K(function(t,n){var s=re(n);return ft(s)&&(s=r),ft(t)?nn(t,It(n,1,ft,!0),r,s):[]});function yg(t,n,s){var c=t==null?0:t.length;return c?(n=s||n===r?1:V(n),ee(t,n<0?0:n,c)):[]}function mg(t,n,s){var c=t==null?0:t.length;return c?(n=s||n===r?1:V(n),n=c-n,ee(t,0,n<0?0:n)):[]}function wg(t,n){return t&&t.length?ni(t,j(n,3),!0,!0):[]}function _g(t,n){return t&&t.length?ni(t,j(n,3),!0):[]}function bg(t,n,s,c){var l=t==null?0:t.length;return l?(s&&typeof s!="number"&&Tt(t,n,s)&&(s=0,c=l),fd(t,n,s,c)):[]}function Bc(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var l=s==null?0:V(s);return l<0&&(l=wt(c+l,0)),jn(t,j(n,3),l)}function Gc(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var l=c-1;return s!==r&&(l=V(s),l=s<0?wt(c+l,0):St(l,c-1)),jn(t,j(n,3),l,!0)}function Jc(t){var n=t==null?0:t.length;return n?It(t,1):[]}function Eg(t){var n=t==null?0:t.length;return n?It(t,Ze):[]}function Ig(t,n){var s=t==null?0:t.length;return s?(n=n===r?1:V(n),It(t,n)):[]}function Pg(t){for(var n=-1,s=t==null?0:t.length,c={};++n<s;){var l=t[n];c[l[0]]=l[1]}return c}function Qc(t){return t&&t.length?t[0]:r}function Sg(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var l=s==null?0:V(s);return l<0&&(l=wt(c+l,0)),wr(t,n,l)}function Og(t){var n=t==null?0:t.length;return n?ee(t,0,-1):[]}var Ng=K(function(t){var n=ct(t,Cs);return n.length&&n[0]===t[0]?ws(n):[]}),Rg=K(function(t){var n=re(t),s=ct(t,Cs);return n===re(s)?n=r:s.pop(),s.length&&s[0]===t[0]?ws(s,j(n,2)):[]}),Cg=K(function(t){var n=re(t),s=ct(t,Cs);return n=typeof n=="function"?n:r,n&&s.pop(),s.length&&s[0]===t[0]?ws(s,r,n):[]});function xg(t,n){return t==null?"":Of.call(t,n)}function re(t){var n=t==null?0:t.length;return n?t[n-1]:r}function Tg(t,n,s){var c=t==null?0:t.length;if(!c)return-1;var l=c;return s!==r&&(l=V(s),l=l<0?wt(c+l,0):St(l,c-1)),n===n?lf(t,n,l):jn(t,xa,l,!0)}function Ag(t,n){return t&&t.length?ac(t,V(n)):r}var Dg=K(Yc);function Yc(t,n){return t&&t.length&&n&&n.length?Is(t,n):t}function qg(t,n,s){return t&&t.length&&n&&n.length?Is(t,n,j(s,2)):t}function $g(t,n,s){return t&&t.length&&n&&n.length?Is(t,n,r,s):t}var jg=Ne(function(t,n){var s=t==null?0:t.length,c=gs(t,n);return lc(t,ct(n,function(l){return Re(l,s)?+l:l}).sort(_c)),c});function Ug(t,n){var s=[];if(!(t&&t.length))return s;var c=-1,l=[],f=t.length;for(n=j(n,3);++c<f;){var d=t[c];n(d,c,t)&&(s.push(d),l.push(c))}return lc(t,l),s}function Hs(t){return t==null?t:xf.call(t)}function Mg(t,n,s){var c=t==null?0:t.length;return c?(s&&typeof s!="number"&&Tt(t,n,s)?(n=0,s=c):(n=n==null?0:V(n),s=s===r?c:V(s)),ee(t,n,s)):[]}function Lg(t,n){return ri(t,n)}function kg(t,n,s){return Os(t,n,j(s,2))}function zg(t,n){var s=t==null?0:t.length;if(s){var c=ri(t,n);if(c<s&&le(t[c],n))return c}return-1}function Vg(t,n){return ri(t,n,!0)}function Hg(t,n,s){return Os(t,n,j(s,2),!0)}function Kg(t,n){var s=t==null?0:t.length;if(s){var c=ri(t,n,!0)-1;if(le(t[c],n))return c}return-1}function Wg(t){return t&&t.length?pc(t):[]}function Fg(t,n){return t&&t.length?pc(t,j(n,2)):[]}function Bg(t){var n=t==null?0:t.length;return n?ee(t,1,n):[]}function Gg(t,n,s){return t&&t.length?(n=s||n===r?1:V(n),ee(t,0,n<0?0:n)):[]}function Jg(t,n,s){var c=t==null?0:t.length;return c?(n=s||n===r?1:V(n),n=c-n,ee(t,n<0?0:n,c)):[]}function Qg(t,n){return t&&t.length?ni(t,j(n,3),!1,!0):[]}function Yg(t,n){return t&&t.length?ni(t,j(n,3)):[]}var Zg=K(function(t){return He(It(t,1,ft,!0))}),Xg=K(function(t){var n=re(t);return ft(n)&&(n=r),He(It(t,1,ft,!0),j(n,2))}),tv=K(function(t){var n=re(t);return n=typeof n=="function"?n:r,He(It(t,1,ft,!0),r,n)});function ev(t){return t&&t.length?He(t):[]}function rv(t,n){return t&&t.length?He(t,j(n,2)):[]}function nv(t,n){return n=typeof n=="function"?n:r,t&&t.length?He(t,r,n):[]}function Ks(t){if(!(t&&t.length))return[];var n=0;return t=Me(t,function(s){if(ft(s))return n=wt(s.length,n),!0}),as(n,function(s){return ct(t,is(s))})}function Zc(t,n){if(!(t&&t.length))return[];var s=Ks(t);return n==null?s:ct(s,function(c){return Vt(n,r,c)})}var iv=K(function(t,n){return ft(t)?nn(t,n):[]}),sv=K(function(t){return Rs(Me(t,ft))}),ov=K(function(t){var n=re(t);return ft(n)&&(n=r),Rs(Me(t,ft),j(n,2))}),av=K(function(t){var n=re(t);return n=typeof n=="function"?n:r,Rs(Me(t,ft),r,n)}),cv=K(Ks);function uv(t,n){return vc(t||[],n||[],rn)}function lv(t,n){return vc(t||[],n||[],an)}var hv=K(function(t){var n=t.length,s=n>1?t[n-1]:r;return s=typeof s=="function"?(t.pop(),s):r,Zc(t,s)});function Xc(t){var n=p(t);return n.__chain__=!0,n}function pv(t,n){return n(t),t}function pi(t,n){return n(t)}var fv=Ne(function(t){var n=t.length,s=n?t[0]:0,c=this.__wrapped__,l=function(f){return gs(f,t)};return n>1||this.__actions__.length||!(c instanceof B)||!Re(s)?this.thru(l):(c=c.slice(s,+s+(n?1:0)),c.__actions__.push({func:pi,args:[l],thisArg:r}),new Xt(c,this.__chain__).thru(function(f){return n&&!f.length&&f.push(r),f}))});function dv(){return Xc(this)}function gv(){return new Xt(this.value(),this.__chain__)}function vv(){this.__values__===r&&(this.__values__=fu(this.value()));var t=this.__index__>=this.__values__.length,n=t?r:this.__values__[this.__index__++];return{done:t,value:n}}function yv(){return this}function mv(t){for(var n,s=this;s instanceof Yn;){var c=Fc(s);c.__index__=0,c.__values__=r,n?l.__wrapped__=c:n=c;var l=c;s=s.__wrapped__}return l.__wrapped__=t,n}function wv(){var t=this.__wrapped__;if(t instanceof B){var n=t;return this.__actions__.length&&(n=new B(this)),n=n.reverse(),n.__actions__.push({func:pi,args:[Hs],thisArg:r}),new Xt(n,this.__chain__)}return this.thru(Hs)}function _v(){return gc(this.__wrapped__,this.__actions__)}var bv=ii(function(t,n,s){tt.call(t,s)?++t[s]:Se(t,s,1)});function Ev(t,n,s){var c=z(t)?Ra:pd;return s&&Tt(t,n,s)&&(n=r),c(t,j(n,3))}function Iv(t,n){var s=z(t)?Me:Za;return s(t,j(n,3))}var Pv=Oc(Bc),Sv=Oc(Gc);function Ov(t,n){return It(fi(t,n),1)}function Nv(t,n){return It(fi(t,n),Ze)}function Rv(t,n,s){return s=s===r?1:V(s),It(fi(t,n),s)}function tu(t,n){var s=z(t)?Yt:Ve;return s(t,j(n,3))}function eu(t,n){var s=z(t)?Fp:Ya;return s(t,j(n,3))}var Cv=ii(function(t,n,s){tt.call(t,s)?t[s].push(n):Se(t,s,[n])});function xv(t,n,s,c){t=$t(t)?t:Tr(t),s=s&&!c?V(s):0;var l=t.length;return s<0&&(s=wt(l+s,0)),mi(t)?s<=l&&t.indexOf(n,s)>-1:!!l&&wr(t,n,s)>-1}var Tv=K(function(t,n,s){var c=-1,l=typeof n=="function",f=$t(t)?_(t.length):[];return Ve(t,function(d){f[++c]=l?Vt(n,d,s):sn(d,n,s)}),f}),Av=ii(function(t,n,s){Se(t,s,n)});function fi(t,n){var s=z(t)?ct:ic;return s(t,j(n,3))}function Dv(t,n,s,c){return t==null?[]:(z(n)||(n=n==null?[]:[n]),s=c?r:s,z(s)||(s=s==null?[]:[s]),cc(t,n,s))}var qv=ii(function(t,n,s){t[s?0:1].push(n)},function(){return[[],[]]});function $v(t,n,s){var c=z(t)?rs:Aa,l=arguments.length<3;return c(t,j(n,4),s,l,Ve)}function jv(t,n,s){var c=z(t)?Bp:Aa,l=arguments.length<3;return c(t,j(n,4),s,l,Ya)}function Uv(t,n){var s=z(t)?Me:Za;return s(t,vi(j(n,3)))}function Mv(t){var n=z(t)?Ba:xd;return n(t)}function Lv(t,n,s){(s?Tt(t,n,s):n===r)?n=1:n=V(n);var c=z(t)?ad:Td;return c(t,n)}function kv(t){var n=z(t)?cd:Dd;return n(t)}function zv(t){if(t==null)return 0;if($t(t))return mi(t)?br(t):t.length;var n=Ot(t);return n==oe||n==ae?t.size:bs(t).length}function Vv(t,n,s){var c=z(t)?ns:qd;return s&&Tt(t,n,s)&&(n=r),c(t,j(n,3))}var Hv=K(function(t,n){if(t==null)return[];var s=n.length;return s>1&&Tt(t,n[0],n[1])?n=[]:s>2&&Tt(n[0],n[1],n[2])&&(n=[n[0]]),cc(t,It(n,1),[])}),di=If||function(){return Et.Date.now()};function Kv(t,n){if(typeof n!="function")throw new Zt(h);return t=V(t),function(){if(--t<1)return n.apply(this,arguments)}}function ru(t,n,s){return n=s?r:n,n=t&&n==null?t.length:n,Oe(t,pt,r,r,r,r,n)}function nu(t,n){var s;if(typeof n!="function")throw new Zt(h);return t=V(t),function(){return--t>0&&(s=n.apply(this,arguments)),t<=1&&(n=r),s}}var Ws=K(function(t,n,s){var c=F;if(s.length){var l=ke(s,Cr(Ws));c|=at}return Oe(t,c,n,s,l)}),iu=K(function(t,n,s){var c=F|Y;if(s.length){var l=ke(s,Cr(iu));c|=at}return Oe(n,c,t,s,l)});function su(t,n,s){n=s?r:n;var c=Oe(t,et,r,r,r,r,r,n);return c.placeholder=su.placeholder,c}function ou(t,n,s){n=s?r:n;var c=Oe(t,J,r,r,r,r,r,n);return c.placeholder=ou.placeholder,c}function au(t,n,s){var c,l,f,d,v,m,I=0,P=!1,N=!1,x=!0;if(typeof t!="function")throw new Zt(h);n=ne(n)||0,lt(s)&&(P=!!s.leading,N="maxWait"in s,f=N?wt(ne(s.maxWait)||0,n):f,x="trailing"in s?!!s.trailing:x);function q(dt){var he=c,Te=l;return c=l=r,I=dt,d=t.apply(Te,he),d}function M(dt){return I=dt,v=ln(W,n),P?q(dt):d}function H(dt){var he=dt-m,Te=dt-I,Ou=n-he;return N?St(Ou,f-Te):Ou}function L(dt){var he=dt-m,Te=dt-I;return m===r||he>=n||he<0||N&&Te>=f}function W(){var dt=di();if(L(dt))return G(dt);v=ln(W,H(dt))}function G(dt){return v=r,x&&c?q(dt):(c=l=r,d)}function Ft(){v!==r&&yc(v),I=0,c=m=l=v=r}function At(){return v===r?d:G(di())}function Bt(){var dt=di(),he=L(dt);if(c=arguments,l=this,m=dt,he){if(v===r)return M(m);if(N)return yc(v),v=ln(W,n),q(m)}return v===r&&(v=ln(W,n)),d}return Bt.cancel=Ft,Bt.flush=At,Bt}var Wv=K(function(t,n){return Qa(t,1,n)}),Fv=K(function(t,n,s){return Qa(t,ne(n)||0,s)});function Bv(t){return Oe(t,je)}function gi(t,n){if(typeof t!="function"||n!=null&&typeof n!="function")throw new Zt(h);var s=function(){var c=arguments,l=n?n.apply(this,c):c[0],f=s.cache;if(f.has(l))return f.get(l);var d=t.apply(this,c);return s.cache=f.set(l,d)||f,d};return s.cache=new(gi.Cache||Pe),s}gi.Cache=Pe;function vi(t){if(typeof t!="function")throw new Zt(h);return function(){var n=arguments;switch(n.length){case 0:return!t.call(this);case 1:return!t.call(this,n[0]);case 2:return!t.call(this,n[0],n[1]);case 3:return!t.call(this,n[0],n[1],n[2])}return!t.apply(this,n)}}function Gv(t){return nu(2,t)}var Jv=$d(function(t,n){n=n.length==1&&z(n[0])?ct(n[0],Ht(j())):ct(It(n,1),Ht(j()));var s=n.length;return K(function(c){for(var l=-1,f=St(c.length,s);++l<f;)c[l]=n[l].call(this,c[l]);return Vt(t,this,c)})}),Fs=K(function(t,n){var s=ke(n,Cr(Fs));return Oe(t,at,r,n,s)}),cu=K(function(t,n){var s=ke(n,Cr(cu));return Oe(t,Rt,r,n,s)}),Qv=Ne(function(t,n){return Oe(t,Ct,r,r,r,n)});function Yv(t,n){if(typeof t!="function")throw new Zt(h);return n=n===r?n:V(n),K(t,n)}function Zv(t,n){if(typeof t!="function")throw new Zt(h);return n=n==null?0:wt(V(n),0),K(function(s){var c=s[n],l=We(s,0,n);return c&&Le(l,c),Vt(t,this,l)})}function Xv(t,n,s){var c=!0,l=!0;if(typeof t!="function")throw new Zt(h);return lt(s)&&(c="leading"in s?!!s.leading:c,l="trailing"in s?!!s.trailing:l),au(t,n,{leading:c,maxWait:n,trailing:l})}function ty(t){return ru(t,1)}function ey(t,n){return Fs(xs(n),t)}function ry(){if(!arguments.length)return[];var t=arguments[0];return z(t)?t:[t]}function ny(t){return te(t,U)}function iy(t,n){return n=typeof n=="function"?n:r,te(t,U,n)}function sy(t){return te(t,O|U)}function oy(t,n){return n=typeof n=="function"?n:r,te(t,O|U,n)}function ay(t,n){return n==null||Ja(t,n,_t(n))}function le(t,n){return t===n||t!==t&&n!==n}var cy=ci(ms),uy=ci(function(t,n){return t>=n}),ar=ec(function(){return arguments}())?ec:function(t){return ht(t)&&tt.call(t,"callee")&&!za.call(t,"callee")},z=_.isArray,ly=Ea?Ht(Ea):md;function $t(t){return t!=null&&yi(t.length)&&!Ce(t)}function ft(t){return ht(t)&&$t(t)}function hy(t){return t===!0||t===!1||ht(t)&&xt(t)==Hr}var Fe=Sf||no,py=Ia?Ht(Ia):wd;function fy(t){return ht(t)&&t.nodeType===1&&!hn(t)}function dy(t){if(t==null)return!0;if($t(t)&&(z(t)||typeof t=="string"||typeof t.splice=="function"||Fe(t)||xr(t)||ar(t)))return!t.length;var n=Ot(t);if(n==oe||n==ae)return!t.size;if(un(t))return!bs(t).length;for(var s in t)if(tt.call(t,s))return!1;return!0}function gy(t,n){return on(t,n)}function vy(t,n,s){s=typeof s=="function"?s:r;var c=s?s(t,n):r;return c===r?on(t,n,r,s):!!c}function Bs(t){if(!ht(t))return!1;var n=xt(t);return n==Cn||n==Mh||typeof t.message=="string"&&typeof t.name=="string"&&!hn(t)}function yy(t){return typeof t=="number"&&Ha(t)}function Ce(t){if(!lt(t))return!1;var n=xt(t);return n==xn||n==Qo||n==Uh||n==kh}function uu(t){return typeof t=="number"&&t==V(t)}function yi(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ue}function lt(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}function ht(t){return t!=null&&typeof t=="object"}var lu=Pa?Ht(Pa):bd;function my(t,n){return t===n||_s(t,n,Us(n))}function wy(t,n,s){return s=typeof s=="function"?s:r,_s(t,n,Us(n),s)}function _y(t){return hu(t)&&t!=+t}function by(t){if(ig(t))throw new k(u);return rc(t)}function Ey(t){return t===null}function Iy(t){return t==null}function hu(t){return typeof t=="number"||ht(t)&&xt(t)==Wr}function hn(t){if(!ht(t)||xt(t)!=Ee)return!1;var n=Kn(t);if(n===null)return!0;var s=tt.call(n,"constructor")&&n.constructor;return typeof s=="function"&&s instanceof s&&kn.call(s)==wf}var Gs=Sa?Ht(Sa):Ed;function Py(t){return uu(t)&&t>=-Ue&&t<=Ue}var pu=Oa?Ht(Oa):Id;function mi(t){return typeof t=="string"||!z(t)&&ht(t)&&xt(t)==Br}function Wt(t){return typeof t=="symbol"||ht(t)&&xt(t)==Tn}var xr=Na?Ht(Na):Pd;function Sy(t){return t===r}function Oy(t){return ht(t)&&Ot(t)==Gr}function Ny(t){return ht(t)&&xt(t)==Vh}var Ry=ci(Es),Cy=ci(function(t,n){return t<=n});function fu(t){if(!t)return[];if($t(t))return mi(t)?ce(t):qt(t);if(Yr&&t[Yr])return af(t[Yr]());var n=Ot(t),s=n==oe?us:n==ae?Un:Tr;return s(t)}function xe(t){if(!t)return t===0?t:0;if(t=ne(t),t===Ze||t===-Ze){var n=t<0?-1:1;return n*Dh}return t===t?t:0}function V(t){var n=xe(t),s=n%1;return n===n?s?n-s:n:0}function du(t){return t?nr(V(t),0,ge):0}function ne(t){if(typeof t=="number")return t;if(Wt(t))return Nn;if(lt(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=lt(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=Da(t);var s=up.test(t);return s||hp.test(t)?Hp(t.slice(2),s?2:8):cp.test(t)?Nn:+t}function gu(t){return ye(t,jt(t))}function xy(t){return t?nr(V(t),-Ue,Ue):t===0?t:0}function Z(t){return t==null?"":Kt(t)}var Ty=Nr(function(t,n){if(un(n)||$t(n)){ye(n,_t(n),t);return}for(var s in n)tt.call(n,s)&&rn(t,s,n[s])}),vu=Nr(function(t,n){ye(n,jt(n),t)}),wi=Nr(function(t,n,s,c){ye(n,jt(n),t,c)}),Ay=Nr(function(t,n,s,c){ye(n,_t(n),t,c)}),Dy=Ne(gs);function qy(t,n){var s=Or(t);return n==null?s:Ga(s,n)}var $y=K(function(t,n){t=rt(t);var s=-1,c=n.length,l=c>2?n[2]:r;for(l&&Tt(n[0],n[1],l)&&(c=1);++s<c;)for(var f=n[s],d=jt(f),v=-1,m=d.length;++v<m;){var I=d[v],P=t[I];(P===r||le(P,Ir[I])&&!tt.call(t,I))&&(t[I]=f[I])}return t}),jy=K(function(t){return t.push(r,Dc),Vt(yu,r,t)});function Uy(t,n){return Ca(t,j(n,3),ve)}function My(t,n){return Ca(t,j(n,3),ys)}function Ly(t,n){return t==null?t:vs(t,j(n,3),jt)}function ky(t,n){return t==null?t:Xa(t,j(n,3),jt)}function zy(t,n){return t&&ve(t,j(n,3))}function Vy(t,n){return t&&ys(t,j(n,3))}function Hy(t){return t==null?[]:ti(t,_t(t))}function Ky(t){return t==null?[]:ti(t,jt(t))}function Js(t,n,s){var c=t==null?r:ir(t,n);return c===r?s:c}function Wy(t,n){return t!=null&&jc(t,n,dd)}function Qs(t,n){return t!=null&&jc(t,n,gd)}var Fy=Rc(function(t,n,s){n!=null&&typeof n.toString!="function"&&(n=zn.call(n)),t[n]=s},Zs(Ut)),By=Rc(function(t,n,s){n!=null&&typeof n.toString!="function"&&(n=zn.call(n)),tt.call(t,n)?t[n].push(s):t[n]=[s]},j),Gy=K(sn);function _t(t){return $t(t)?Fa(t):bs(t)}function jt(t){return $t(t)?Fa(t,!0):Sd(t)}function Jy(t,n){var s={};return n=j(n,3),ve(t,function(c,l,f){Se(s,n(c,l,f),c)}),s}function Qy(t,n){var s={};return n=j(n,3),ve(t,function(c,l,f){Se(s,l,n(c,l,f))}),s}var Yy=Nr(function(t,n,s){ei(t,n,s)}),yu=Nr(function(t,n,s,c){ei(t,n,s,c)}),Zy=Ne(function(t,n){var s={};if(t==null)return s;var c=!1;n=ct(n,function(f){return f=Ke(f,t),c||(c=f.length>1),f}),ye(t,$s(t),s),c&&(s=te(s,O|R|U,Fd));for(var l=n.length;l--;)Ns(s,n[l]);return s});function Xy(t,n){return mu(t,vi(j(n)))}var tm=Ne(function(t,n){return t==null?{}:Nd(t,n)});function mu(t,n){if(t==null)return{};var s=ct($s(t),function(c){return[c]});return n=j(n),uc(t,s,function(c,l){return n(c,l[0])})}function em(t,n,s){n=Ke(n,t);var c=-1,l=n.length;for(l||(l=1,t=r);++c<l;){var f=t==null?r:t[me(n[c])];f===r&&(c=l,f=s),t=Ce(f)?f.call(t):f}return t}function rm(t,n,s){return t==null?t:an(t,n,s)}function nm(t,n,s,c){return c=typeof c=="function"?c:r,t==null?t:an(t,n,s,c)}var wu=Tc(_t),_u=Tc(jt);function im(t,n,s){var c=z(t),l=c||Fe(t)||xr(t);if(n=j(n,4),s==null){var f=t&&t.constructor;l?s=c?new f:[]:lt(t)?s=Ce(f)?Or(Kn(t)):{}:s={}}return(l?Yt:ve)(t,function(d,v,m){return n(s,d,v,m)}),s}function sm(t,n){return t==null?!0:Ns(t,n)}function om(t,n,s){return t==null?t:dc(t,n,xs(s))}function am(t,n,s,c){return c=typeof c=="function"?c:r,t==null?t:dc(t,n,xs(s),c)}function Tr(t){return t==null?[]:cs(t,_t(t))}function cm(t){return t==null?[]:cs(t,jt(t))}function um(t,n,s){return s===r&&(s=n,n=r),s!==r&&(s=ne(s),s=s===s?s:0),n!==r&&(n=ne(n),n=n===n?n:0),nr(ne(t),n,s)}function lm(t,n,s){return n=xe(n),s===r?(s=n,n=0):s=xe(s),t=ne(t),vd(t,n,s)}function hm(t,n,s){if(s&&typeof s!="boolean"&&Tt(t,n,s)&&(n=s=r),s===r&&(typeof n=="boolean"?(s=n,n=r):typeof t=="boolean"&&(s=t,t=r)),t===r&&n===r?(t=0,n=1):(t=xe(t),n===r?(n=t,t=0):n=xe(n)),t>n){var c=t;t=n,n=c}if(s||t%1||n%1){var l=Ka();return St(t+l*(n-t+Vp("1e-"+((l+"").length-1))),n)}return Ps(t,n)}var pm=Rr(function(t,n,s){return n=n.toLowerCase(),t+(s?bu(n):n)});function bu(t){return Ys(Z(t).toLowerCase())}function Eu(t){return t=Z(t),t&&t.replace(fp,ef).replace(Ap,"")}function fm(t,n,s){t=Z(t),n=Kt(n);var c=t.length;s=s===r?c:nr(V(s),0,c);var l=s;return s-=n.length,s>=0&&t.slice(s,l)==n}function dm(t){return t=Z(t),t&&Bh.test(t)?t.replace(Xo,rf):t}function gm(t){return t=Z(t),t&&Xh.test(t)?t.replace(Fi,"\\$&"):t}var vm=Rr(function(t,n,s){return t+(s?"-":"")+n.toLowerCase()}),ym=Rr(function(t,n,s){return t+(s?" ":"")+n.toLowerCase()}),mm=Sc("toLowerCase");function wm(t,n,s){t=Z(t),n=V(n);var c=n?br(t):0;if(!n||c>=n)return t;var l=(n-c)/2;return ai(Gn(l),s)+t+ai(Bn(l),s)}function _m(t,n,s){t=Z(t),n=V(n);var c=n?br(t):0;return n&&c<n?t+ai(n-c,s):t}function bm(t,n,s){t=Z(t),n=V(n);var c=n?br(t):0;return n&&c<n?ai(n-c,s)+t:t}function Em(t,n,s){return s||n==null?n=0:n&&(n=+n),Cf(Z(t).replace(Bi,""),n||0)}function Im(t,n,s){return(s?Tt(t,n,s):n===r)?n=1:n=V(n),Ss(Z(t),n)}function Pm(){var t=arguments,n=Z(t[0]);return t.length<3?n:n.replace(t[1],t[2])}var Sm=Rr(function(t,n,s){return t+(s?"_":"")+n.toLowerCase()});function Om(t,n,s){return s&&typeof s!="number"&&Tt(t,n,s)&&(n=s=r),s=s===r?ge:s>>>0,s?(t=Z(t),t&&(typeof n=="string"||n!=null&&!Gs(n))&&(n=Kt(n),!n&&_r(t))?We(ce(t),0,s):t.split(n,s)):[]}var Nm=Rr(function(t,n,s){return t+(s?" ":"")+Ys(n)});function Rm(t,n,s){return t=Z(t),s=s==null?0:nr(V(s),0,t.length),n=Kt(n),t.slice(s,s+n.length)==n}function Cm(t,n,s){var c=p.templateSettings;s&&Tt(t,n,s)&&(n=r),t=Z(t),n=wi({},n,c,Ac);var l=wi({},n.imports,c.imports,Ac),f=_t(l),d=cs(l,f),v,m,I=0,P=n.interpolate||An,N="__p += '",x=ls((n.escape||An).source+"|"+P.source+"|"+(P===ta?ap:An).source+"|"+(n.evaluate||An).source+"|$","g"),q="//# sourceURL="+(tt.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Up+"]")+`
`;t.replace(x,function(L,W,G,Ft,At,Bt){return G||(G=Ft),N+=t.slice(I,Bt).replace(dp,nf),W&&(v=!0,N+=`' +
__e(`+W+`) +
'`),At&&(m=!0,N+=`';
`+At+`;
__p += '`),G&&(N+=`' +
((__t = (`+G+`)) == null ? '' : __t) +
'`),I=Bt+L.length,L}),N+=`';
`;var M=tt.call(n,"variable")&&n.variable;if(!M)N=`with (obj) {
`+N+`
}
`;else if(sp.test(M))throw new k(g);N=(m?N.replace(Hh,""):N).replace(Kh,"$1").replace(Wh,"$1;"),N="function("+(M||"obj")+`) {
`+(M?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(v?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+N+`return __p
}`;var H=Pu(function(){return Q(f,q+"return "+N).apply(r,d)});if(H.source=N,Bs(H))throw H;return H}function xm(t){return Z(t).toLowerCase()}function Tm(t){return Z(t).toUpperCase()}function Am(t,n,s){if(t=Z(t),t&&(s||n===r))return Da(t);if(!t||!(n=Kt(n)))return t;var c=ce(t),l=ce(n),f=qa(c,l),d=$a(c,l)+1;return We(c,f,d).join("")}function Dm(t,n,s){if(t=Z(t),t&&(s||n===r))return t.slice(0,Ua(t)+1);if(!t||!(n=Kt(n)))return t;var c=ce(t),l=$a(c,ce(n))+1;return We(c,0,l).join("")}function qm(t,n,s){if(t=Z(t),t&&(s||n===r))return t.replace(Bi,"");if(!t||!(n=Kt(n)))return t;var c=ce(t),l=qa(c,ce(n));return We(c,l).join("")}function $m(t,n){var s=Nh,c=Rh;if(lt(n)){var l="separator"in n?n.separator:l;s="length"in n?V(n.length):s,c="omission"in n?Kt(n.omission):c}t=Z(t);var f=t.length;if(_r(t)){var d=ce(t);f=d.length}if(s>=f)return t;var v=s-br(c);if(v<1)return c;var m=d?We(d,0,v).join(""):t.slice(0,v);if(l===r)return m+c;if(d&&(v+=m.length-v),Gs(l)){if(t.slice(v).search(l)){var I,P=m;for(l.global||(l=ls(l.source,Z(ea.exec(l))+"g")),l.lastIndex=0;I=l.exec(P);)var N=I.index;m=m.slice(0,N===r?v:N)}}else if(t.indexOf(Kt(l),v)!=v){var x=m.lastIndexOf(l);x>-1&&(m=m.slice(0,x))}return m+c}function jm(t){return t=Z(t),t&&Fh.test(t)?t.replace(Zo,hf):t}var Um=Rr(function(t,n,s){return t+(s?" ":"")+n.toUpperCase()}),Ys=Sc("toUpperCase");function Iu(t,n,s){return t=Z(t),n=s?r:n,n===r?of(t)?df(t):Qp(t):t.match(n)||[]}var Pu=K(function(t,n){try{return Vt(t,r,n)}catch(s){return Bs(s)?s:new k(s)}}),Mm=Ne(function(t,n){return Yt(n,function(s){s=me(s),Se(t,s,Ws(t[s],t))}),t});function Lm(t){var n=t==null?0:t.length,s=j();return t=n?ct(t,function(c){if(typeof c[1]!="function")throw new Zt(h);return[s(c[0]),c[1]]}):[],K(function(c){for(var l=-1;++l<n;){var f=t[l];if(Vt(f[0],this,c))return Vt(f[1],this,c)}})}function km(t){return hd(te(t,O))}function Zs(t){return function(){return t}}function zm(t,n){return t==null||t!==t?n:t}var Vm=Nc(),Hm=Nc(!0);function Ut(t){return t}function Xs(t){return nc(typeof t=="function"?t:te(t,O))}function Km(t){return sc(te(t,O))}function Wm(t,n){return oc(t,te(n,O))}var Fm=K(function(t,n){return function(s){return sn(s,t,n)}}),Bm=K(function(t,n){return function(s){return sn(t,s,n)}});function to(t,n,s){var c=_t(n),l=ti(n,c);s==null&&!(lt(n)&&(l.length||!c.length))&&(s=n,n=t,t=this,l=ti(n,_t(n)));var f=!(lt(s)&&"chain"in s)||!!s.chain,d=Ce(t);return Yt(l,function(v){var m=n[v];t[v]=m,d&&(t.prototype[v]=function(){var I=this.__chain__;if(f||I){var P=t(this.__wrapped__),N=P.__actions__=qt(this.__actions__);return N.push({func:m,args:arguments,thisArg:t}),P.__chain__=I,P}return m.apply(t,Le([this.value()],arguments))})}),t}function Gm(){return Et._===this&&(Et._=_f),this}function eo(){}function Jm(t){return t=V(t),K(function(n){return ac(n,t)})}var Qm=As(ct),Ym=As(Ra),Zm=As(ns);function Su(t){return Ls(t)?is(me(t)):Rd(t)}function Xm(t){return function(n){return t==null?r:ir(t,n)}}var tw=Cc(),ew=Cc(!0);function ro(){return[]}function no(){return!1}function rw(){return{}}function nw(){return""}function iw(){return!0}function sw(t,n){if(t=V(t),t<1||t>Ue)return[];var s=ge,c=St(t,ge);n=j(n),t-=ge;for(var l=as(c,n);++s<t;)n(s);return l}function ow(t){return z(t)?ct(t,me):Wt(t)?[t]:qt(Wc(Z(t)))}function aw(t){var n=++mf;return Z(t)+n}var cw=oi(function(t,n){return t+n},0),uw=Ds("ceil"),lw=oi(function(t,n){return t/n},1),hw=Ds("floor");function pw(t){return t&&t.length?Xn(t,Ut,ms):r}function fw(t,n){return t&&t.length?Xn(t,j(n,2),ms):r}function dw(t){return Ta(t,Ut)}function gw(t,n){return Ta(t,j(n,2))}function vw(t){return t&&t.length?Xn(t,Ut,Es):r}function yw(t,n){return t&&t.length?Xn(t,j(n,2),Es):r}var mw=oi(function(t,n){return t*n},1),ww=Ds("round"),_w=oi(function(t,n){return t-n},0);function bw(t){return t&&t.length?os(t,Ut):0}function Ew(t,n){return t&&t.length?os(t,j(n,2)):0}return p.after=Kv,p.ary=ru,p.assign=Ty,p.assignIn=vu,p.assignInWith=wi,p.assignWith=Ay,p.at=Dy,p.before=nu,p.bind=Ws,p.bindAll=Mm,p.bindKey=iu,p.castArray=ry,p.chain=Xc,p.chunk=hg,p.compact=pg,p.concat=fg,p.cond=Lm,p.conforms=km,p.constant=Zs,p.countBy=bv,p.create=qy,p.curry=su,p.curryRight=ou,p.debounce=au,p.defaults=$y,p.defaultsDeep=jy,p.defer=Wv,p.delay=Fv,p.difference=dg,p.differenceBy=gg,p.differenceWith=vg,p.drop=yg,p.dropRight=mg,p.dropRightWhile=wg,p.dropWhile=_g,p.fill=bg,p.filter=Iv,p.flatMap=Ov,p.flatMapDeep=Nv,p.flatMapDepth=Rv,p.flatten=Jc,p.flattenDeep=Eg,p.flattenDepth=Ig,p.flip=Bv,p.flow=Vm,p.flowRight=Hm,p.fromPairs=Pg,p.functions=Hy,p.functionsIn=Ky,p.groupBy=Cv,p.initial=Og,p.intersection=Ng,p.intersectionBy=Rg,p.intersectionWith=Cg,p.invert=Fy,p.invertBy=By,p.invokeMap=Tv,p.iteratee=Xs,p.keyBy=Av,p.keys=_t,p.keysIn=jt,p.map=fi,p.mapKeys=Jy,p.mapValues=Qy,p.matches=Km,p.matchesProperty=Wm,p.memoize=gi,p.merge=Yy,p.mergeWith=yu,p.method=Fm,p.methodOf=Bm,p.mixin=to,p.negate=vi,p.nthArg=Jm,p.omit=Zy,p.omitBy=Xy,p.once=Gv,p.orderBy=Dv,p.over=Qm,p.overArgs=Jv,p.overEvery=Ym,p.overSome=Zm,p.partial=Fs,p.partialRight=cu,p.partition=qv,p.pick=tm,p.pickBy=mu,p.property=Su,p.propertyOf=Xm,p.pull=Dg,p.pullAll=Yc,p.pullAllBy=qg,p.pullAllWith=$g,p.pullAt=jg,p.range=tw,p.rangeRight=ew,p.rearg=Qv,p.reject=Uv,p.remove=Ug,p.rest=Yv,p.reverse=Hs,p.sampleSize=Lv,p.set=rm,p.setWith=nm,p.shuffle=kv,p.slice=Mg,p.sortBy=Hv,p.sortedUniq=Wg,p.sortedUniqBy=Fg,p.split=Om,p.spread=Zv,p.tail=Bg,p.take=Gg,p.takeRight=Jg,p.takeRightWhile=Qg,p.takeWhile=Yg,p.tap=pv,p.throttle=Xv,p.thru=pi,p.toArray=fu,p.toPairs=wu,p.toPairsIn=_u,p.toPath=ow,p.toPlainObject=gu,p.transform=im,p.unary=ty,p.union=Zg,p.unionBy=Xg,p.unionWith=tv,p.uniq=ev,p.uniqBy=rv,p.uniqWith=nv,p.unset=sm,p.unzip=Ks,p.unzipWith=Zc,p.update=om,p.updateWith=am,p.values=Tr,p.valuesIn=cm,p.without=iv,p.words=Iu,p.wrap=ey,p.xor=sv,p.xorBy=ov,p.xorWith=av,p.zip=cv,p.zipObject=uv,p.zipObjectDeep=lv,p.zipWith=hv,p.entries=wu,p.entriesIn=_u,p.extend=vu,p.extendWith=wi,to(p,p),p.add=cw,p.attempt=Pu,p.camelCase=pm,p.capitalize=bu,p.ceil=uw,p.clamp=um,p.clone=ny,p.cloneDeep=sy,p.cloneDeepWith=oy,p.cloneWith=iy,p.conformsTo=ay,p.deburr=Eu,p.defaultTo=zm,p.divide=lw,p.endsWith=fm,p.eq=le,p.escape=dm,p.escapeRegExp=gm,p.every=Ev,p.find=Pv,p.findIndex=Bc,p.findKey=Uy,p.findLast=Sv,p.findLastIndex=Gc,p.findLastKey=My,p.floor=hw,p.forEach=tu,p.forEachRight=eu,p.forIn=Ly,p.forInRight=ky,p.forOwn=zy,p.forOwnRight=Vy,p.get=Js,p.gt=cy,p.gte=uy,p.has=Wy,p.hasIn=Qs,p.head=Qc,p.identity=Ut,p.includes=xv,p.indexOf=Sg,p.inRange=lm,p.invoke=Gy,p.isArguments=ar,p.isArray=z,p.isArrayBuffer=ly,p.isArrayLike=$t,p.isArrayLikeObject=ft,p.isBoolean=hy,p.isBuffer=Fe,p.isDate=py,p.isElement=fy,p.isEmpty=dy,p.isEqual=gy,p.isEqualWith=vy,p.isError=Bs,p.isFinite=yy,p.isFunction=Ce,p.isInteger=uu,p.isLength=yi,p.isMap=lu,p.isMatch=my,p.isMatchWith=wy,p.isNaN=_y,p.isNative=by,p.isNil=Iy,p.isNull=Ey,p.isNumber=hu,p.isObject=lt,p.isObjectLike=ht,p.isPlainObject=hn,p.isRegExp=Gs,p.isSafeInteger=Py,p.isSet=pu,p.isString=mi,p.isSymbol=Wt,p.isTypedArray=xr,p.isUndefined=Sy,p.isWeakMap=Oy,p.isWeakSet=Ny,p.join=xg,p.kebabCase=vm,p.last=re,p.lastIndexOf=Tg,p.lowerCase=ym,p.lowerFirst=mm,p.lt=Ry,p.lte=Cy,p.max=pw,p.maxBy=fw,p.mean=dw,p.meanBy=gw,p.min=vw,p.minBy=yw,p.stubArray=ro,p.stubFalse=no,p.stubObject=rw,p.stubString=nw,p.stubTrue=iw,p.multiply=mw,p.nth=Ag,p.noConflict=Gm,p.noop=eo,p.now=di,p.pad=wm,p.padEnd=_m,p.padStart=bm,p.parseInt=Em,p.random=hm,p.reduce=$v,p.reduceRight=jv,p.repeat=Im,p.replace=Pm,p.result=em,p.round=ww,p.runInContext=y,p.sample=Mv,p.size=zv,p.snakeCase=Sm,p.some=Vv,p.sortedIndex=Lg,p.sortedIndexBy=kg,p.sortedIndexOf=zg,p.sortedLastIndex=Vg,p.sortedLastIndexBy=Hg,p.sortedLastIndexOf=Kg,p.startCase=Nm,p.startsWith=Rm,p.subtract=_w,p.sum=bw,p.sumBy=Ew,p.template=Cm,p.times=sw,p.toFinite=xe,p.toInteger=V,p.toLength=du,p.toLower=xm,p.toNumber=ne,p.toSafeInteger=xy,p.toString=Z,p.toUpper=Tm,p.trim=Am,p.trimEnd=Dm,p.trimStart=qm,p.truncate=$m,p.unescape=jm,p.uniqueId=aw,p.upperCase=Um,p.upperFirst=Ys,p.each=tu,p.eachRight=eu,p.first=Qc,to(p,function(){var t={};return ve(p,function(n,s){tt.call(p.prototype,s)||(t[s]=n)}),t}(),{chain:!1}),p.VERSION=i,Yt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){p[t].placeholder=p}),Yt(["drop","take"],function(t,n){B.prototype[t]=function(s){s=s===r?1:wt(V(s),0);var c=this.__filtered__&&!n?new B(this):this.clone();return c.__filtered__?c.__takeCount__=St(s,c.__takeCount__):c.__views__.push({size:St(s,ge),type:t+(c.__dir__<0?"Right":"")}),c},B.prototype[t+"Right"]=function(s){return this.reverse()[t](s).reverse()}}),Yt(["filter","map","takeWhile"],function(t,n){var s=n+1,c=s==Jo||s==Ah;B.prototype[t]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:j(l,3),type:s}),f.__filtered__=f.__filtered__||c,f}}),Yt(["head","last"],function(t,n){var s="take"+(n?"Right":"");B.prototype[t]=function(){return this[s](1).value()[0]}}),Yt(["initial","tail"],function(t,n){var s="drop"+(n?"":"Right");B.prototype[t]=function(){return this.__filtered__?new B(this):this[s](1)}}),B.prototype.compact=function(){return this.filter(Ut)},B.prototype.find=function(t){return this.filter(t).head()},B.prototype.findLast=function(t){return this.reverse().find(t)},B.prototype.invokeMap=K(function(t,n){return typeof t=="function"?new B(this):this.map(function(s){return sn(s,t,n)})}),B.prototype.reject=function(t){return this.filter(vi(j(t)))},B.prototype.slice=function(t,n){t=V(t);var s=this;return s.__filtered__&&(t>0||n<0)?new B(s):(t<0?s=s.takeRight(-t):t&&(s=s.drop(t)),n!==r&&(n=V(n),s=n<0?s.dropRight(-n):s.take(n-t)),s)},B.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},B.prototype.toArray=function(){return this.take(ge)},ve(B.prototype,function(t,n){var s=/^(?:filter|find|map|reject)|While$/.test(n),c=/^(?:head|last)$/.test(n),l=p[c?"take"+(n=="last"?"Right":""):n],f=c||/^find/.test(n);l&&(p.prototype[n]=function(){var d=this.__wrapped__,v=c?[1]:arguments,m=d instanceof B,I=v[0],P=m||z(d),N=function(W){var G=l.apply(p,Le([W],v));return c&&x?G[0]:G};P&&s&&typeof I=="function"&&I.length!=1&&(m=P=!1);var x=this.__chain__,q=!!this.__actions__.length,M=f&&!x,H=m&&!q;if(!f&&P){d=H?d:new B(this);var L=t.apply(d,v);return L.__actions__.push({func:pi,args:[N],thisArg:r}),new Xt(L,x)}return M&&H?t.apply(this,v):(L=this.thru(N),M?c?L.value()[0]:L.value():L)})}),Yt(["pop","push","shift","sort","splice","unshift"],function(t){var n=Mn[t],s=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",c=/^(?:pop|shift)$/.test(t);p.prototype[t]=function(){var l=arguments;if(c&&!this.__chain__){var f=this.value();return n.apply(z(f)?f:[],l)}return this[s](function(d){return n.apply(z(d)?d:[],l)})}}),ve(B.prototype,function(t,n){var s=p[n];if(s){var c=s.name+"";tt.call(Sr,c)||(Sr[c]=[]),Sr[c].push({name:n,func:s})}}),Sr[si(r,Y).name]=[{name:"wrapper",func:r}],B.prototype.clone=jf,B.prototype.reverse=Uf,B.prototype.value=Mf,p.prototype.at=fv,p.prototype.chain=dv,p.prototype.commit=gv,p.prototype.next=vv,p.prototype.plant=mv,p.prototype.reverse=wv,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=_v,p.prototype.first=p.prototype.head,Yr&&(p.prototype[Yr]=yv),p},Er=gf();Xe?((Xe.exports=Er)._=Er,Xi._=Er):Et._=Er}).call(mn)})(No,No.exports);var DP=Object.defineProperty,qP=Object.defineProperties,$P=Object.getOwnPropertyDescriptors,Dl=Object.getOwnPropertySymbols,jP=Object.prototype.hasOwnProperty,UP=Object.prototype.propertyIsEnumerable,ql=(o,e,r)=>e in o?DP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Ei=(o,e)=>{for(var r in e||(e={}))jP.call(e,r)&&ql(o,r,e[r]);if(Dl)for(var r of Dl(e))UP.call(e,r)&&ql(o,r,e[r]);return o},MP=(o,e)=>qP(o,$P(e));function Qe(o,e,r){var i;const a=ub(o);return((i=e.rpcMap)==null?void 0:i[a.reference])||`${AP}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function gr(o){return o.includes(":")?o.split(":")[1]:o}function Sh(o){return o.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function LP(o,e){const r=Object.keys(e.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const i=[];return r.forEach(a=>{const u=e.namespaces[a].accounts;i.push(...u)}),i}function kP(o={},e={}){const r=$l(o),i=$l(e);return No.exports.merge(r,i)}function $l(o){var e,r,i,a;const u={};if(!jr(o))return u;for(const[h,g]of Object.entries(o)){const w=Vo(h)?[h]:g.chains,b=g.methods||[],S=g.events||[],O=g.rpcMap||{},R=wn(h);u[R]=MP(Ei(Ei({},u[R]),g),{chains:io(w,(e=u[R])==null?void 0:e.chains),methods:io(b,(r=u[R])==null?void 0:r.methods),events:io(S,(i=u[R])==null?void 0:i.events),rpcMap:Ei(Ei({},O),(a=u[R])==null?void 0:a.rpcMap)})}return u}function zP(o){return o.includes(":")?o.split(":")[2]:o}function VP(o){const e={};for(const[r,i]of Object.entries(o)){const a=i.methods||[],u=i.events||[],h=i.accounts||[],g=Vo(r)?[r]:i.chains?i.chains:Sh(i.accounts);e[r]={chains:g,methods:a,events:u,accounts:h}}return e}function ho(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const Oh={},ut=o=>Oh[o],po=(o,e)=>{Oh[o]=e};class HP{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=gr(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Qe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}}class KP{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Qe(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=parseInt(gr(r));e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,i;let a=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:a}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}}class WP{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=gr(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Qe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}}class FP{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=gr(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Qe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}}class BP{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const i=this.getCardanoRPCUrl(r),a=gr(r);e[a]=this.createHttpProvider(a,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}}class GP{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=gr(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Qe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}}class JP{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const a=gr(r);e[a]=this.createHttpProvider(a,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Qe(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new qe(new Ye(i,ut("disableProviderPing")))}}class QP{constructor(e){this.name="near",this.namespace=e.namespace,this.events=ut("events"),this.client=ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Qe(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;e[r]=this.createHttpProvider(r,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Qe(e,this.namespace);return typeof i>"u"?void 0:new qe(new Ye(i,ut("disableProviderPing")))}}var YP=Object.defineProperty,ZP=Object.defineProperties,XP=Object.getOwnPropertyDescriptors,jl=Object.getOwnPropertySymbols,tS=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,Ul=(o,e,r)=>e in o?YP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Ii=(o,e)=>{for(var r in e||(e={}))tS.call(e,r)&&Ul(o,r,e[r]);if(jl)for(var r of jl(e))eS.call(e,r)&&Ul(o,r,e[r]);return o},fo=(o,e)=>ZP(o,XP(e));class Bo{constructor(e){this.events=new xo,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:xi(Ti({level:e?.logger||Tl})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new Bo(e);return await r.initialize(),r}async request(e,r){const[i,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Ii({},e),chainId:`${i}:${a}`,topic:this.session.topic})}sendAsync(e,r,i){const a=new Date().getTime();this.request(e,i).then(u=>r(null,Ai(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:gt("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:i,approval:a}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});i&&(this.uri=i,this.events.emit("display_uri",i)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=VP(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Ih)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,a]=this.validateChain(e);this.getProvider(i).setDefaultChain(a,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(lr(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await mP.init({logger:this.providerOpts.logger||Tl,relayUrl:this.providerOpts.relayUrl||CP,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>wn(r)))];po("client",this.client),po("events",this.events),po("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=LP(r,this.session),a=Sh(i),u=kP(this.namespaces,this.optionalNamespaces),h=fo(Ii({},u[r]),{accounts:i,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new KP({namespace:h});break;case"solana":this.rpcProviders[r]=new WP({namespace:h});break;case"cosmos":this.rpcProviders[r]=new FP({namespace:h});break;case"polkadot":this.rpcProviders[r]=new HP({namespace:h});break;case"cip34":this.rpcProviders[r]=new BP({namespace:h});break;case"elrond":this.rpcProviders[r]=new GP({namespace:h});break;case"multiversx":this.rpcProviders[r]=new JP({namespace:h});break;case"near":this.rpcProviders[r]=new QP({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;if(i.name==="accountsChanged"){const a=i.data;a&&lr(a)&&this.events.emit("accountsChanged",a.map(zP))}else if(i.name==="chainChanged"){const a=r.chainId,u=r.event.data,h=wn(a),g=ho(a)!==ho(u)?`${h}:${ho(u)}`:a;this.onChainChanged(g)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:a}=r,u=(i=this.client)==null?void 0:i.session.get(e);this.session=fo(Ii({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",fo(Ii({},gt("USER_DISCONNECTED")),{data:e.topic}))}),this.on($e.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r,optionalNamespaces:i,sessionProperties:a}=e;r&&Object.keys(r).length&&(this.namespaces=r),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",i)}validateChain(e){const[r,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(h=>wn(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const a=wn(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r=!1){var i;if(!this.namespaces)return;const[a,u]=this.validateChain(e);r||this.getProvider(a).setDefaultChain(u),((i=this.namespaces[a])!=null?i:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,r){this.client.core.storage.setItem(`${Al}/${e}`,r)}async getFromStore(e){return await this.client.core.storage.getItem(`${Al}/${e}`)}}const rS=Bo,nS="wc",iS="ethereum_provider",sS=`${nS}@2:${iS}:`,oS="https://rpc.walletconnect.com/v1/",Ro=["eth_sendTransaction","personal_sign"],aS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Co=["chainChanged","accountsChanged"],cS=["chainChanged","accountsChanged","message","disconnect","connect"];var uS=Object.defineProperty,lS=Object.defineProperties,hS=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,pS=Object.prototype.hasOwnProperty,fS=Object.prototype.propertyIsEnumerable,Ll=(o,e,r)=>e in o?uS(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,bn=(o,e)=>{for(var r in e||(e={}))pS.call(e,r)&&Ll(o,r,e[r]);if(Ml)for(var r of Ml(e))fS.call(e,r)&&Ll(o,r,e[r]);return o},kl=(o,e)=>lS(o,hS(e));function Ci(o){return Number(o[0].split(":")[1])}function go(o){return`0x${o.toString(16)}`}function dS(o){const{chains:e,optionalChains:r,methods:i,optionalMethods:a,events:u,optionalEvents:h,rpcMap:g}=o;if(!vo(e))throw new Error("Invalid chains");const w={chains:e,methods:i||Ro,events:u||Co,rpcMap:bn({},e.length?{[Ci(e)]:g[Ci(e)]}:{})},b=u?.filter(U=>!Co.includes(U)),S=i?.filter(U=>!Ro.includes(U));if(!r&&!h&&!a&&!(b!=null&&b.length)&&!(S!=null&&S.length))return{required:e.length?w:void 0};const O=b?.length&&S?.length||!r,R={chains:[...new Set(O?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:aS))],events:[...new Set(w.events.concat(h!=null&&h.length?h:cS))],rpcMap:g};return{required:e.length?w:void 0,optional:r.length?R:void 0}}class Go{constructor(){this.events=new be.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=sS,this.on=(e,r)=>(this.events.on(e,r),this),this.once=(e,r)=>(this.events.once(e,r),this),this.removeListener=(e,r)=>(this.events.removeListener(e,r),this),this.off=(e,r)=>(this.events.off(e,r),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const r=new Go;return await r.initialize(e),r}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,r){this.signer.sendAsync(e,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:r,optional:i}=dS(this.rpc);try{const a=await new Promise(async(h,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(b=>{!b.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(kl(bn({namespaces:bn({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e?.pairingTopic})).then(b=>{h(b)}).catch(b=>{g(new Error(b.message))})});if(!a)return;const u=Bw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:go(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",go(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",kl(bn({},Jw("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var r,i;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",go(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,a]=e.split(":");return{chainId:`${r}:${i}`,address:a}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const a=(r=e?.chains)!=null?r:[],u=(i=e?.optionalChains)!=null?i:[],h=a.concat(u);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?e?.methods||Ro:[],w=a.length?e?.events||Co:[],b=e?.optionalMethods||[],S=e?.optionalEvents||[],O=e?.rpcMap||this.buildRpcMap(h,e.projectId),R=e?.qrModalOptions||void 0;return{chains:a?.map(U=>this.formatChainId(U)),optionalChains:u.map(U=>this.formatChainId(U)),methods:g,events:w,optionalMethods:b,optionalEvents:S,rpcMap:O,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:R,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(a=>{i[a]=this.getRpcUrl(a,r)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Ci(this.rpc.chains):Ci(this.rpc.optionalChains),this.signer=await rS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storageOptions:e.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:i}=await Iw(async()=>{const{WalletConnectModal:a}=await import("./index-B-TRMIWs.js");return{WalletConnectModal:a}},[]).then(a=>a.i);r=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(bn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:a}=e;r&&vo(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=a?.[u]||this.getRpcUrl(u)})),i&&vo(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(u=>this.formatChainId(u)),i.forEach(u=>{this.rpc.rpcMap[u]=a?.[u]||this.getRpcUrl(u)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${oS}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r?.accounts),this.setAccounts(r?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const _S=Go;export{_S as EthereumProvider,cS as OPTIONAL_EVENTS,aS as OPTIONAL_METHODS,Co as REQUIRED_EVENTS,Ro as REQUIRED_METHODS,Go as default};
